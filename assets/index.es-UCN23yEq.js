import{R as $0,S as D0,T as L0,U as j0,V as q0,W as M0,X as U0,Y as z0,Z as k0,$ as H0,L as K0,M as F0,N as V0,O as B0,K as G0,a0 as Lc,x as uf,a1 as ne,a2 as hf,a3 as To,a4 as W0,a5 as lf,C as J0,v as Q0,P as Y0,r as sn,p as Qr,a6 as Z0,a7 as ff,o as go,q as X0,Q as jc,_ as ew}from"./index-SBlKJ6MA.js";import{d as tw,a as nn,s as Ao,i as Zh,c as rw,b as iw,f as qc,e as sw,J as fi,g as Mc,h as Uc,j as zc,k as Si,l as li,m as en,n as nw,p as ow,H as Ni}from"./http-U2SzUX57.js";function kc(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function pf(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?kc(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function Ic(o,r){r||(r=o.reduce((a,h)=>a+h.length,0));const t=pf(r);let s=0;for(const a of o)t.set(a,s),s+=a.length;return kc(t)}const Xh={...$0,...D0,...L0,...j0,...q0,...M0,...U0,...z0,...k0,...H0};function df(o,r,t,s){return{name:o,prefix:r,encoder:{name:o,prefix:r,encode:t},decoder:{decode:s}}}const el=df("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),nc=df("ascii","a",o=>{let r="a";for(let t=0;t<o.length;t++)r+=String.fromCharCode(o[t]);return r},o=>{o=o.substring(1);const r=pf(o.length);for(let t=0;t<o.length;t++)r[t]=o.charCodeAt(t);return r}),gf={utf8:el,"utf-8":el,hex:Xh.base16,latin1:nc,ascii:nc,binary:nc,...Xh};function gr(o,r="utf8"){const t=gf[r];if(!t)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?kc(globalThis.Buffer.from(o,"utf-8")):t.decoder.decode(`${t.prefix}${o}`)}function nr(o,r="utf8"){const t=gf[r];if(!t)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("utf8"):t.encoder.encode(o).substring(1)}const aw={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var tn={};(function(o){const r=V0,t=B0,s=K0,a=F0,h=C=>C==null,p=Symbol("encodeFragmentIdentifier");function g(C){switch(C.arrayFormat){case"index":return $=>(U,M)=>{const I=U.length;return M===void 0||C.skipNull&&M===null||C.skipEmptyString&&M===""?U:M===null?[...U,[b($,C),"[",I,"]"].join("")]:[...U,[b($,C),"[",b(I,C),"]=",b(M,C)].join("")]};case"bracket":return $=>(U,M)=>M===void 0||C.skipNull&&M===null||C.skipEmptyString&&M===""?U:M===null?[...U,[b($,C),"[]"].join("")]:[...U,[b($,C),"[]=",b(M,C)].join("")];case"colon-list-separator":return $=>(U,M)=>M===void 0||C.skipNull&&M===null||C.skipEmptyString&&M===""?U:M===null?[...U,[b($,C),":list="].join("")]:[...U,[b($,C),":list=",b(M,C)].join("")];case"comma":case"separator":case"bracket-separator":{const $=C.arrayFormat==="bracket-separator"?"[]=":"=";return U=>(M,I)=>I===void 0||C.skipNull&&I===null||C.skipEmptyString&&I===""?M:(I=I===null?"":I,M.length===0?[[b(U,C),$,b(I,C)].join("")]:[[M,b(I,C)].join(C.arrayFormatSeparator)])}default:return $=>(U,M)=>M===void 0||C.skipNull&&M===null||C.skipEmptyString&&M===""?U:M===null?[...U,b($,C)]:[...U,[b($,C),"=",b(M,C)].join("")]}}function w(C){let $;switch(C.arrayFormat){case"index":return(U,M,I)=>{if($=/\[(\d*)\]$/.exec(U),U=U.replace(/\[\d*\]$/,""),!$){I[U]=M;return}I[U]===void 0&&(I[U]={}),I[U][$[1]]=M};case"bracket":return(U,M,I)=>{if($=/(\[\])$/.exec(U),U=U.replace(/\[\]$/,""),!$){I[U]=M;return}if(I[U]===void 0){I[U]=[M];return}I[U]=[].concat(I[U],M)};case"colon-list-separator":return(U,M,I)=>{if($=/(:list)$/.exec(U),U=U.replace(/:list$/,""),!$){I[U]=M;return}if(I[U]===void 0){I[U]=[M];return}I[U]=[].concat(I[U],M)};case"comma":case"separator":return(U,M,I)=>{const L=typeof M=="string"&&M.includes(C.arrayFormatSeparator),K=typeof M=="string"&&!L&&S(M,C).includes(C.arrayFormatSeparator);M=K?S(M,C):M;const ce=L||K?M.split(C.arrayFormatSeparator).map(ae=>S(ae,C)):M===null?M:S(M,C);I[U]=ce};case"bracket-separator":return(U,M,I)=>{const L=/(\[\])$/.test(U);if(U=U.replace(/\[\]$/,""),!L){I[U]=M&&S(M,C);return}const K=M===null?[]:M.split(C.arrayFormatSeparator).map(ce=>S(ce,C));if(I[U]===void 0){I[U]=K;return}I[U]=[].concat(I[U],K)};default:return(U,M,I)=>{if(I[U]===void 0){I[U]=M;return}I[U]=[].concat(I[U],M)}}}function y(C){if(typeof C!="string"||C.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function b(C,$){return $.encode?$.strict?r(C):encodeURIComponent(C):C}function S(C,$){return $.decode?t(C):C}function R(C){return Array.isArray(C)?C.sort():typeof C=="object"?R(Object.keys(C)).sort(($,U)=>Number($)-Number(U)).map($=>C[$]):C}function F(C){const $=C.indexOf("#");return $!==-1&&(C=C.slice(0,$)),C}function q(C){let $="";const U=C.indexOf("#");return U!==-1&&($=C.slice(U)),$}function J(C){C=F(C);const $=C.indexOf("?");return $===-1?"":C.slice($+1)}function oe(C,$){return $.parseNumbers&&!Number.isNaN(Number(C))&&typeof C=="string"&&C.trim()!==""?C=Number(C):$.parseBooleans&&C!==null&&(C.toLowerCase()==="true"||C.toLowerCase()==="false")&&(C=C.toLowerCase()==="true"),C}function fe(C,$){$=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},$),y($.arrayFormatSeparator);const U=w($),M=Object.create(null);if(typeof C!="string"||(C=C.trim().replace(/^[?#&]/,""),!C))return M;for(const I of C.split("&")){if(I==="")continue;let[L,K]=s($.decode?I.replace(/\+/g," "):I,"=");K=K===void 0?null:["comma","separator","bracket-separator"].includes($.arrayFormat)?K:S(K,$),U(S(L,$),K,M)}for(const I of Object.keys(M)){const L=M[I];if(typeof L=="object"&&L!==null)for(const K of Object.keys(L))L[K]=oe(L[K],$);else M[I]=oe(L,$)}return $.sort===!1?M:($.sort===!0?Object.keys(M).sort():Object.keys(M).sort($.sort)).reduce((I,L)=>{const K=M[L];return K&&typeof K=="object"&&!Array.isArray(K)?I[L]=R(K):I[L]=K,I},Object.create(null))}o.extract=J,o.parse=fe,o.stringify=(C,$)=>{if(!C)return"";$=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},$),y($.arrayFormatSeparator);const U=K=>$.skipNull&&h(C[K])||$.skipEmptyString&&C[K]==="",M=g($),I={};for(const K of Object.keys(C))U(K)||(I[K]=C[K]);const L=Object.keys(I);return $.sort!==!1&&L.sort($.sort),L.map(K=>{const ce=C[K];return ce===void 0?"":ce===null?b(K,$):Array.isArray(ce)?ce.length===0&&$.arrayFormat==="bracket-separator"?b(K,$)+"[]":ce.reduce(M(K),[]).join("&"):b(K,$)+"="+b(ce,$)}).filter(K=>K.length>0).join("&")},o.parseUrl=(C,$)=>{$=Object.assign({decode:!0},$);const[U,M]=s(C,"#");return Object.assign({url:U.split("?")[0]||"",query:fe(J(C),$)},$&&$.parseFragmentIdentifier&&M?{fragmentIdentifier:S(M,$)}:{})},o.stringifyUrl=(C,$)=>{$=Object.assign({encode:!0,strict:!0,[p]:!0},$);const U=F(C.url).split("?")[0]||"",M=o.extract(C.url),I=o.parse(M,{sort:!1}),L=Object.assign(I,C.query);let K=o.stringify(L,$);K&&(K=`?${K}`);let ce=q(C.url);return C.fragmentIdentifier&&(ce=`#${$[p]?b(C.fragmentIdentifier,$):C.fragmentIdentifier}`),`${U}${K}${ce}`},o.pick=(C,$,U)=>{U=Object.assign({parseFragmentIdentifier:!0,[p]:!1},U);const{url:M,query:I,fragmentIdentifier:L}=o.parseUrl(C,U);return o.stringifyUrl({url:M,query:a(I,$),fragmentIdentifier:L},U)},o.exclude=(C,$,U)=>{const M=Array.isArray($)?I=>!$.includes(I):(I,L)=>!$(I,L);return o.pick(C,M,U)}})(tn);const cw=":";function uw(o){const[r,t]=o.split(cw);return{namespace:r,reference:t}}function hw(o,r=[]){const t=[];return Object.keys(o).forEach(s=>{if(r.length&&!r.includes(s))return;const a=o[s];t.push(...a.accounts)}),t}function yf(o,r){return o.includes(":")?[o]:r.chains||[]}const mf="base10",sr="base16",xc="base64pad",Hc="utf8",vf=0,Gi=1,lw=0,tl=1,Sc=12,Kc=32;function fw(){const o=hf.generateKeyPair();return{privateKey:nr(o.secretKey,sr),publicKey:nr(o.publicKey,sr)}}function Pc(){const o=To.randomBytes(Kc);return nr(o,sr)}function pw(o,r){const t=hf.sharedKey(gr(o,sr),gr(r,sr),!0),s=new W0(Lc.SHA256,t).expand(Kc);return nr(s,sr)}function dw(o){const r=Lc.hash(gr(o,sr));return nr(r,sr)}function ws(o){const r=Lc.hash(gr(o,Hc));return nr(r,sr)}function gw(o){return gr(`${o}`,mf)}function on(o){return Number(nr(o,mf))}function yw(o){const r=gw(typeof o.type<"u"?o.type:vf);if(on(r)===Gi&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof o.senderPublicKey<"u"?gr(o.senderPublicKey,sr):void 0,s=typeof o.iv<"u"?gr(o.iv,sr):To.randomBytes(Sc),a=new lf.ChaCha20Poly1305(gr(o.symKey,sr)).seal(s,gr(o.message,Hc));return vw({type:r,sealed:a,iv:s,senderPublicKey:t})}function mw(o){const r=new lf.ChaCha20Poly1305(gr(o.symKey,sr)),{sealed:t,iv:s}=Po(o.encoded),a=r.open(s,t);if(a===null)throw new Error("Failed to decrypt");return nr(a,Hc)}function vw(o){if(on(o.type)===Gi){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return nr(Ic([o.type,o.senderPublicKey,o.iv,o.sealed]),xc)}return nr(Ic([o.type,o.iv,o.sealed]),xc)}function Po(o){const r=gr(o,xc),t=r.slice(lw,tl),s=tl;if(on(t)===Gi){const g=s+Kc,w=g+Sc,y=r.slice(s,g),b=r.slice(g,w),S=r.slice(w);return{type:t,sealed:S,iv:b,senderPublicKey:y}}const a=s+Sc,h=r.slice(s,a),p=r.slice(a);return{type:t,sealed:p,iv:h}}function ww(o,r){const t=Po(o);return wf({type:on(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?nr(t.senderPublicKey,sr):void 0,receiverPublicKey:r?.receiverPublicKey})}function wf(o){const r=o?.type||vf;if(r===Gi){if(typeof o?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof o?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:r,senderPublicKey:o?.senderPublicKey,receiverPublicKey:o?.receiverPublicKey}}function rl(o){return o.type===Gi&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var bw=Object.defineProperty,il=Object.getOwnPropertySymbols,_w=Object.prototype.hasOwnProperty,Ew=Object.prototype.propertyIsEnumerable,sl=(o,r,t)=>r in o?bw(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,nl=(o,r)=>{for(var t in r||(r={}))_w.call(r,t)&&sl(o,t,r[t]);if(il)for(var t of il(r))Ew.call(r,t)&&sl(o,t,r[t]);return o};const Iw="ReactNative",Er={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},xw="js";function Fc(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function _s(){return!J0()&&!!uf()&&navigator.product===Iw}function Es(){return!Fc()&&!!uf()}function an(){return _s()?Er.reactNative:Fc()?Er.node:Es()?Er.browser:Er.unknown}function Sw(){var o;try{return _s()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(o=global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function Pw(o,r){let t=tn.parse(o);return t=nl(nl({},t),r),o=tn.stringify(t),o}function Ow(){return G0()||{name:"",description:"",url:"",icons:[""]}}function Cw(){if(an()===Er.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:s}=global.Platform;return[t,s].join("-")}const o=tw();if(o===null)return"unknown";const r=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[r,o.name,o.version].join("-"):[r,o.version].join("-")}function Nw(){var o;const r=an();return r===Er.browser?[r,((o=Q0())==null?void 0:o.host)||"unknown"].join(":"):r}function Rw(o,r,t){const s=Cw(),a=Nw();return[[o,r].join("-"),[xw,t].join("-"),s,a].join("/")}function Tw({protocol:o,version:r,relayUrl:t,sdkVersion:s,auth:a,projectId:h,useOnCloseEvent:p,bundleId:g}){const w=t.split("?"),y=Rw(o,r,s),b={auth:a,ua:y,projectId:h,useOnCloseEvent:p||void 0,origin:g||void 0},S=Pw(w[1]||"",b);return w[0]+"?"+S}function Bi(o,r){return o.filter(t=>r.includes(t)).length===o.length}function bf(o){return Object.fromEntries(o.entries())}function _f(o){return new Map(Object.entries(o))}function ms(o=ne.FIVE_MINUTES,r){const t=ne.toMiliseconds(o||ne.FIVE_MINUTES);let s,a,h;return{resolve:p=>{h&&s&&(clearTimeout(h),s(p))},reject:p=>{h&&a&&(clearTimeout(h),a(p))},done:()=>new Promise((p,g)=>{h=setTimeout(()=>{g(new Error(r))},t),s=p,a=g})}}function rn(o,r,t){return new Promise(async(s,a)=>{const h=setTimeout(()=>a(new Error(t)),r);try{const p=await o;s(p)}catch(p){a(p)}clearTimeout(h)})}function Ef(o,r){if(typeof r=="string"&&r.startsWith(`${o}:`))return r;if(o.toLowerCase()==="topic"){if(typeof r!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${r}`}else if(o.toLowerCase()==="id"){if(typeof r!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${r}`}throw new Error(`Unknown expirer target type: ${o}`)}function Aw(o){return Ef("topic",o)}function $w(o){return Ef("id",o)}function If(o){const[r,t]=o.split(":"),s={id:void 0,topic:void 0};if(r==="topic"&&typeof t=="string")s.topic=t;else if(r==="id"&&Number.isInteger(Number(t)))s.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${r}:${t}`);return s}function zr(o,r){return ne.fromMiliseconds((r||Date.now())+ne.toMiliseconds(o))}function Pi(o){return Date.now()>=ne.toMiliseconds(o)}function Dt(o,r){return`${o}${r?`:${r}`:""}`}function oc(o=[],r=[]){return[...new Set([...o,...r])]}async function Dw({id:o,topic:r,wcDeepLink:t}){try{if(!t)return;let a=(typeof t=="string"?JSON.parse(t):t)?.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const h=`${a}/wc?requestId=${o}&sessionTopic=${r}`,p=an();p===Er.browser?h.startsWith("https://")?window.open(h,"_blank","noreferrer noopener"):window.open(h,"_self","noreferrer noopener"):p===Er.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(h)}catch(s){console.error(s)}}async function Lw(o,r){try{return await o.getItem(r)||(Es()?localStorage.getItem(r):void 0)}catch(t){console.error(t)}}const jw="irn";function Oc(o){return o?.relay||{protocol:jw}}function Eo(o){const r=aw[o];if(typeof r>"u")throw new Error(`Relay Protocol not supported: ${o}`);return r}var qw=Object.defineProperty,ol=Object.getOwnPropertySymbols,Mw=Object.prototype.hasOwnProperty,Uw=Object.prototype.propertyIsEnumerable,al=(o,r,t)=>r in o?qw(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,zw=(o,r)=>{for(var t in r||(r={}))Mw.call(r,t)&&al(o,t,r[t]);if(ol)for(var t of ol(r))Uw.call(r,t)&&al(o,t,r[t]);return o};function kw(o,r="-"){const t={},s="relay"+r;return Object.keys(o).forEach(a=>{if(a.startsWith(s)){const h=a.replace(s,""),p=o[a];t[h]=p}}),t}function cl(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const r=o.indexOf(":"),t=o.indexOf("?")!==-1?o.indexOf("?"):void 0,s=o.substring(0,r),a=o.substring(r+1,t).split("@"),h=typeof t<"u"?o.substring(t):"",p=tn.parse(h);return{protocol:s,topic:Hw(a[0]),version:parseInt(a[1],10),symKey:p.symKey,relay:kw(p)}}function Hw(o){return o.startsWith("//")?o.substring(2):o}function Kw(o,r="-"){const t="relay",s={};return Object.keys(o).forEach(a=>{const h=t+r+a;o[a]&&(s[h]=o[a])}),s}function Fw(o){return`${o.protocol}:${o.topic}@${o.version}?`+tn.stringify(zw({symKey:o.symKey},Kw(o.relay)))}function Is(o){const r=[];return o.forEach(t=>{const[s,a]=t.split(":");r.push(`${s}:${a}`)}),r}function Vw(o){const r=[];return Object.values(o).forEach(t=>{r.push(...Is(t.accounts))}),r}function Bw(o,r){const t=[];return Object.values(o).forEach(s=>{Is(s.accounts).includes(r)&&t.push(...s.methods)}),t}function Gw(o,r){const t=[];return Object.values(o).forEach(s=>{Is(s.accounts).includes(r)&&t.push(...s.events)}),t}function Ww(o,r){const t=Io(o,r);if(t)throw new Error(t.message);const s={};for(const[a,h]of Object.entries(o))s[a]={methods:h.methods,events:h.events,chains:h.accounts.map(p=>`${p.split(":")[0]}:${p.split(":")[1]}`)};return s}function Vc(o){return o.includes(":")}function Ys(o){return Vc(o)?o.split(":")[0]:o}const Jw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Qw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Z(o,r){const{message:t,code:s}=Qw[o];return{message:r?`${t} ${r}`:t,code:s}}function It(o,r){const{message:t,code:s}=Jw[o];return{message:r?`${t} ${r}`:t,code:s}}function Jr(o,r){return Array.isArray(o)?typeof r<"u"&&o.length?o.every(r):!0:!1}function bs(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function ir(o){return typeof o>"u"}function Ht(o,r){return r&&ir(o)?!0:typeof o=="string"&&!!o.trim().length}function Bc(o,r){return r&&ir(o)?!0:typeof o=="number"&&!isNaN(o)}function Yw(o,r){const{requiredNamespaces:t}=r,s=Object.keys(o.namespaces),a=Object.keys(t);let h=!0;return Bi(a,s)?(s.forEach(p=>{const{accounts:g,methods:w,events:y}=o.namespaces[p],b=Is(g),S=t[p];(!Bi(yf(p,S),b)||!Bi(S.methods,w)||!Bi(S.events,y))&&(h=!1)}),h):!1}function Oo(o){return Ht(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function Zw(o){if(Ht(o,!1)&&o.includes(":")){const r=o.split(":");if(r.length===3){const t=r[0]+":"+r[1];return!!r[2]&&Oo(t)}}return!1}function Xw(o){if(Ht(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function eb(o){var r;return(r=o?.proposer)==null?void 0:r.publicKey}function tb(o){return o?.topic}function rb(o,r){let t=null;return Ht(o?.publicKey,!1)||(t=Z("MISSING_OR_INVALID",`${r} controller public key should be a string`)),t}function ul(o){let r=!0;return Jr(o)?o.length&&(r=o.every(t=>Ht(t,!1))):r=!1,r}function ib(o,r,t){let s=null;return Jr(r)&&r.length?r.forEach(a=>{s||Oo(a)||(s=It("UNSUPPORTED_CHAINS",`${t}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Oo(o)||(s=It("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function sb(o,r,t){let s=null;return Object.entries(o).forEach(([a,h])=>{if(s)return;const p=ib(a,yf(a,h),`${r} ${t}`);p&&(s=p)}),s}function nb(o,r){let t=null;return Jr(o)?o.forEach(s=>{t||Zw(s)||(t=It("UNSUPPORTED_ACCOUNTS",`${r}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):t=It("UNSUPPORTED_ACCOUNTS",`${r}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function ob(o,r){let t=null;return Object.values(o).forEach(s=>{if(t)return;const a=nb(s?.accounts,`${r} namespace`);a&&(t=a)}),t}function ab(o,r){let t=null;return ul(o?.methods)?ul(o?.events)||(t=It("UNSUPPORTED_EVENTS",`${r}, events should be an array of strings or empty array for no events`)):t=It("UNSUPPORTED_METHODS",`${r}, methods should be an array of strings or empty array for no methods`),t}function xf(o,r){let t=null;return Object.values(o).forEach(s=>{if(t)return;const a=ab(s,`${r}, namespace`);a&&(t=a)}),t}function cb(o,r,t){let s=null;if(o&&bs(o)){const a=xf(o,r);a&&(s=a);const h=sb(o,r,t);h&&(s=h)}else s=Z("MISSING_OR_INVALID",`${r}, ${t} should be an object with data`);return s}function Io(o,r){let t=null;if(o&&bs(o)){const s=xf(o,r);s&&(t=s);const a=ob(o,r);a&&(t=a)}else t=Z("MISSING_OR_INVALID",`${r}, namespaces should be an object with data`);return t}function Sf(o){return Ht(o.protocol,!0)}function ub(o,r){let t=!1;return r&&!o?t=!0:o&&Jr(o)&&o.length&&o.forEach(s=>{t=Sf(s)}),t}function hb(o){return typeof o=="number"}function dr(o){return typeof o<"u"&&typeof o!==null}function lb(o){return!(!o||typeof o!="object"||!o.code||!Bc(o.code,!1)||!o.message||!Ht(o.message,!1))}function fb(o){return!(ir(o)||!Ht(o.method,!1))}function pb(o){return!(ir(o)||ir(o.result)&&ir(o.error)||!Bc(o.id,!1)||!Ht(o.jsonrpc,!1))}function db(o){return!(ir(o)||!Ht(o.name,!1))}function hl(o,r){return!(!Oo(r)||!Vw(o).includes(r))}function gb(o,r,t){return Ht(t,!1)?Bw(o,r).includes(t):!1}function yb(o,r,t){return Ht(t,!1)?Gw(o,r).includes(t):!1}function ll(o,r,t){let s=null;const a=mb(o),h=vb(r),p=Object.keys(a),g=Object.keys(h),w=fl(Object.keys(o)),y=fl(Object.keys(r)),b=w.filter(S=>!y.includes(S));return b.length&&(s=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${b.toString()}
      Received: ${Object.keys(r).toString()}`)),Bi(p,g)||(s=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${p.toString()}
      Approved: ${g.toString()}`)),Object.keys(r).forEach(S=>{if(!S.includes(":")||s)return;const R=Is(r[S].accounts);R.includes(S)||(s=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${S}
        Required: ${S}
        Approved: ${R.toString()}`))}),p.forEach(S=>{s||(Bi(a[S].methods,h[S].methods)?Bi(a[S].events,h[S].events)||(s=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${S}`)):s=Z("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${S}`))}),s}function mb(o){const r={};return Object.keys(o).forEach(t=>{var s;t.includes(":")?r[t]=o[t]:(s=o[t].chains)==null||s.forEach(a=>{r[a]={methods:o[t].methods,events:o[t].events}})}),r}function fl(o){return[...new Set(o.map(r=>r.includes(":")?r.split(":")[0]:r))]}function vb(o){const r={};return Object.keys(o).forEach(t=>{t.includes(":")?r[t]=o[t]:Is(o[t].accounts)?.forEach(a=>{r[a]={accounts:o[t].accounts.filter(h=>h.includes(`${a}:`)),methods:o[t].methods,events:o[t].events}})}),r}function wb(o,r){return Bc(o,!1)&&o<=r.max&&o>=r.min}function pl(){const o=an();return new Promise(r=>{switch(o){case Er.browser:r(bb());break;case Er.reactNative:r(_b());break;case Er.node:r(Eb());break;default:r(!0)}})}function bb(){return Es()&&navigator?.onLine}async function _b(){return _s()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function Eb(){return!0}function Ib(o){switch(an()){case Er.browser:xb(o);break;case Er.reactNative:Sb(o);break}}function xb(o){!_s()&&Es()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function Sb(o){_s()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(r=>o(r?.isConnected))}const ac={};let yo=class{static get(r){return ac[r]}static set(r,t){ac[r]=t}static delete(r){delete ac[r]}};const Pb=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ob=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Cb=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Nb(o,r){if(o==="__proto__"||o==="constructor"&&r&&typeof r=="object"&&"prototype"in r){Rb(o);return}return r}function Rb(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function mo(o,r={}){if(typeof o!="string")return o;const t=o.trim();if(o[0]==='"'&&o.at(-1)==='"'&&!o.includes("\\"))return t.slice(1,-1);if(t.length<=9){const s=t.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!Cb.test(o)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(Pb.test(o)||Ob.test(o)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,Nb)}return JSON.parse(o)}catch(s){if(r.strict)throw s;return o}}function Tb(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function kt(o,...r){try{return Tb(o(...r))}catch(t){return Promise.reject(t)}}function Ab(o){const r=typeof o;return o===null||r!=="object"&&r!=="function"}function $b(o){const r=Object.getPrototypeOf(o);return!r||r.isPrototypeOf(Object)}function xo(o){if(Ab(o))return String(o);if($b(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return xo(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Pf(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Cc="base64:";function Db(o){if(typeof o=="string")return o;Pf();const r=Buffer.from(o).toString("base64");return Cc+r}function Lb(o){return typeof o!="string"||!o.startsWith(Cc)?o:(Pf(),Buffer.from(o.slice(Cc.length),"base64"))}function pr(o){return o?o.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function jb(...o){return pr(o.join(":"))}function vo(o){return o=pr(o),o?o+":":""}const qb="memory",Mb=()=>{const o=new Map;return{name:qb,options:{},hasItem(r){return o.has(r)},getItem(r){return o.get(r)??null},getItemRaw(r){return o.get(r)??null},setItem(r,t){o.set(r,t)},setItemRaw(r,t){o.set(r,t)},removeItem(r){o.delete(r)},getKeys(){return Array.from(o.keys())},clear(){o.clear()},dispose(){o.clear()}}};function Ub(o={}){const r={mounts:{"":o.driver||Mb()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=y=>{for(const b of r.mountpoints)if(y.startsWith(b))return{base:b,relativeKey:y.slice(b.length),driver:r.mounts[b]};return{base:"",relativeKey:y,driver:r.mounts[""]}},s=(y,b)=>r.mountpoints.filter(S=>S.startsWith(y)||b&&y.startsWith(S)).map(S=>({relativeBase:y.length>S.length?y.slice(S.length):void 0,mountpoint:S,driver:r.mounts[S]})),a=(y,b)=>{if(r.watching){b=pr(b);for(const S of r.watchListeners)S(y,b)}},h=async()=>{if(!r.watching){r.watching=!0;for(const y in r.mounts)r.unwatch[y]=await dl(r.mounts[y],a,y)}},p=async()=>{if(r.watching){for(const y in r.unwatch)await r.unwatch[y]();r.unwatch={},r.watching=!1}},g=(y,b,S)=>{const R=new Map,F=q=>{let J=R.get(q.base);return J||(J={driver:q.driver,base:q.base,items:[]},R.set(q.base,J)),J};for(const q of y){const J=typeof q=="string",oe=pr(J?q:q.key),fe=J?void 0:q.value,C=J||!q.options?b:{...b,...q.options},$=t(oe);F($).items.push({key:oe,value:fe,relativeKey:$.relativeKey,options:C})}return Promise.all([...R.values()].map(q=>S(q))).then(q=>q.flat())},w={hasItem(y,b={}){y=pr(y);const{relativeKey:S,driver:R}=t(y);return kt(R.hasItem,S,b)},getItem(y,b={}){y=pr(y);const{relativeKey:S,driver:R}=t(y);return kt(R.getItem,S,b).then(F=>mo(F))},getItems(y,b){return g(y,b,S=>S.driver.getItems?kt(S.driver.getItems,S.items.map(R=>({key:R.relativeKey,options:R.options})),b).then(R=>R.map(F=>({key:jb(S.base,F.key),value:mo(F.value)}))):Promise.all(S.items.map(R=>kt(S.driver.getItem,R.relativeKey,R.options).then(F=>({key:R.key,value:mo(F)})))))},getItemRaw(y,b={}){y=pr(y);const{relativeKey:S,driver:R}=t(y);return R.getItemRaw?kt(R.getItemRaw,S,b):kt(R.getItem,S,b).then(F=>Lb(F))},async setItem(y,b,S={}){if(b===void 0)return w.removeItem(y);y=pr(y);const{relativeKey:R,driver:F}=t(y);F.setItem&&(await kt(F.setItem,R,xo(b),S),F.watch||a("update",y))},async setItems(y,b){await g(y,b,async S=>{S.driver.setItems&&await kt(S.driver.setItems,S.items.map(R=>({key:R.relativeKey,value:xo(R.value),options:R.options})),b),S.driver.setItem&&await Promise.all(S.items.map(R=>kt(S.driver.setItem,R.relativeKey,xo(R.value),R.options)))})},async setItemRaw(y,b,S={}){if(b===void 0)return w.removeItem(y,S);y=pr(y);const{relativeKey:R,driver:F}=t(y);if(F.setItemRaw)await kt(F.setItemRaw,R,b,S);else if(F.setItem)await kt(F.setItem,R,Db(b),S);else return;F.watch||a("update",y)},async removeItem(y,b={}){typeof b=="boolean"&&(b={removeMeta:b}),y=pr(y);const{relativeKey:S,driver:R}=t(y);R.removeItem&&(await kt(R.removeItem,S,b),(b.removeMeta||b.removeMata)&&await kt(R.removeItem,S+"$",b),R.watch||a("remove",y))},async getMeta(y,b={}){typeof b=="boolean"&&(b={nativeOnly:b}),y=pr(y);const{relativeKey:S,driver:R}=t(y),F=Object.create(null);if(R.getMeta&&Object.assign(F,await kt(R.getMeta,S,b)),!b.nativeOnly){const q=await kt(R.getItem,S+"$",b).then(J=>mo(J));q&&typeof q=="object"&&(typeof q.atime=="string"&&(q.atime=new Date(q.atime)),typeof q.mtime=="string"&&(q.mtime=new Date(q.mtime)),Object.assign(F,q))}return F},setMeta(y,b,S={}){return this.setItem(y+"$",b,S)},removeMeta(y,b={}){return this.removeItem(y+"$",b)},async getKeys(y,b={}){y=vo(y);const S=s(y,!0);let R=[];const F=[];for(const q of S){const oe=(await kt(q.driver.getKeys,q.relativeBase,b)).map(fe=>q.mountpoint+pr(fe)).filter(fe=>!R.some(C=>fe.startsWith(C)));F.push(...oe),R=[q.mountpoint,...R.filter(fe=>!fe.startsWith(q.mountpoint))]}return y?F.filter(q=>q.startsWith(y)&&!q.endsWith("$")):F.filter(q=>!q.endsWith("$"))},async clear(y,b={}){y=vo(y),await Promise.all(s(y,!1).map(async S=>{if(S.driver.clear)return kt(S.driver.clear,S.relativeBase,b);if(S.driver.removeItem){const R=await S.driver.getKeys(S.relativeBase||"",b);return Promise.all(R.map(F=>S.driver.removeItem(F,b)))}}))},async dispose(){await Promise.all(Object.values(r.mounts).map(y=>gl(y)))},async watch(y){return await h(),r.watchListeners.push(y),async()=>{r.watchListeners=r.watchListeners.filter(b=>b!==y),r.watchListeners.length===0&&await p()}},async unwatch(){r.watchListeners=[],await p()},mount(y,b){if(y=vo(y),y&&r.mounts[y])throw new Error(`already mounted at ${y}`);return y&&(r.mountpoints.push(y),r.mountpoints.sort((S,R)=>R.length-S.length)),r.mounts[y]=b,r.watching&&Promise.resolve(dl(b,a,y)).then(S=>{r.unwatch[y]=S}).catch(console.error),w},async unmount(y,b=!0){y=vo(y),!(!y||!r.mounts[y])&&(r.watching&&y in r.unwatch&&(r.unwatch[y](),delete r.unwatch[y]),b&&await gl(r.mounts[y]),r.mountpoints=r.mountpoints.filter(S=>S!==y),delete r.mounts[y])},getMount(y=""){y=pr(y)+":";const b=t(y);return{driver:b.driver,base:b.base}},getMounts(y="",b={}){return y=pr(y),s(y,b.parents).map(R=>({driver:R.driver,base:R.mountpoint}))}};return w}function dl(o,r,t){return o.watch?o.watch((s,a)=>r(s,t+a)):()=>{}}async function gl(o){typeof o.dispose=="function"&&await kt(o.dispose)}function Wi(o){return new Promise((r,t)=>{o.oncomplete=o.onsuccess=()=>r(o.result),o.onabort=o.onerror=()=>t(o.error)})}function Of(o,r){const t=indexedDB.open(o);t.onupgradeneeded=()=>t.result.createObjectStore(r);const s=Wi(t);return(a,h)=>s.then(p=>h(p.transaction(r,a).objectStore(r)))}let cc;function cn(){return cc||(cc=Of("keyval-store","keyval")),cc}function yl(o,r=cn()){return r("readonly",t=>Wi(t.get(o)))}function zb(o,r,t=cn()){return t("readwrite",s=>(s.put(r,o),Wi(s.transaction)))}function kb(o,r=cn()){return r("readwrite",t=>(t.delete(o),Wi(t.transaction)))}function Hb(o=cn()){return o("readwrite",r=>(r.clear(),Wi(r.transaction)))}function Kb(o,r){return o.openCursor().onsuccess=function(){this.result&&(r(this.result),this.result.continue())},Wi(o.transaction)}function Fb(o=cn()){return o("readonly",r=>{if(r.getAllKeys)return Wi(r.getAllKeys());const t=[];return Kb(r,s=>t.push(s.key)).then(()=>t)})}const Vb="idb-keyval";var Bb=(o={})=>{const r=o.base&&o.base.length>0?`${o.base}:`:"",t=a=>r+a;let s;return o.dbName&&o.storeName&&(s=Of(o.dbName,o.storeName)),{name:Vb,options:o,async hasItem(a){return!(typeof await yl(t(a),s)>"u")},async getItem(a){return await yl(t(a),s)??null},setItem(a,h){return zb(t(a),h,s)},removeItem(a){return kb(t(a),s)},getKeys(){return Fb(s)},clear(){return Hb(s)}}};const Gb="WALLET_CONNECT_V2_INDEXED_DB",Wb="keyvaluestorage";let Jb=class{constructor(){this.indexedDb=Ub({driver:Bb({dbName:Gb,storeName:Wb})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(r=>[r.key,r.value])}async getItem(r){const t=await this.indexedDb.getItem(r);if(t!==null)return t}async setItem(r,t){await this.indexedDb.setItem(r,nn(t))}async removeItem(r){await this.indexedDb.removeItem(r)}};var uc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},So={exports:{}};(function(){let o;function r(){}o=r,o.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},o.prototype.setItem=function(t,s){this[t]=String(s)},o.prototype.removeItem=function(t){delete this[t]},o.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(s){t[s]=void 0,delete t[s]})},o.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof uc<"u"&&uc.localStorage?So.exports=uc.localStorage:typeof window<"u"&&window.localStorage?So.exports=window.localStorage:So.exports=new r})();function Qb(o){var r;return[o[0],Ao((r=o[1])!=null?r:"")]}class Yb{constructor(){this.localStorage=So.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Qb)}async getItem(r){const t=this.localStorage.getItem(r);if(t!==null)return Ao(t)}async setItem(r,t){this.localStorage.setItem(r,nn(t))}async removeItem(r){this.localStorage.removeItem(r)}}const Zb="wc_storage_version",ml=1,Xb=async(o,r,t)=>{const s=Zb,a=await r.getItem(s);if(a&&a>=ml){t(r);return}const h=await o.getKeys();if(!h.length){t(r);return}const p=[];for(;h.length;){const g=h.shift();if(!g)continue;const w=g.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const y=await o.getItem(g);await r.setItem(g,y),p.push(g)}}await r.setItem(s,ml),t(r),e_(o,p)},e_=async(o,r)=>{r.length&&r.forEach(async t=>{await o.removeItem(t)})};let t_=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const r=new Yb;this.storage=r;try{const t=new Jb;Xb(r,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(r){return await this.initialize(),this.storage.getItem(r)}async setItem(r,t){return await this.initialize(),this.storage.setItem(r,t)}async removeItem(r){return await this.initialize(),this.storage.removeItem(r)}async initialize(){this.initialized||await new Promise(r=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),r())},20)})}};var xs={},Fs={},hc={},Vs={};class Ji{}const r_=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ji},Symbol.toStringTag,{value:"Module"})),i_=Y0(r_);var vl;function s_(){if(vl)return Vs;vl=1,Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.IHeartBeat=void 0;const o=i_;class r extends o.IEvents{constructor(s){super()}}return Vs.IHeartBeat=r,Vs}var wl;function Cf(){return wl||(wl=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),sn.__exportStar(s_(),o)}(hc)),hc}var lc={},Fi={},bl;function n_(){if(bl)return Fi;bl=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.HEARTBEAT_EVENTS=Fi.HEARTBEAT_INTERVAL=void 0;const o=ne;return Fi.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Fi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Fi}var _l;function Nf(){return _l||(_l=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),sn.__exportStar(n_(),o)}(lc)),lc}var El;function o_(){if(El)return Fs;El=1,Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.HeartBeat=void 0;const o=sn,r=Qr,t=ne,s=Cf(),a=Nf();class h extends s.IHeartBeat{constructor(g){super(g),this.events=new r.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=g?.interval||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const w=new h(g);return yield w.init(),w})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Fs.HeartBeat=h,Fs}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const r=sn;r.__exportStar(o_(),o),r.__exportStar(Cf(),o),r.__exportStar(Nf(),o)})(xs);var Ce={},fc,Il;function a_(){if(Il)return fc;Il=1;function o(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}fc=r;function r(t,s,a){var h=a&&a.stringify||o,p=1;if(typeof t=="object"&&t!==null){var g=s.length+p;if(g===1)return t;var w=new Array(g);w[0]=h(t);for(var y=1;y<g;y++)w[y]=h(s[y]);return w.join(" ")}if(typeof t!="string")return t;var b=s.length;if(b===0)return t;for(var S="",R=1-p,F=-1,q=t&&t.length||0,J=0;J<q;){if(t.charCodeAt(J)===37&&J+1<q){switch(F=F>-1?F:0,t.charCodeAt(J+1)){case 100:case 102:if(R>=b||s[R]==null)break;F<J&&(S+=t.slice(F,J)),S+=Number(s[R]),F=J+2,J++;break;case 105:if(R>=b||s[R]==null)break;F<J&&(S+=t.slice(F,J)),S+=Math.floor(Number(s[R])),F=J+2,J++;break;case 79:case 111:case 106:if(R>=b||s[R]===void 0)break;F<J&&(S+=t.slice(F,J));var oe=typeof s[R];if(oe==="string"){S+="'"+s[R]+"'",F=J+2,J++;break}if(oe==="function"){S+=s[R].name||"<anonymous>",F=J+2,J++;break}S+=h(s[R]),F=J+2,J++;break;case 115:if(R>=b)break;F<J&&(S+=t.slice(F,J)),S+=String(s[R]),F=J+2,J++;break;case 37:F<J&&(S+=t.slice(F,J)),S+="%",F=J+2,J++,R--;break}++R}++J}return F===-1?t:(F<q&&(S+=t.slice(F)),S)}return fc}var pc,xl;function c_(){if(xl)return pc;xl=1;const o=a_();pc=a;const r=M().console||{},t={mapHttpRequest:q,mapHttpResponse:q,wrapRequestSerializer:J,wrapResponseSerializer:J,wrapErrorSerializer:J,req:q,res:q,err:R};function s(I,L){return Array.isArray(I)?I.filter(function(ce){return ce!=="!stdSerializers.err"}):I===!0?Object.keys(L):!1}function a(I){I=I||{},I.browser=I.browser||{};const L=I.browser.transmit;if(L&&typeof L.send!="function")throw Error("pino: transmit option must have a send function");const K=I.browser.write||r;I.browser.write&&(I.browser.asObject=!0);const ce=I.serializers||{},ae=s(I.browser.serialize,ce);let Ee=I.browser.serialize;Array.isArray(I.browser.serialize)&&I.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ne=["error","fatal","warn","info","debug","trace"];typeof K=="function"&&(K.error=K.fatal=K.warn=K.info=K.debug=K.trace=K),I.enabled===!1&&(I.level="silent");const et=I.level||"info",A=Object.create(K);A.log||(A.log=oe),Object.defineProperty(A,"levelVal",{get:Ue}),Object.defineProperty(A,"level",{get:Re,set:ee});const V={transmit:L,serialize:ae,asObject:I.browser.asObject,levels:Ne,timestamp:F(I)};A.levels=a.levels,A.level=et,A.setMaxListeners=A.getMaxListeners=A.emit=A.addListener=A.on=A.prependListener=A.once=A.prependOnceListener=A.removeListener=A.removeAllListeners=A.listeners=A.listenerCount=A.eventNames=A.write=A.flush=oe,A.serializers=ce,A._serialize=ae,A._stdErrSerialize=Ee,A.child=Q,L&&(A._logEvent=S());function Ue(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Re(){return this._level}function ee(W){if(W!=="silent"&&!this.levels.values[W])throw Error("unknown level "+W);this._level=W,h(V,A,"error","log"),h(V,A,"fatal","error"),h(V,A,"warn","error"),h(V,A,"info","log"),h(V,A,"debug","log"),h(V,A,"trace","log")}function Q(W,Y){if(!W)throw new Error("missing bindings for child Pino");Y=Y||{},ae&&W.serializers&&(Y.serializers=W.serializers);const ut=Y.serializers;if(ae&&ut){var He=Object.assign({},ce,ut),kr=I.browser.serialize===!0?Object.keys(He):ae;delete W.serializers,w([W],kr,He,this._stdErrSerialize)}function be(xt){this._childLevel=(xt._childLevel|0)+1,this.error=y(xt,W,"error"),this.fatal=y(xt,W,"fatal"),this.warn=y(xt,W,"warn"),this.info=y(xt,W,"info"),this.debug=y(xt,W,"debug"),this.trace=y(xt,W,"trace"),He&&(this.serializers=He,this._serialize=kr),L&&(this._logEvent=S([].concat(xt._logEvent.bindings,W)))}return be.prototype=this,new be(this)}return A}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=t,a.stdTimeFunctions=Object.assign({},{nullTime:fe,epochTime:C,unixTime:$,isoTime:U});function h(I,L,K,ce){const ae=Object.getPrototypeOf(L);L[K]=L.levelVal>L.levels.values[K]?oe:ae[K]?ae[K]:r[K]||r[ce]||oe,p(I,L,K)}function p(I,L,K){!I.transmit&&L[K]===oe||(L[K]=function(ce){return function(){const Ee=I.timestamp(),Ne=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===r?r:this;for(var A=0;A<Ne.length;A++)Ne[A]=arguments[A];if(I.serialize&&!I.asObject&&w(Ne,this._serialize,this.serializers,this._stdErrSerialize),I.asObject?ce.call(et,g(this,K,Ne,Ee)):ce.apply(et,Ne),I.transmit){const V=I.transmit.level||L.level,Ue=a.levels.values[V],Re=a.levels.values[K];if(Re<Ue)return;b(this,{ts:Ee,methodLevel:K,methodValue:Re,transmitLevel:V,transmitValue:a.levels.values[I.transmit.level||L.level],send:I.transmit.send,val:L.levelVal},Ne)}}}(L[K]))}function g(I,L,K,ce){I._serialize&&w(K,I._serialize,I.serializers,I._stdErrSerialize);const ae=K.slice();let Ee=ae[0];const Ne={};ce&&(Ne.time=ce),Ne.level=a.levels.values[L];let et=(I._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof ae[0]=="object";)Object.assign(Ne,ae.shift());Ee=ae.length?o(ae.shift(),ae):void 0}else typeof Ee=="string"&&(Ee=o(ae.shift(),ae));return Ee!==void 0&&(Ne.msg=Ee),Ne}function w(I,L,K,ce){for(const ae in I)if(ce&&I[ae]instanceof Error)I[ae]=a.stdSerializers.err(I[ae]);else if(typeof I[ae]=="object"&&!Array.isArray(I[ae]))for(const Ee in I[ae])L&&L.indexOf(Ee)>-1&&Ee in K&&(I[ae][Ee]=K[Ee](I[ae][Ee]))}function y(I,L,K){return function(){const ce=new Array(1+arguments.length);ce[0]=L;for(var ae=1;ae<ce.length;ae++)ce[ae]=arguments[ae-1];return I[K].apply(this,ce)}}function b(I,L,K){const ce=L.send,ae=L.ts,Ee=L.methodLevel,Ne=L.methodValue,et=L.val,A=I._logEvent.bindings;w(K,I._serialize||Object.keys(I.serializers),I.serializers,I._stdErrSerialize===void 0?!0:I._stdErrSerialize),I._logEvent.ts=ae,I._logEvent.messages=K.filter(function(V){return A.indexOf(V)===-1}),I._logEvent.level.label=Ee,I._logEvent.level.value=Ne,ce(Ee,I._logEvent,et),I._logEvent=S(A)}function S(I){return{ts:0,messages:[],bindings:I||[],level:{label:"",value:0}}}function R(I){const L={type:I.constructor.name,msg:I.message,stack:I.stack};for(const K in I)L[K]===void 0&&(L[K]=I[K]);return L}function F(I){return typeof I.timestamp=="function"?I.timestamp:I.timestamp===!1?fe:C}function q(){return{}}function J(I){return I}function oe(){}function fe(){return!1}function C(){return Date.now()}function $(){return Math.round(Date.now()/1e3)}function U(){return new Date(Date.now()).toISOString()}function M(){function I(L){return typeof L<"u"&&L}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return I(self)||I(window)||I(this)||{}}}return pc}var Vi={},Sl;function Rf(){return Sl||(Sl=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.PINO_CUSTOM_CONTEXT_KEY=Vi.PINO_LOGGER_DEFAULTS=void 0,Vi.PINO_LOGGER_DEFAULTS={level:"info"},Vi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Vi}var rr={},Pl;function u_(){if(Pl)return rr;Pl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.generateChildLogger=rr.formatChildLoggerContext=rr.getLoggerContext=rr.setBrowserLoggerContext=rr.getBrowserLoggerContext=rr.getDefaultLoggerOptions=void 0;const o=Rf();function r(g){return Object.assign(Object.assign({},g),{level:g?.level||o.PINO_LOGGER_DEFAULTS.level})}rr.getDefaultLoggerOptions=r;function t(g,w=o.PINO_CUSTOM_CONTEXT_KEY){return g[w]||""}rr.getBrowserLoggerContext=t;function s(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){return g[y]=w,g}rr.setBrowserLoggerContext=s;function a(g,w=o.PINO_CUSTOM_CONTEXT_KEY){let y="";return typeof g.bindings>"u"?y=t(g,w):y=g.bindings().context||"",y}rr.getLoggerContext=a;function h(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){const b=a(g,y);return b.trim()?`${b}/${w}`:w}rr.formatChildLoggerContext=h;function p(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){const b=h(g,w,y),S=g.child({context:b});return s(S,b,y)}return rr.generateChildLogger=p,rr}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const r=sn,t=r.__importDefault(c_());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return t.default}}),r.__exportStar(Rf(),o),r.__exportStar(u_(),o)})(Ce);class h_ extends Ji{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}let l_=class extends Ji{constructor(r,t){super(),this.core=r,this.logger=t,this.records=new Map}},f_=class{constructor(r,t){this.logger=r,this.core=t}},p_=class extends Ji{constructor(r,t){super(),this.relayer=r,this.logger=t}},d_=class extends Ji{constructor(r){super()}},g_=class{constructor(r,t,s,a){this.core=r,this.logger=t,this.name=s}};class y_ extends Ji{constructor(r,t){super(),this.relayer=r,this.logger=t}}let m_=class extends Ji{constructor(r,t){super(),this.core=r,this.logger=t}},v_=class{constructor(r,t){this.projectId=r,this.logger=t}},w_=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},b_=class{constructor(r){this.client=r}};var Gc={},Tf={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var r=Z0,t=ff;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var s=function(){function g(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},g.prototype.update=function(w,y){if(y===void 0&&(y=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var b=0;if(this._bytesHashed+=y,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&y>0;)this._buffer[this._bufferLength++]=w[b++],y--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(y>=this.blockSize&&(b=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,b,y),y%=this.blockSize);y>0;)this._buffer[this._bufferLength++]=w[b++],y--;return this},g.prototype.finish=function(w){if(!this._finished){var y=this._bytesHashed,b=this._bufferLength,S=y/536870912|0,R=y<<3,F=y%128<112?128:256;this._buffer[b]=128;for(var q=b+1;q<F-8;q++)this._buffer[q]=0;r.writeUint32BE(S,this._buffer,F-8),r.writeUint32BE(R,this._buffer,F-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,F),this._finished=!0}for(var q=0;q<this.digestLength/8;q++)r.writeUint32BE(this._stateHi[q],w,q*8),r.writeUint32BE(this._stateLo[q],w,q*8+4);return this},g.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(w){t.wipe(w.stateHi),t.wipe(w.stateLo),w.buffer&&t.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},g}();o.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(g,w,y,b,S,R,F){for(var q=y[0],J=y[1],oe=y[2],fe=y[3],C=y[4],$=y[5],U=y[6],M=y[7],I=b[0],L=b[1],K=b[2],ce=b[3],ae=b[4],Ee=b[5],Ne=b[6],et=b[7],A,V,Ue,Re,ee,Q,W,Y;F>=128;){for(var ut=0;ut<16;ut++){var He=8*ut+R;g[ut]=r.readUint32BE(S,He),w[ut]=r.readUint32BE(S,He+4)}for(var ut=0;ut<80;ut++){var kr=q,be=J,xt=oe,j=fe,D=C,N=$,u=U,E=M,ie=I,pe=L,ve=K,Te=ce,$e=ae,xe=Ee,St=Ne,vt=et;if(A=M,V=et,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=(C>>>14|ae<<18)^(C>>>18|ae<<14)^(ae>>>9|C<<23),V=(ae>>>14|C<<18)^(ae>>>18|C<<14)^(C>>>9|ae<<23),ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,A=C&$^~C&U,V=ae&Ee^~ae&Ne,ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,A=a[ut*2],V=a[ut*2+1],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,A=g[ut%16],V=w[ut%16],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,Ue=W&65535|Y<<16,Re=ee&65535|Q<<16,A=Ue,V=Re,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=(q>>>28|I<<4)^(I>>>2|q<<30)^(I>>>7|q<<25),V=(I>>>28|q<<4)^(q>>>2|I<<30)^(q>>>7|I<<25),ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,A=q&J^q&oe^J&oe,V=I&L^I&K^L&K,ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,E=W&65535|Y<<16,vt=ee&65535|Q<<16,A=j,V=Te,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=Ue,V=Re,ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,j=W&65535|Y<<16,Te=ee&65535|Q<<16,J=kr,oe=be,fe=xt,C=j,$=D,U=N,M=u,q=E,L=ie,K=pe,ce=ve,ae=Te,Ee=$e,Ne=xe,et=St,I=vt,ut%16===15)for(var He=0;He<16;He++)A=g[He],V=w[He],ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=g[(He+9)%16],V=w[(He+9)%16],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Ue=g[(He+1)%16],Re=w[(He+1)%16],A=(Ue>>>1|Re<<31)^(Ue>>>8|Re<<24)^Ue>>>7,V=(Re>>>1|Ue<<31)^(Re>>>8|Ue<<24)^(Re>>>7|Ue<<25),ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Ue=g[(He+14)%16],Re=w[(He+14)%16],A=(Ue>>>19|Re<<13)^(Re>>>29|Ue<<3)^Ue>>>6,V=(Re>>>19|Ue<<13)^(Ue>>>29|Re<<3)^(Re>>>6|Ue<<26),ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,g[He]=W&65535|Y<<16,w[He]=ee&65535|Q<<16}A=q,V=I,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=y[0],V=b[0],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[0]=q=W&65535|Y<<16,b[0]=I=ee&65535|Q<<16,A=J,V=L,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=y[1],V=b[1],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[1]=J=W&65535|Y<<16,b[1]=L=ee&65535|Q<<16,A=oe,V=K,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=y[2],V=b[2],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[2]=oe=W&65535|Y<<16,b[2]=K=ee&65535|Q<<16,A=fe,V=ce,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=y[3],V=b[3],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[3]=fe=W&65535|Y<<16,b[3]=ce=ee&65535|Q<<16,A=C,V=ae,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=y[4],V=b[4],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[4]=C=W&65535|Y<<16,b[4]=ae=ee&65535|Q<<16,A=$,V=Ee,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=y[5],V=b[5],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[5]=$=W&65535|Y<<16,b[5]=Ee=ee&65535|Q<<16,A=U,V=Ne,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=y[6],V=b[6],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[6]=U=W&65535|Y<<16,b[6]=Ne=ee&65535|Q<<16,A=M,V=et,ee=V&65535,Q=V>>>16,W=A&65535,Y=A>>>16,A=y[7],V=b[7],ee+=V&65535,Q+=V>>>16,W+=A&65535,Y+=A>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[7]=M=W&65535|Y<<16,b[7]=et=ee&65535|Q<<16,R+=128,F-=128}return R}function p(g){var w=new s;w.update(g);var y=w.digest();return w.clean(),y}o.hash=p})(Tf);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const r=To,t=Tf,s=ff;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a(j){const D=new Float64Array(16);if(j)for(let N=0;N<j.length;N++)D[N]=j[N];return D}const h=new Uint8Array(32);h[0]=9;const p=a(),g=a([1]),w=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),R=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function F(j,D){for(let N=0;N<16;N++)j[N]=D[N]|0}function q(j){let D=1;for(let N=0;N<16;N++){let u=j[N]+D+65535;D=Math.floor(u/65536),j[N]=u-D*65536}j[0]+=D-1+37*(D-1)}function J(j,D,N){const u=~(N-1);for(let E=0;E<16;E++){const ie=u&(j[E]^D[E]);j[E]^=ie,D[E]^=ie}}function oe(j,D){const N=a(),u=a();for(let E=0;E<16;E++)u[E]=D[E];q(u),q(u),q(u);for(let E=0;E<2;E++){N[0]=u[0]-65517;for(let pe=1;pe<15;pe++)N[pe]=u[pe]-65535-(N[pe-1]>>16&1),N[pe-1]&=65535;N[15]=u[15]-32767-(N[14]>>16&1);const ie=N[15]>>16&1;N[14]&=65535,J(u,N,1-ie)}for(let E=0;E<16;E++)j[2*E]=u[E]&255,j[2*E+1]=u[E]>>8}function fe(j,D){let N=0;for(let u=0;u<32;u++)N|=j[u]^D[u];return(1&N-1>>>8)-1}function C(j,D){const N=new Uint8Array(32),u=new Uint8Array(32);return oe(N,j),oe(u,D),fe(N,u)}function $(j){const D=new Uint8Array(32);return oe(D,j),D[0]&1}function U(j,D){for(let N=0;N<16;N++)j[N]=D[2*N]+(D[2*N+1]<<8);j[15]&=32767}function M(j,D,N){for(let u=0;u<16;u++)j[u]=D[u]+N[u]}function I(j,D,N){for(let u=0;u<16;u++)j[u]=D[u]-N[u]}function L(j,D,N){let u,E,ie=0,pe=0,ve=0,Te=0,$e=0,xe=0,St=0,vt=0,nt=0,Le=0,Je=0,Qe=0,ot=0,ze=0,Ye=0,Ae=0,Ke=0,ht=0,qe=0,Pt=0,Lt=0,Kt=0,Ft=0,Mt=0,Qt=0,or=0,Hr=0,Yt=0,Yr=0,di=0,Ri=0,lt=N[0],tt=N[1],ft=N[2],pt=N[3],at=N[4],rt=N[5],Ot=N[6],Ct=N[7],dt=N[8],Nt=N[9],gt=N[10],wt=N[11],yt=N[12],We=N[13],Rt=N[14],Tt=N[15];u=D[0],ie+=u*lt,pe+=u*tt,ve+=u*ft,Te+=u*pt,$e+=u*at,xe+=u*rt,St+=u*Ot,vt+=u*Ct,nt+=u*dt,Le+=u*Nt,Je+=u*gt,Qe+=u*wt,ot+=u*yt,ze+=u*We,Ye+=u*Rt,Ae+=u*Tt,u=D[1],pe+=u*lt,ve+=u*tt,Te+=u*ft,$e+=u*pt,xe+=u*at,St+=u*rt,vt+=u*Ot,nt+=u*Ct,Le+=u*dt,Je+=u*Nt,Qe+=u*gt,ot+=u*wt,ze+=u*yt,Ye+=u*We,Ae+=u*Rt,Ke+=u*Tt,u=D[2],ve+=u*lt,Te+=u*tt,$e+=u*ft,xe+=u*pt,St+=u*at,vt+=u*rt,nt+=u*Ot,Le+=u*Ct,Je+=u*dt,Qe+=u*Nt,ot+=u*gt,ze+=u*wt,Ye+=u*yt,Ae+=u*We,Ke+=u*Rt,ht+=u*Tt,u=D[3],Te+=u*lt,$e+=u*tt,xe+=u*ft,St+=u*pt,vt+=u*at,nt+=u*rt,Le+=u*Ot,Je+=u*Ct,Qe+=u*dt,ot+=u*Nt,ze+=u*gt,Ye+=u*wt,Ae+=u*yt,Ke+=u*We,ht+=u*Rt,qe+=u*Tt,u=D[4],$e+=u*lt,xe+=u*tt,St+=u*ft,vt+=u*pt,nt+=u*at,Le+=u*rt,Je+=u*Ot,Qe+=u*Ct,ot+=u*dt,ze+=u*Nt,Ye+=u*gt,Ae+=u*wt,Ke+=u*yt,ht+=u*We,qe+=u*Rt,Pt+=u*Tt,u=D[5],xe+=u*lt,St+=u*tt,vt+=u*ft,nt+=u*pt,Le+=u*at,Je+=u*rt,Qe+=u*Ot,ot+=u*Ct,ze+=u*dt,Ye+=u*Nt,Ae+=u*gt,Ke+=u*wt,ht+=u*yt,qe+=u*We,Pt+=u*Rt,Lt+=u*Tt,u=D[6],St+=u*lt,vt+=u*tt,nt+=u*ft,Le+=u*pt,Je+=u*at,Qe+=u*rt,ot+=u*Ot,ze+=u*Ct,Ye+=u*dt,Ae+=u*Nt,Ke+=u*gt,ht+=u*wt,qe+=u*yt,Pt+=u*We,Lt+=u*Rt,Kt+=u*Tt,u=D[7],vt+=u*lt,nt+=u*tt,Le+=u*ft,Je+=u*pt,Qe+=u*at,ot+=u*rt,ze+=u*Ot,Ye+=u*Ct,Ae+=u*dt,Ke+=u*Nt,ht+=u*gt,qe+=u*wt,Pt+=u*yt,Lt+=u*We,Kt+=u*Rt,Ft+=u*Tt,u=D[8],nt+=u*lt,Le+=u*tt,Je+=u*ft,Qe+=u*pt,ot+=u*at,ze+=u*rt,Ye+=u*Ot,Ae+=u*Ct,Ke+=u*dt,ht+=u*Nt,qe+=u*gt,Pt+=u*wt,Lt+=u*yt,Kt+=u*We,Ft+=u*Rt,Mt+=u*Tt,u=D[9],Le+=u*lt,Je+=u*tt,Qe+=u*ft,ot+=u*pt,ze+=u*at,Ye+=u*rt,Ae+=u*Ot,Ke+=u*Ct,ht+=u*dt,qe+=u*Nt,Pt+=u*gt,Lt+=u*wt,Kt+=u*yt,Ft+=u*We,Mt+=u*Rt,Qt+=u*Tt,u=D[10],Je+=u*lt,Qe+=u*tt,ot+=u*ft,ze+=u*pt,Ye+=u*at,Ae+=u*rt,Ke+=u*Ot,ht+=u*Ct,qe+=u*dt,Pt+=u*Nt,Lt+=u*gt,Kt+=u*wt,Ft+=u*yt,Mt+=u*We,Qt+=u*Rt,or+=u*Tt,u=D[11],Qe+=u*lt,ot+=u*tt,ze+=u*ft,Ye+=u*pt,Ae+=u*at,Ke+=u*rt,ht+=u*Ot,qe+=u*Ct,Pt+=u*dt,Lt+=u*Nt,Kt+=u*gt,Ft+=u*wt,Mt+=u*yt,Qt+=u*We,or+=u*Rt,Hr+=u*Tt,u=D[12],ot+=u*lt,ze+=u*tt,Ye+=u*ft,Ae+=u*pt,Ke+=u*at,ht+=u*rt,qe+=u*Ot,Pt+=u*Ct,Lt+=u*dt,Kt+=u*Nt,Ft+=u*gt,Mt+=u*wt,Qt+=u*yt,or+=u*We,Hr+=u*Rt,Yt+=u*Tt,u=D[13],ze+=u*lt,Ye+=u*tt,Ae+=u*ft,Ke+=u*pt,ht+=u*at,qe+=u*rt,Pt+=u*Ot,Lt+=u*Ct,Kt+=u*dt,Ft+=u*Nt,Mt+=u*gt,Qt+=u*wt,or+=u*yt,Hr+=u*We,Yt+=u*Rt,Yr+=u*Tt,u=D[14],Ye+=u*lt,Ae+=u*tt,Ke+=u*ft,ht+=u*pt,qe+=u*at,Pt+=u*rt,Lt+=u*Ot,Kt+=u*Ct,Ft+=u*dt,Mt+=u*Nt,Qt+=u*gt,or+=u*wt,Hr+=u*yt,Yt+=u*We,Yr+=u*Rt,di+=u*Tt,u=D[15],Ae+=u*lt,Ke+=u*tt,ht+=u*ft,qe+=u*pt,Pt+=u*at,Lt+=u*rt,Kt+=u*Ot,Ft+=u*Ct,Mt+=u*dt,Qt+=u*Nt,or+=u*gt,Hr+=u*wt,Yt+=u*yt,Yr+=u*We,di+=u*Rt,Ri+=u*Tt,ie+=38*Ke,pe+=38*ht,ve+=38*qe,Te+=38*Pt,$e+=38*Lt,xe+=38*Kt,St+=38*Ft,vt+=38*Mt,nt+=38*Qt,Le+=38*or,Je+=38*Hr,Qe+=38*Yt,ot+=38*Yr,ze+=38*di,Ye+=38*Ri,E=1,u=ie+E+65535,E=Math.floor(u/65536),ie=u-E*65536,u=pe+E+65535,E=Math.floor(u/65536),pe=u-E*65536,u=ve+E+65535,E=Math.floor(u/65536),ve=u-E*65536,u=Te+E+65535,E=Math.floor(u/65536),Te=u-E*65536,u=$e+E+65535,E=Math.floor(u/65536),$e=u-E*65536,u=xe+E+65535,E=Math.floor(u/65536),xe=u-E*65536,u=St+E+65535,E=Math.floor(u/65536),St=u-E*65536,u=vt+E+65535,E=Math.floor(u/65536),vt=u-E*65536,u=nt+E+65535,E=Math.floor(u/65536),nt=u-E*65536,u=Le+E+65535,E=Math.floor(u/65536),Le=u-E*65536,u=Je+E+65535,E=Math.floor(u/65536),Je=u-E*65536,u=Qe+E+65535,E=Math.floor(u/65536),Qe=u-E*65536,u=ot+E+65535,E=Math.floor(u/65536),ot=u-E*65536,u=ze+E+65535,E=Math.floor(u/65536),ze=u-E*65536,u=Ye+E+65535,E=Math.floor(u/65536),Ye=u-E*65536,u=Ae+E+65535,E=Math.floor(u/65536),Ae=u-E*65536,ie+=E-1+37*(E-1),E=1,u=ie+E+65535,E=Math.floor(u/65536),ie=u-E*65536,u=pe+E+65535,E=Math.floor(u/65536),pe=u-E*65536,u=ve+E+65535,E=Math.floor(u/65536),ve=u-E*65536,u=Te+E+65535,E=Math.floor(u/65536),Te=u-E*65536,u=$e+E+65535,E=Math.floor(u/65536),$e=u-E*65536,u=xe+E+65535,E=Math.floor(u/65536),xe=u-E*65536,u=St+E+65535,E=Math.floor(u/65536),St=u-E*65536,u=vt+E+65535,E=Math.floor(u/65536),vt=u-E*65536,u=nt+E+65535,E=Math.floor(u/65536),nt=u-E*65536,u=Le+E+65535,E=Math.floor(u/65536),Le=u-E*65536,u=Je+E+65535,E=Math.floor(u/65536),Je=u-E*65536,u=Qe+E+65535,E=Math.floor(u/65536),Qe=u-E*65536,u=ot+E+65535,E=Math.floor(u/65536),ot=u-E*65536,u=ze+E+65535,E=Math.floor(u/65536),ze=u-E*65536,u=Ye+E+65535,E=Math.floor(u/65536),Ye=u-E*65536,u=Ae+E+65535,E=Math.floor(u/65536),Ae=u-E*65536,ie+=E-1+37*(E-1),j[0]=ie,j[1]=pe,j[2]=ve,j[3]=Te,j[4]=$e,j[5]=xe,j[6]=St,j[7]=vt,j[8]=nt,j[9]=Le,j[10]=Je,j[11]=Qe,j[12]=ot,j[13]=ze,j[14]=Ye,j[15]=Ae}function K(j,D){L(j,D,D)}function ce(j,D){const N=a();let u;for(u=0;u<16;u++)N[u]=D[u];for(u=253;u>=0;u--)K(N,N),u!==2&&u!==4&&L(N,N,D);for(u=0;u<16;u++)j[u]=N[u]}function ae(j,D){const N=a();let u;for(u=0;u<16;u++)N[u]=D[u];for(u=250;u>=0;u--)K(N,N),u!==1&&L(N,N,D);for(u=0;u<16;u++)j[u]=N[u]}function Ee(j,D){const N=a(),u=a(),E=a(),ie=a(),pe=a(),ve=a(),Te=a(),$e=a(),xe=a();I(N,j[1],j[0]),I(xe,D[1],D[0]),L(N,N,xe),M(u,j[0],j[1]),M(xe,D[0],D[1]),L(u,u,xe),L(E,j[3],D[3]),L(E,E,y),L(ie,j[2],D[2]),M(ie,ie,ie),I(pe,u,N),I(ve,ie,E),M(Te,ie,E),M($e,u,N),L(j[0],pe,ve),L(j[1],$e,Te),L(j[2],Te,ve),L(j[3],pe,$e)}function Ne(j,D,N){for(let u=0;u<4;u++)J(j[u],D[u],N)}function et(j,D){const N=a(),u=a(),E=a();ce(E,D[2]),L(N,D[0],E),L(u,D[1],E),oe(j,u),j[31]^=$(N)<<7}function A(j,D,N){F(j[0],p),F(j[1],g),F(j[2],g),F(j[3],p);for(let u=255;u>=0;--u){const E=N[u/8|0]>>(u&7)&1;Ne(j,D,E),Ee(D,j),Ee(j,j),Ne(j,D,E)}}function V(j,D){const N=[a(),a(),a(),a()];F(N[0],b),F(N[1],S),F(N[2],g),L(N[3],b,S),A(j,N,D)}function Ue(j){if(j.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const D=(0,t.hash)(j);D[0]&=248,D[31]&=127,D[31]|=64;const N=new Uint8Array(32),u=[a(),a(),a(),a()];V(u,D),et(N,u);const E=new Uint8Array(64);return E.set(j),E.set(N,32),{publicKey:N,secretKey:E}}o.generateKeyPairFromSeed=Ue;function Re(j){const D=(0,r.randomBytes)(32,j),N=Ue(D);return(0,s.wipe)(D),N}o.generateKeyPair=Re;function ee(j){if(j.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(j.subarray(32))}o.extractPublicKeyFromSecretKey=ee;const Q=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function W(j,D){let N,u,E,ie;for(u=63;u>=32;--u){for(N=0,E=u-32,ie=u-12;E<ie;++E)D[E]+=N-16*D[u]*Q[E-(u-32)],N=Math.floor((D[E]+128)/256),D[E]-=N*256;D[E]+=N,D[u]=0}for(N=0,E=0;E<32;E++)D[E]+=N-(D[31]>>4)*Q[E],N=D[E]>>8,D[E]&=255;for(E=0;E<32;E++)D[E]-=N*Q[E];for(u=0;u<32;u++)D[u+1]+=D[u]>>8,j[u]=D[u]&255}function Y(j){const D=new Float64Array(64);for(let N=0;N<64;N++)D[N]=j[N];for(let N=0;N<64;N++)j[N]=0;W(j,D)}function ut(j,D){const N=new Float64Array(64),u=[a(),a(),a(),a()],E=(0,t.hash)(j.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const ie=new Uint8Array(64);ie.set(E.subarray(32),32);const pe=new t.SHA512;pe.update(ie.subarray(32)),pe.update(D);const ve=pe.digest();pe.clean(),Y(ve),V(u,ve),et(ie,u),pe.reset(),pe.update(ie.subarray(0,32)),pe.update(j.subarray(32)),pe.update(D);const Te=pe.digest();Y(Te);for(let $e=0;$e<32;$e++)N[$e]=ve[$e];for(let $e=0;$e<32;$e++)for(let xe=0;xe<32;xe++)N[$e+xe]+=Te[$e]*E[xe];return W(ie.subarray(32),N),ie}o.sign=ut;function He(j,D){const N=a(),u=a(),E=a(),ie=a(),pe=a(),ve=a(),Te=a();return F(j[2],g),U(j[1],D),K(E,j[1]),L(ie,E,w),I(E,E,j[2]),M(ie,j[2],ie),K(pe,ie),K(ve,pe),L(Te,ve,pe),L(N,Te,E),L(N,N,ie),ae(N,N),L(N,N,E),L(N,N,ie),L(N,N,ie),L(j[0],N,ie),K(u,j[0]),L(u,u,ie),C(u,E)&&L(j[0],j[0],R),K(u,j[0]),L(u,u,ie),C(u,E)?-1:($(j[0])===D[31]>>7&&I(j[0],p,j[0]),L(j[3],j[0],j[1]),0)}function kr(j,D,N){const u=new Uint8Array(32),E=[a(),a(),a(),a()],ie=[a(),a(),a(),a()];if(N.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(He(ie,j))return!1;const pe=new t.SHA512;pe.update(N.subarray(0,32)),pe.update(j),pe.update(D);const ve=pe.digest();return Y(ve),A(E,ie,ve),V(ie,N.subarray(32)),Ee(E,ie),et(u,E),!fe(N,u)}o.verify=kr;function be(j){let D=[a(),a(),a(),a()];if(He(D,j))throw new Error("Ed25519: invalid public key");let N=a(),u=a(),E=D[1];M(N,g,E),I(u,g,E),ce(u,u),L(N,N,u);let ie=new Uint8Array(32);return oe(ie,N),ie}o.convertPublicKeyToX25519=be;function xt(j){const D=(0,t.hash)(j.subarray(0,32));D[0]&=248,D[31]&=127,D[31]|=64;const N=new Uint8Array(D.subarray(0,32));return(0,s.wipe)(D),N}o.convertSecretKeyToX25519=xt})(Gc);const __="EdDSA",E_="JWT",Af=".",$f="base64url",I_="utf8",x_="utf8",S_=":",P_="did",O_="key",Ol="base58btc",C_="z",N_="K36",R_=32;function Co(o){return nr(gr(nn(o),I_),$f)}function Df(o){const r=gr(N_,Ol),t=C_+nr(Ic([r,o]),Ol);return[P_,O_,t].join(S_)}function T_(o){return nr(o,$f)}function A_(o){return gr([Co(o.header),Co(o.payload)].join(Af),x_)}function $_(o){return[Co(o.header),Co(o.payload),T_(o.signature)].join(Af)}function Cl(o=To.randomBytes(R_)){return Gc.generateKeyPairFromSeed(o)}async function D_(o,r,t,s,a=ne.fromMiliseconds(Date.now())){const h={alg:__,typ:E_},p=Df(s.publicKey),g=a+t,w={iss:p,sub:o,aud:r,iat:a,exp:g},y=A_({header:h,payload:w}),b=Gc.sign(s.secretKey,y);return $_({header:h,payload:w,signature:b})}const L_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),j_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Nl=o=>o.split("?")[0],Rl=10,q_=L_();let M_=class{constructor(r){if(this.url=r,this.events=new Qr.EventEmitter,this.registering=!1,!Zh(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}off(r,t){this.events.off(r,t)}removeListener(r,t){this.events.removeListener(r,t)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),r()},this.socket.close()})}async send(r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(nn(r))}catch(t){this.onError(r.id,t)}}register(r=this.url){if(!Zh(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((s,a)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),a(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=r,this.registering=!0,new Promise((t,s)=>{const a=new URLSearchParams(r).get("origin"),h=rw.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!iw(r)},p=new q_(r,[],h);j_()?p.onerror=g=>{const w=g;s(this.emitError(w.error))}:p.on("error",g=>{s(this.emitError(g))}),p.onopen=()=>{this.onOpen(p),t(p)}})}onOpen(r){r.onmessage=t=>this.onPayload(t),r.onclose=t=>this.onClose(t),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const t=typeof r.data=="string"?Ao(r.data):r.data;this.events.emit("payload",t)}onError(r,t){const s=this.parseError(t),a=s.message||s.toString(),h=qc(r,a);this.events.emit("payload",h)}parseError(r,t=this.url){return sw(r,Nl(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Rl&&this.events.setMaxListeners(Rl)}emitError(r){const t=this.parseError(new Error(r?.message||`WebSocket connection failed for host: ${Nl(this.url)}`));return this.events.emit("register_error",t),t}};var No={exports:{}};No.exports;(function(o,r){var t=200,s="__lodash_hash_undefined__",a=1,h=2,p=9007199254740991,g="[object Arguments]",w="[object Array]",y="[object AsyncFunction]",b="[object Boolean]",S="[object Date]",R="[object Error]",F="[object Function]",q="[object GeneratorFunction]",J="[object Map]",oe="[object Number]",fe="[object Null]",C="[object Object]",$="[object Promise]",U="[object Proxy]",M="[object RegExp]",I="[object Set]",L="[object String]",K="[object Symbol]",ce="[object Undefined]",ae="[object WeakMap]",Ee="[object ArrayBuffer]",Ne="[object DataView]",et="[object Float32Array]",A="[object Float64Array]",V="[object Int8Array]",Ue="[object Int16Array]",Re="[object Int32Array]",ee="[object Uint8Array]",Q="[object Uint8ClampedArray]",W="[object Uint16Array]",Y="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,He=/^\[object .+?Constructor\]$/,kr=/^(?:0|[1-9]\d*)$/,be={};be[et]=be[A]=be[V]=be[Ue]=be[Re]=be[ee]=be[Q]=be[W]=be[Y]=!0,be[g]=be[w]=be[Ee]=be[b]=be[Ne]=be[S]=be[R]=be[F]=be[J]=be[oe]=be[C]=be[M]=be[I]=be[L]=be[ae]=!1;var xt=typeof go=="object"&&go&&go.Object===Object&&go,j=typeof self=="object"&&self&&self.Object===Object&&self,D=xt||j||Function("return this")(),N=r&&!r.nodeType&&r,u=N&&!0&&o&&!o.nodeType&&o,E=u&&u.exports===N,ie=E&&xt.process,pe=function(){try{return ie&&ie.binding&&ie.binding("util")}catch{}}(),ve=pe&&pe.isTypedArray;function Te(m,x){for(var B=-1,te=m==null?0:m.length,Ve=0,ge=[];++B<te;){var Ze=m[B];x(Ze,B,m)&&(ge[Ve++]=Ze)}return ge}function $e(m,x){for(var B=-1,te=x.length,Ve=m.length;++B<te;)m[Ve+B]=x[B];return m}function xe(m,x){for(var B=-1,te=m==null?0:m.length;++B<te;)if(x(m[B],B,m))return!0;return!1}function St(m,x){for(var B=-1,te=Array(m);++B<m;)te[B]=x(B);return te}function vt(m){return function(x){return m(x)}}function nt(m,x){return m.has(x)}function Le(m,x){return m?.[x]}function Je(m){var x=-1,B=Array(m.size);return m.forEach(function(te,Ve){B[++x]=[Ve,te]}),B}function Qe(m,x){return function(B){return m(x(B))}}function ot(m){var x=-1,B=Array(m.size);return m.forEach(function(te){B[++x]=te}),B}var ze=Array.prototype,Ye=Function.prototype,Ae=Object.prototype,Ke=D["__core-js_shared__"],ht=Ye.toString,qe=Ae.hasOwnProperty,Pt=function(){var m=/[^.]+$/.exec(Ke&&Ke.keys&&Ke.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Lt=Ae.toString,Kt=RegExp("^"+ht.call(qe).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ft=E?D.Buffer:void 0,Mt=D.Symbol,Qt=D.Uint8Array,or=Ae.propertyIsEnumerable,Hr=ze.splice,Yt=Mt?Mt.toStringTag:void 0,Yr=Object.getOwnPropertySymbols,di=Ft?Ft.isBuffer:void 0,Ri=Qe(Object.keys,Object),lt=yr(D,"DataView"),tt=yr(D,"Map"),ft=yr(D,"Promise"),pt=yr(D,"Set"),at=yr(D,"WeakMap"),rt=yr(Object,"create"),Ot=Xr(lt),Ct=Xr(tt),dt=Xr(ft),Nt=Xr(pt),gt=Xr(at),wt=Mt?Mt.prototype:void 0,yt=wt?wt.valueOf:void 0;function We(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function Rt(){this.__data__=rt?rt(null):{},this.size=0}function Tt(m){var x=this.has(m)&&delete this.__data__[m];return this.size-=x?1:0,x}function Lo(m){var x=this.__data__;if(rt){var B=x[m];return B===s?void 0:B}return qe.call(x,m)?x[m]:void 0}function jo(m){var x=this.__data__;return rt?x[m]!==void 0:qe.call(x,m)}function qo(m,x){var B=this.__data__;return this.size+=this.has(m)?0:1,B[m]=rt&&x===void 0?s:x,this}We.prototype.clear=Rt,We.prototype.delete=Tt,We.prototype.get=Lo,We.prototype.has=jo,We.prototype.set=qo;function Ir(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function Mo(){this.__data__=[],this.size=0}function Uo(m){var x=this.__data__,B=Ti(x,m);if(B<0)return!1;var te=x.length-1;return B==te?x.pop():Hr.call(x,B,1),--this.size,!0}function zo(m){var x=this.__data__,B=Ti(x,m);return B<0?void 0:x[B][1]}function ko(m){return Ti(this.__data__,m)>-1}function Ho(m,x){var B=this.__data__,te=Ti(B,m);return te<0?(++this.size,B.push([m,x])):B[te][1]=x,this}Ir.prototype.clear=Mo,Ir.prototype.delete=Uo,Ir.prototype.get=zo,Ir.prototype.has=ko,Ir.prototype.set=Ho;function Zr(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function Yi(){this.size=0,this.__data__={hash:new We,map:new(tt||Ir),string:new We}}function Ko(m){var x=gi(this,m).delete(m);return this.size-=x?1:0,x}function Zi(m){return gi(this,m).get(m)}function Fo(m){return gi(this,m).has(m)}function Vo(m,x){var B=gi(this,m),te=B.size;return B.set(m,x),this.size+=B.size==te?0:1,this}Zr.prototype.clear=Yi,Zr.prototype.delete=Ko,Zr.prototype.get=Zi,Zr.prototype.has=Fo,Zr.prototype.set=Vo;function Xi(m){var x=-1,B=m==null?0:m.length;for(this.__data__=new Zr;++x<B;)this.add(m[x])}function hn(m){return this.__data__.set(m,s),this}function ln(m){return this.__data__.has(m)}Xi.prototype.add=Xi.prototype.push=hn,Xi.prototype.has=ln;function $r(m){var x=this.__data__=new Ir(m);this.size=x.size}function Bo(){this.__data__=new Ir,this.size=0}function Go(m){var x=this.__data__,B=x.delete(m);return this.size=x.size,B}function Wo(m){return this.__data__.get(m)}function Jo(m){return this.__data__.has(m)}function fn(m,x){var B=this.__data__;if(B instanceof Ir){var te=B.__data__;if(!tt||te.length<t-1)return te.push([m,x]),this.size=++B.size,this;B=this.__data__=new Zr(te)}return B.set(m,x),this.size=B.size,this}$r.prototype.clear=Bo,$r.prototype.delete=Go,$r.prototype.get=Wo,$r.prototype.has=Jo,$r.prototype.set=fn;function pn(m,x){var B=rs(m),te=!B&&Sn(m),Ve=!B&&!te&&Os(m),ge=!B&&!te&&!Ve&&Cn(m),Ze=B||te||Ve||ge,At=Ze?St(m.length,String):[],Pe=At.length;for(var Be in m)(x||qe.call(m,Be))&&!(Ze&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||ge&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||bn(Be,Pe)))&&At.push(Be);return At}function Ti(m,x){for(var B=m.length;B--;)if(xn(m[B][0],x))return B;return-1}function Ss(m,x,B){var te=x(m);return rs(m)?te:$e(te,B(m))}function Ai(m){return m==null?m===void 0?ce:fe:Yt&&Yt in Object(m)?vn(m):Zo(m)}function Ps(m){return Di(m)&&Ai(m)==g}function $i(m,x,B,te,Ve){return m===x?!0:m==null||x==null||!Di(m)&&!Di(x)?m!==m&&x!==x:dn(m,x,B,te,$i,Ve)}function dn(m,x,B,te,Ve,ge){var Ze=rs(m),At=rs(x),Pe=Ze?w:Kr(m),Be=At?w:Kr(x);Pe=Pe==g?C:Pe,Be=Be==g?C:Be;var bt=Pe==C,ar=Be==C,$t=Pe==Be;if($t&&Os(m)){if(!Os(x))return!1;Ze=!0,bt=!1}if($t&&!bt)return ge||(ge=new $r),Ze||Cn(m)?es(m,x,B,te,Ve,ge):Yo(m,x,Pe,B,te,Ve,ge);if(!(B&a)){var Xe=bt&&qe.call(m,"__wrapped__"),Zt=ar&&qe.call(x,"__wrapped__");if(Xe||Zt){var Dr=Xe?m.value():m,xr=Zt?x.value():x;return ge||(ge=new $r),Ve(Dr,xr,B,te,ge)}}return $t?(ge||(ge=new $r),mn(m,x,B,te,Ve,ge)):!1}function Qo(m){if(!On(m)||En(m))return!1;var x=is(m)?Kt:He;return x.test(Xr(m))}function gn(m){return Di(m)&&Pn(m.length)&&!!be[Ai(m)]}function yn(m){if(!In(m))return Ri(m);var x=[];for(var B in Object(m))qe.call(m,B)&&B!="constructor"&&x.push(B);return x}function es(m,x,B,te,Ve,ge){var Ze=B&a,At=m.length,Pe=x.length;if(At!=Pe&&!(Ze&&Pe>At))return!1;var Be=ge.get(m);if(Be&&ge.get(x))return Be==x;var bt=-1,ar=!0,$t=B&h?new Xi:void 0;for(ge.set(m,x),ge.set(x,m);++bt<At;){var Xe=m[bt],Zt=x[bt];if(te)var Dr=Ze?te(Zt,Xe,bt,x,m,ge):te(Xe,Zt,bt,m,x,ge);if(Dr!==void 0){if(Dr)continue;ar=!1;break}if($t){if(!xe(x,function(xr,Fr){if(!nt($t,Fr)&&(Xe===xr||Ve(Xe,xr,B,te,ge)))return $t.push(Fr)})){ar=!1;break}}else if(!(Xe===Zt||Ve(Xe,Zt,B,te,ge))){ar=!1;break}}return ge.delete(m),ge.delete(x),ar}function Yo(m,x,B,te,Ve,ge,Ze){switch(B){case Ne:if(m.byteLength!=x.byteLength||m.byteOffset!=x.byteOffset)return!1;m=m.buffer,x=x.buffer;case Ee:return!(m.byteLength!=x.byteLength||!ge(new Qt(m),new Qt(x)));case b:case S:case oe:return xn(+m,+x);case R:return m.name==x.name&&m.message==x.message;case M:case L:return m==x+"";case J:var At=Je;case I:var Pe=te&a;if(At||(At=ot),m.size!=x.size&&!Pe)return!1;var Be=Ze.get(m);if(Be)return Be==x;te|=h,Ze.set(m,x);var bt=es(At(m),At(x),te,Ve,ge,Ze);return Ze.delete(m),bt;case K:if(yt)return yt.call(m)==yt.call(x)}return!1}function mn(m,x,B,te,Ve,ge){var Ze=B&a,At=ts(m),Pe=At.length,Be=ts(x),bt=Be.length;if(Pe!=bt&&!Ze)return!1;for(var ar=Pe;ar--;){var $t=At[ar];if(!(Ze?$t in x:qe.call(x,$t)))return!1}var Xe=ge.get(m);if(Xe&&ge.get(x))return Xe==x;var Zt=!0;ge.set(m,x),ge.set(x,m);for(var Dr=Ze;++ar<Pe;){$t=At[ar];var xr=m[$t],Fr=x[$t];if(te)var Cs=Ze?te(Fr,xr,$t,x,m,ge):te(xr,Fr,$t,m,x,ge);if(!(Cs===void 0?xr===Fr||Ve(xr,Fr,B,te,ge):Cs)){Zt=!1;break}Dr||(Dr=$t=="constructor")}if(Zt&&!Dr){var Li=m.constructor,Ut=x.constructor;Li!=Ut&&"constructor"in m&&"constructor"in x&&!(typeof Li=="function"&&Li instanceof Li&&typeof Ut=="function"&&Ut instanceof Ut)&&(Zt=!1)}return ge.delete(m),ge.delete(x),Zt}function ts(m){return Ss(m,ta,wn)}function gi(m,x){var B=m.__data__;return _n(x)?B[typeof x=="string"?"string":"hash"]:B.map}function yr(m,x){var B=Le(m,x);return Qo(B)?B:void 0}function vn(m){var x=qe.call(m,Yt),B=m[Yt];try{m[Yt]=void 0;var te=!0}catch{}var Ve=Lt.call(m);return te&&(x?m[Yt]=B:delete m[Yt]),Ve}var wn=Yr?function(m){return m==null?[]:(m=Object(m),Te(Yr(m),function(x){return or.call(m,x)}))}:Fe,Kr=Ai;(lt&&Kr(new lt(new ArrayBuffer(1)))!=Ne||tt&&Kr(new tt)!=J||ft&&Kr(ft.resolve())!=$||pt&&Kr(new pt)!=I||at&&Kr(new at)!=ae)&&(Kr=function(m){var x=Ai(m),B=x==C?m.constructor:void 0,te=B?Xr(B):"";if(te)switch(te){case Ot:return Ne;case Ct:return J;case dt:return $;case Nt:return I;case gt:return ae}return x});function bn(m,x){return x=x??p,!!x&&(typeof m=="number"||kr.test(m))&&m>-1&&m%1==0&&m<x}function _n(m){var x=typeof m;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?m!=="__proto__":m===null}function En(m){return!!Pt&&Pt in m}function In(m){var x=m&&m.constructor,B=typeof x=="function"&&x.prototype||Ae;return m===B}function Zo(m){return Lt.call(m)}function Xr(m){if(m!=null){try{return ht.call(m)}catch{}try{return m+""}catch{}}return""}function xn(m,x){return m===x||m!==m&&x!==x}var Sn=Ps(function(){return arguments}())?Ps:function(m){return Di(m)&&qe.call(m,"callee")&&!or.call(m,"callee")},rs=Array.isArray;function Xo(m){return m!=null&&Pn(m.length)&&!is(m)}var Os=di||ke;function ea(m,x){return $i(m,x)}function is(m){if(!On(m))return!1;var x=Ai(m);return x==F||x==q||x==y||x==U}function Pn(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=p}function On(m){var x=typeof m;return m!=null&&(x=="object"||x=="function")}function Di(m){return m!=null&&typeof m=="object"}var Cn=ve?vt(ve):gn;function ta(m){return Xo(m)?pn(m):yn(m)}function Fe(){return[]}function ke(){return!1}o.exports=ea})(No,No.exports);var U_=No.exports;const z_=X0(U_);var k_={};function H_(o,r){if(o.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var a=0;a<o.length;a++){var h=o.charAt(a),p=h.charCodeAt(0);if(t[p]!==255)throw new TypeError(h+" is ambiguous");t[p]=a}var g=o.length,w=o.charAt(0),y=Math.log(g)/Math.log(256),b=Math.log(256)/Math.log(g);function S(q){if(q instanceof Uint8Array||(ArrayBuffer.isView(q)?q=new Uint8Array(q.buffer,q.byteOffset,q.byteLength):Array.isArray(q)&&(q=Uint8Array.from(q))),!(q instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(q.length===0)return"";for(var J=0,oe=0,fe=0,C=q.length;fe!==C&&q[fe]===0;)fe++,J++;for(var $=(C-fe)*b+1>>>0,U=new Uint8Array($);fe!==C;){for(var M=q[fe],I=0,L=$-1;(M!==0||I<oe)&&L!==-1;L--,I++)M+=256*U[L]>>>0,U[L]=M%g>>>0,M=M/g>>>0;if(M!==0)throw new Error("Non-zero carry");oe=I,fe++}for(var K=$-oe;K!==$&&U[K]===0;)K++;for(var ce=w.repeat(J);K<$;++K)ce+=o.charAt(U[K]);return ce}function R(q){if(typeof q!="string")throw new TypeError("Expected String");if(q.length===0)return new Uint8Array;var J=0;if(q[J]!==" "){for(var oe=0,fe=0;q[J]===w;)oe++,J++;for(var C=(q.length-J)*y+1>>>0,$=new Uint8Array(C);q[J];){var U=t[q.charCodeAt(J)];if(U===255)return;for(var M=0,I=C-1;(U!==0||M<fe)&&I!==-1;I--,M++)U+=g*$[I]>>>0,$[I]=U%256>>>0,U=U/256>>>0;if(U!==0)throw new Error("Non-zero carry");fe=M,J++}if(q[J]!==" "){for(var L=C-fe;L!==C&&$[L]===0;)L++;for(var K=new Uint8Array(oe+(C-L)),ce=oe;L!==C;)K[ce++]=$[L++];return K}}}function F(q){var J=R(q);if(J)return J;throw new Error(`Non-${r} character`)}return{encode:S,decodeUnsafe:R,decode:F}}var K_=H_,F_=K_;const Lf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},V_=o=>new TextEncoder().encode(o),B_=o=>new TextDecoder().decode(o);class G_{constructor(r,t,s){this.name=r,this.prefix=t,this.baseEncode=s}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class W_{constructor(r,t,s){if(this.name=r,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return jf(this,r)}}let J_=class{constructor(r){this.decoders=r}or(r){return jf(this,r)}decode(r){const t=r[0],s=this.decoders[t];if(s)return s.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const jf=(o,r)=>new J_({...o.decoders||{[o.prefix]:o},...r.decoders||{[r.prefix]:r}});class Q_{constructor(r,t,s,a){this.name=r,this.prefix=t,this.baseEncode=s,this.baseDecode=a,this.encoder=new G_(r,t,s),this.decoder=new W_(r,t,a)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const $o=({name:o,prefix:r,encode:t,decode:s})=>new Q_(o,r,t,s),un=({prefix:o,name:r,alphabet:t})=>{const{encode:s,decode:a}=F_(t,r);return $o({prefix:o,name:r,encode:s,decode:h=>Lf(a(h))})},Y_=(o,r,t,s)=>{const a={};for(let b=0;b<r.length;++b)a[r[b]]=b;let h=o.length;for(;o[h-1]==="=";)--h;const p=new Uint8Array(h*t/8|0);let g=0,w=0,y=0;for(let b=0;b<h;++b){const S=a[o[b]];if(S===void 0)throw new SyntaxError(`Non-${s} character`);w=w<<t|S,g+=t,g>=8&&(g-=8,p[y++]=255&w>>g)}if(g>=t||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return p},Z_=(o,r,t)=>{const s=r[r.length-1]==="=",a=(1<<t)-1;let h="",p=0,g=0;for(let w=0;w<o.length;++w)for(g=g<<8|o[w],p+=8;p>t;)p-=t,h+=r[a&g>>p];if(p&&(h+=r[a&g<<t-p]),s)for(;h.length*t&7;)h+="=";return h},Bt=({name:o,prefix:r,bitsPerChar:t,alphabet:s})=>$o({prefix:r,name:o,encode(a){return Z_(a,s,t)},decode(a){return Y_(a,s,t,o)}}),X_=$o({prefix:"\0",name:"identity",encode:o=>B_(o),decode:o=>V_(o)});var e1=Object.freeze({__proto__:null,identity:X_});const t1=Bt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var r1=Object.freeze({__proto__:null,base2:t1});const i1=Bt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var s1=Object.freeze({__proto__:null,base8:i1});const n1=un({prefix:"9",name:"base10",alphabet:"0123456789"});var o1=Object.freeze({__proto__:null,base10:n1});const a1=Bt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),c1=Bt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var u1=Object.freeze({__proto__:null,base16:a1,base16upper:c1});const h1=Bt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),l1=Bt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),f1=Bt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),p1=Bt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),d1=Bt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),g1=Bt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),y1=Bt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),m1=Bt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),v1=Bt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var w1=Object.freeze({__proto__:null,base32:h1,base32upper:l1,base32pad:f1,base32padupper:p1,base32hex:d1,base32hexupper:g1,base32hexpad:y1,base32hexpadupper:m1,base32z:v1});const b1=un({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_1=un({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var E1=Object.freeze({__proto__:null,base36:b1,base36upper:_1});const I1=un({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),x1=un({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var S1=Object.freeze({__proto__:null,base58btc:I1,base58flickr:x1});const P1=Bt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),O1=Bt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),C1=Bt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),N1=Bt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var R1=Object.freeze({__proto__:null,base64:P1,base64pad:O1,base64url:C1,base64urlpad:N1});const qf=Array.from(""),T1=qf.reduce((o,r,t)=>(o[t]=r,o),[]),A1=qf.reduce((o,r,t)=>(o[r.codePointAt(0)]=t,o),[]);function $1(o){return o.reduce((r,t)=>(r+=T1[t],r),"")}function D1(o){const r=[];for(const t of o){const s=A1[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);r.push(s)}return new Uint8Array(r)}const L1=$o({prefix:"",name:"base256emoji",encode:$1,decode:D1});var j1=Object.freeze({__proto__:null,base256emoji:L1}),q1=Mf,Tl=128,M1=127,U1=~M1,z1=Math.pow(2,31);function Mf(o,r,t){r=r||[],t=t||0;for(var s=t;o>=z1;)r[t++]=o&255|Tl,o/=128;for(;o&U1;)r[t++]=o&255|Tl,o>>>=7;return r[t]=o|0,Mf.bytes=t-s+1,r}var k1=Nc,H1=128,Al=127;function Nc(o,s){var t=0,s=s||0,a=0,h=s,p,g=o.length;do{if(h>=g)throw Nc.bytes=0,new RangeError("Could not decode varint");p=o[h++],t+=a<28?(p&Al)<<a:(p&Al)*Math.pow(2,a),a+=7}while(p>=H1);return Nc.bytes=h-s,t}var K1=Math.pow(2,7),F1=Math.pow(2,14),V1=Math.pow(2,21),B1=Math.pow(2,28),G1=Math.pow(2,35),W1=Math.pow(2,42),J1=Math.pow(2,49),Q1=Math.pow(2,56),Y1=Math.pow(2,63),Z1=function(o){return o<K1?1:o<F1?2:o<V1?3:o<B1?4:o<G1?5:o<W1?6:o<J1?7:o<Q1?8:o<Y1?9:10},X1={encode:q1,decode:k1,encodingLength:Z1},Uf=X1;const $l=(o,r,t=0)=>(Uf.encode(o,r,t),r),Dl=o=>Uf.encodingLength(o),Rc=(o,r)=>{const t=r.byteLength,s=Dl(o),a=s+Dl(t),h=new Uint8Array(a+t);return $l(o,h,0),$l(t,h,s),h.set(r,a),new eE(o,t,r,h)};class eE{constructor(r,t,s,a){this.code=r,this.size=t,this.digest=s,this.bytes=a}}const zf=({name:o,code:r,encode:t})=>new tE(o,r,t);class tE{constructor(r,t,s){this.name=r,this.code=t,this.encode=s}digest(r){if(r instanceof Uint8Array){const t=this.encode(r);return t instanceof Uint8Array?Rc(this.code,t):t.then(s=>Rc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const kf=o=>async r=>new Uint8Array(await crypto.subtle.digest(o,r)),rE=zf({name:"sha2-256",code:18,encode:kf("SHA-256")}),iE=zf({name:"sha2-512",code:19,encode:kf("SHA-512")});var sE=Object.freeze({__proto__:null,sha256:rE,sha512:iE});const Hf=0,nE="identity",Kf=Lf,oE=o=>Rc(Hf,Kf(o)),aE={code:Hf,name:nE,encode:Kf,digest:oE};var cE=Object.freeze({__proto__:null,identity:aE});new TextEncoder,new TextDecoder;const Ll={...e1,...r1,...s1,...o1,...u1,...w1,...E1,...S1,...R1,...j1};({...sE,...cE});function Ff(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function uE(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ff(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function Vf(o,r,t,s){return{name:o,prefix:r,encoder:{name:o,prefix:r,encode:t},decoder:{decode:s}}}const jl=Vf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),dc=Vf("ascii","a",o=>{let r="a";for(let t=0;t<o.length;t++)r+=String.fromCharCode(o[t]);return r},o=>{o=o.substring(1);const r=uE(o.length);for(let t=0;t<o.length;t++)r[t]=o.charCodeAt(t);return r}),hE={utf8:jl,"utf-8":jl,hex:Ll.base16,latin1:dc,ascii:dc,binary:dc,...Ll};function lE(o,r="utf8"){const t=hE[r];if(!t)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ff(globalThis.Buffer.from(o,"utf-8")):t.decoder.decode(`${t.prefix}${o}`)}const Bf="wc",fE=2,Wc="core",Oi=`${Bf}@2:${Wc}:`,pE={name:Wc,logger:"error"},dE={database:":memory:"},gE="crypto",ql="client_ed25519_seed",yE=ne.ONE_DAY,mE="keychain",vE="0.3",wE="messages",bE="0.3",_E=ne.SIX_HOURS,EE="publisher",Gf="irn",IE="error",Wf="wss://relay.walletconnect.com",Ml="wss://relay.walletconnect.org",xE="relayer",Jt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},SE="_subscription",ui={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},PE=ne.ONE_SECOND,OE="2.10.6",CE=1e4,NE="0.3",RE="WALLETCONNECT_CLIENT_ID",Ur={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},TE="subscription",AE="0.3",$E=ne.FIVE_SECONDS*1e3,DE="pairing",LE="0.3",Bs={wc_pairingDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:0},res:{ttl:ne.ONE_DAY,prompt:!1,tag:0}}},Zs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Wr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},jE="history",qE="0.3",ME="expirer",Ar={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},UE="0.3",gc="verify-api",vs="https://verify.walletconnect.com",Tc="https://verify.walletconnect.org",zE=[vs,Tc];class kE{constructor(r,t){this.core=r,this.logger=t,this.keychain=new Map,this.name=mE,this.version=vE,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:h}=Z("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(h)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=r,this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,bf(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?_f(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class HE{constructor(r,t,s){this.core=r,this.logger=t,this.name=gE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),h=Cl(a);return Df(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=fw();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const h=await this.getClientSeed(),p=Cl(h),g=Pc();return await D_(g,a,yE,p)},this.generateSharedKey=(a,h,p)=>{this.isInitialized();const g=this.getPrivateKey(a),w=pw(g,h);return this.setSymKey(w,p)},this.setSymKey=async(a,h)=>{this.isInitialized();const p=h||dw(a);return await this.keychain.set(p,a),p},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,h,p)=>{this.isInitialized();const g=wf(p),w=nn(h);if(rl(g)){const R=g.senderPublicKey,F=g.receiverPublicKey;a=await this.generateSharedKey(R,F)}const y=this.getSymKey(a),{type:b,senderPublicKey:S}=g;return yw({type:b,symKey:y,message:w,senderPublicKey:S})},this.decode=async(a,h,p)=>{this.isInitialized();const g=ww(h,p);if(rl(g)){const w=g.receiverPublicKey,y=g.senderPublicKey;a=await this.generateSharedKey(w,y)}try{const w=this.getSymKey(a),y=mw({symKey:w,encoded:h});return Ao(y)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const h=Po(a);return on(h.type)},this.getPayloadSenderPublicKey=a=>{const h=Po(a);return h.senderPublicKey?nr(h.senderPublicKey,sr):void 0},this.core=r,this.logger=Ce.generateChildLogger(t,this.name),this.keychain=s||new kE(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(r,t){return await this.keychain.set(r,t),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(ql)}catch{r=Pc(),await this.keychain.set(ql,r)}return lE(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class KE extends f_{constructor(r,t){super(r,t),this.logger=r,this.core=t,this.messages=new Map,this.name=wE,this.version=bE,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const h=ws(a);let p=this.messages.get(s);return typeof p>"u"&&(p={}),typeof p[h]<"u"||(p[h]=a,this.messages.set(s,p),await this.persist()),h},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const h=this.get(s),p=ws(a);return typeof h[p]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Ce.generateChildLogger(r,this.name),this.core=t}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,bf(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?_f(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class FE extends p_{constructor(r,t){super(r,t),this.relayer=r,this.logger=t,this.events=new Qr.EventEmitter,this.name=EE,this.queue=new Map,this.publishTimeout=ne.toMiliseconds(ne.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,h)=>{var p;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:h}});try{const g=h?.ttl||_E,w=Oc(h),y=h?.prompt||!1,b=h?.tag||0,S=h?.id||nw().toString(),R={topic:s,message:a,opts:{ttl:g,relay:w,prompt:y,tag:b,id:S}},F=setTimeout(()=>this.queue.set(S,R),this.publishTimeout);try{await await rn(this.rpcPublish(s,a,g,w,y,b,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Jt.publish,R)}catch(q){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(p=h?.internal)!=null&&p.throwOnFailedPublish)throw this.removeRequestFromQueue(S),q;return}finally{clearTimeout(F)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:h}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=r,this.logger=Ce.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(r,t,s,a,h,p,g){var w,y,b,S;const R={method:Eo(a.protocol).publish,params:{topic:r,message:t,ttl:s,prompt:h,tag:p},id:g};return ir((w=R.params)==null?void 0:w.prompt)&&((y=R.params)==null||delete y.prompt),ir((b=R.params)==null?void 0:b.tag)&&((S=R.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:t,message:s,opts:a}=r;await this.publish(t,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(xs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Jt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Jt.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class VE{constructor(){this.map=new Map,this.set=(r,t)=>{const s=this.get(r);this.exists(r,t)||this.map.set(r,[...s,t])},this.get=r=>this.map.get(r)||[],this.exists=(r,t)=>this.get(r).includes(t),this.delete=(r,t)=>{if(typeof t>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const s=this.get(r);if(!this.exists(r,t))return;const a=s.filter(h=>h!==t);if(!a.length){this.map.delete(r);return}this.map.set(r,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var BE=Object.defineProperty,GE=Object.defineProperties,WE=Object.getOwnPropertyDescriptors,Ul=Object.getOwnPropertySymbols,JE=Object.prototype.hasOwnProperty,QE=Object.prototype.propertyIsEnumerable,zl=(o,r,t)=>r in o?BE(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Gs=(o,r)=>{for(var t in r||(r={}))JE.call(r,t)&&zl(o,t,r[t]);if(Ul)for(var t of Ul(r))QE.call(r,t)&&zl(o,t,r[t]);return o},yc=(o,r)=>GE(o,WE(r));class YE extends y_{constructor(r,t){super(r,t),this.relayer=r,this.logger=t,this.subscriptions=new Map,this.topicMap=new VE,this.events=new Qr.EventEmitter,this.name=TE,this.version=AE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Oi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const h=Oc(a),p={topic:s,relay:h};this.pending.set(s,p);const g=await this.rpcSubscribe(s,h);return this.onSubscribe(g,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),g}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof a?.id<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,h)=>{const p=new ne.Watch;p.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),a(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=$E&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Ce.generateChildLogger(t,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,t){let s=!1;try{s=this.getSubscription(r).topic===t}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,t){const s=this.topicMap.get(r);await Promise.all(s.map(async a=>await this.unsubscribeById(r,a,t)))}async unsubscribeById(r,t,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:t,opts:s}});try{const a=Oc(s);await this.rpcUnsubscribe(r,t,a);const h=It("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,t,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:t,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(r,t){const s={method:Eo(t.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await rn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}return ws(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const t=r[0].relay,s={method:Eo(t.protocol).batchSubscribe,params:{topics:r.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await rn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}}rpcUnsubscribe(r,t,s){const a={method:Eo(s.protocol).unsubscribe,params:{topic:r,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(r,t){this.setSubscription(r,yc(Gs({},t),{id:r})),this.pending.delete(t.topic)}onBatchSubscribe(r){r.length&&r.forEach(t=>{this.setSubscription(t.id,Gs({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(r,t,s){this.events.removeAllListeners(t),this.hasSubscription(t,r)&&this.deleteSubscription(t,s),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,t){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:t}),this.addSubscription(r,t))}addSubscription(r,t){this.subscriptions.set(r,Gs({},t)),this.topicMap.set(t.topic,r),this.events.emit(Ur.created,t)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const t=this.subscriptions.get(r);if(!t){const{message:s}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return t}deleteSubscription(r,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:t});const s=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(s.topic,r),this.events.emit(Ur.deleted,yc(Gs({},s),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ur.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<r;t++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Ur.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const t=await this.rpcBatchSubscribe(r);Jr(t)&&this.onBatchSubscribe(t.map((s,a)=>yc(Gs({},r[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(t=>{r.push(t)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(xs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Jt.connect,async()=>{await this.onConnect()}),this.relayer.on(Jt.disconnect,()=>{this.onDisconnect()}),this.events.on(Ur.created,async r=>{const t=Ur.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),await this.persist()}),this.events.on(Ur.deleted,async r=>{const t=Ur.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),r())},this.pollingInterval)})}}var ZE=Object.defineProperty,kl=Object.getOwnPropertySymbols,XE=Object.prototype.hasOwnProperty,eI=Object.prototype.propertyIsEnumerable,Hl=(o,r,t)=>r in o?ZE(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,tI=(o,r)=>{for(var t in r||(r={}))XE.call(r,t)&&Hl(o,t,r[t]);if(kl)for(var t of kl(r))eI.call(r,t)&&Hl(o,t,r[t]);return o};class rI extends d_{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Qr.EventEmitter,this.name=xE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(Jt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(Jt.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ui.payload,this.onPayloadHandler),this.provider.on(ui.connect,this.onConnectHandler),this.provider.on(ui.disconnect,this.onDisconnectHandler),this.provider.on(ui.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Ce.generateChildLogger(r.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:r.logger||IE})),this.messages=new KE(this.logger,r.core),this.subscriber=new YE(this,this.logger),this.publisher=new FE(this,this.logger),this.relayUrl=r?.relayUrl||Wf,this.projectId=r.projectId,this.bundleId=Sw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ml}...`),await this.restartTransport(Ml)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},CE)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,t,s){this.isInitialized(),await this.publisher.publish(r,t,s),await this.recordMessageEvent({topic:r,message:t,publishedAt:Date.now()})}async subscribe(r,t){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(r))==null?void 0:s[0])||"";if(a)return a;let h;const p=g=>{g.topic===r&&(this.subscriber.off(Ur.created,p),h())};return await Promise.all([new Promise(g=>{h=g,this.subscriber.on(Ur.created,p)}),new Promise(async g=>{a=await this.subscriber.subscribe(r,t),g()})]),a}async unsubscribe(r,t){this.isInitialized(),await this.subscriber.unsubscribe(r,t)}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}off(r,t){this.events.off(r,t)}removeListener(r,t){this.events.removeListener(r,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await rn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(Ur.resubscribed,()=>{t()})}),new Promise(async(t,s)=>{try{await rn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}t()})])}catch(t){this.logger.error(t);const s=t;if(!this.isConnectionStalled(s.message))throw t;this.provider.events.emit(ui.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await pl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(t=>r.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new fi(new M_(Tw({sdkVersion:OE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:t,message:s}=r;await this.messages.set(t,s)}async shouldIgnoreMessageEvent(r){const{topic:t,message:s}=r;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const a=this.messages.has(t,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),Mc(r)){if(!r.method.endsWith(SE))return;const t=r.params,{topic:s,message:a,publishedAt:h}=t.data,p={topic:s,message:a,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(tI({type:"event",event:t.id},p)),this.events.emit(t.id,p),await this.acknowledgePayload(r),await this.onMessageEvent(p)}else Uc(r)&&this.events.emit(Jt.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Jt.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const t=zc(r.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(ui.payload,this.onPayloadHandler),this.provider.off(ui.connect,this.onConnectHandler),this.provider.off(ui.disconnect,this.onDisconnectHandler),this.provider.off(ui.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Jt.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let r=await pl();Ib(async t=>{this.initialized&&r!==t&&(r=t,t?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Jt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},ne.toMiliseconds(PE)))}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var iI=Object.defineProperty,Kl=Object.getOwnPropertySymbols,sI=Object.prototype.hasOwnProperty,nI=Object.prototype.propertyIsEnumerable,Fl=(o,r,t)=>r in o?iI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Vl=(o,r)=>{for(var t in r||(r={}))sI.call(r,t)&&Fl(o,t,r[t]);if(Kl)for(var t of Kl(r))nI.call(r,t)&&Fl(o,t,r[t]);return o};class Do extends g_{constructor(r,t,s,a=Oi,h=void 0){super(r,t,s,a),this.core=r,this.logger=t,this.name=s,this.map=new Map,this.version=NE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{this.getKey&&p!==null&&!ir(p)?this.map.set(this.getKey(p),p):eb(p)?this.map.set(p.id,p):tb(p)&&this.map.set(p.topic,p)}),this.cached=[],this.initialized=!0)},this.set=async(p,g)=>{this.isInitialized(),this.map.has(p)?await this.update(p,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:g}),this.map.set(p,g),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(g=>Object.keys(p).every(w=>z_(g[w],p[w]))):this.values),this.update=async(p,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:g});const w=Vl(Vl({},this.getData(p)),g);this.map.set(p,w),await this.persist()},this.delete=async(p,g)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:g}),this.map.delete(p),await this.persist())},this.logger=Ce.generateChildLogger(t,this.name),this.storagePrefix=a,this.getKey=h}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const t=this.map.get(r);if(!t){const{message:s}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(s),new Error(s)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class oI{constructor(r,t){this.core=r,this.logger=t,this.name=DE,this.version=LE,this.events=new jc,this.initialized=!1,this.storagePrefix=Oi,this.ignoredPayloadTypes=[Gi],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Pc(),a=await this.core.crypto.setSymKey(s),h=zr(ne.FIVE_MINUTES),p={protocol:Gf},g={topic:a,expiry:h,relay:p,active:!1},w=Fw({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:p});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,h),{topic:a,uri:w}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:h,relay:p}=cl(s.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=zr(ne.FIVE_MINUTES),y={topic:a,relay:p,expiry:w,active:!1};return await this.pairings.set(a,y),this.core.expirer.set(a,w),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Zs.create,y),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(h,a),await this.core.relayer.subscribe(a,{relay:p})),y},this.activate=async({topic:s})=>{this.isInitialized();const a=zr(ne.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const h=await this.sendRequest(a,"wc_pairingPing",{}),{done:p,resolve:g,reject:w}=ms();this.events.once(Dt("pairing_ping",h),({error:y})=>{y?w(y):g()}),await p()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",It("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,h)=>{const p=en(a,h),g=await this.core.crypto.encode(s,p),w=Bs[a].req;return this.core.history.set(s,p),this.core.relayer.publish(s,g,w),p.id},this.sendResult=async(s,a,h)=>{const p=zc(s,h),g=await this.core.crypto.encode(a,p),w=await this.core.history.get(a,s),y=Bs[w.request.method].res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(p)},this.sendError=async(s,a,h)=>{const p=qc(s,h),g=await this.core.crypto.encode(a,p),w=await this.core.history.get(a,s),y=Bs[w.request.method]?Bs[w.request.method].res:Bs.unregistered_method.res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(p)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,It("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Pi(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:h}=s;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(a,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,h);default:return this.onUnknownRpcMethodRequest(a,h)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:h}=s,p=(await this.core.history.get(a,h.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(a,h);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(s,a)=>{const{id:h}=a;try{this.isValidPing({topic:s}),await this.sendResult(h,s,!0),this.events.emit(Zs.ping,{id:h,topic:s})}catch(p){await this.sendError(h,s,p),this.logger.error(p)}},this.onPairingPingResponse=(s,a)=>{const{id:h}=a;setTimeout(()=>{Si(a)?this.events.emit(Dt("pairing_ping",h),{}):li(a)&&this.events.emit(Dt("pairing_ping",h),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:h}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Zs.delete,{id:h,topic:s})}catch(p){await this.sendError(h,s,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:h,method:p}=a;try{if(this.registeredMethods.includes(p))return;const g=It("WC_METHOD_UNSUPPORTED",p);await this.sendError(h,s,g),this.logger.error(g)}catch(g){await this.sendError(h,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(It("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!dr(s)){const{message:p}=Z("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(p)}if(!Xw(s.uri)){const{message:p}=Z("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(p)}const h=cl(s.uri);if(!((a=h?.relay)!=null&&a.protocol)){const{message:p}=Z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(p)}if(!(h!=null&&h.symKey)){const{message:p}=Z("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(p)}},this.isValidPing=async s=>{if(!dr(s)){const{message:h}=Z("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(h)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!dr(s)){const{message:h}=Z("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(h)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!Ht(s,!1)){const{message:a}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Pi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=Z("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=r,this.logger=Ce.generateChildLogger(t,this.name),this.pairings=new Do(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Jt.message,async r=>{const{topic:t,message:s}=r;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(t,s);try{Mc(a)?(this.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Uc(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.core.history.delete(t,a.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Ar.expired,async r=>{const{topic:t}=If(r.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Zs.expire,{topic:t}))})}}class aI extends l_{constructor(r,t){super(r,t),this.core=r,this.logger=t,this.records=new Map,this.events=new Qr.EventEmitter,this.name=jE,this.version=qE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:h}),this.records.has(a.id))return;const p={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:h,expiry:zr(ne.THIRTY_DAYS)};this.records.set(p.id,p),this.events.emit(Wr.created,p)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=li(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Wr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(h=>{if(h.topic===s){if(typeof a<"u"&&h.id!==a)return;this.records.delete(h.id),this.events.emit(Wr.deleted,h)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const s={topic:t.topic,request:en(t.request.method,t.request.params,t.id),chainId:t.chainId};return r.push(s)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const t=this.records.get(r);if(!t){const{message:s}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wr.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(Wr.created,r=>{const t=Wr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.events.on(Wr.updated,r=>{const t=Wr.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.events.on(Wr.deleted,r=>{const t=Wr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.core.heartbeat.on(xs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{ne.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class cI extends m_{constructor(r,t){super(r,t),this.core=r,this.logger=t,this.expirations=new Map,this.events=new Qr.EventEmitter,this.name=ME,this.version=UE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const h=this.formatTarget(s),p={target:h,expiry:a};this.expirations.set(h,p),this.checkExpiry(h,p),this.events.emit(Ar.created,{target:h,expiration:p})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),h=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ar.deleted,{target:a,expiration:h})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return Aw(r);if(typeof r=="number")return $w(r);const{message:t}=Z("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(t)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ar.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const t=this.expirations.get(r);if(!t){const{message:s}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(s),new Error(s)}return t}checkExpiry(r,t){const{expiry:s}=t;ne.toMiliseconds(s)-Date.now()<=0&&this.expire(r,t)}expire(r,t){this.expirations.delete(r),this.events.emit(Ar.expired,{target:r,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,t)=>this.checkExpiry(t,r))}registerEventListeners(){this.core.heartbeat.on(xs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ar.created,r=>{const t=Ar.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()}),this.events.on(Ar.expired,r=>{const t=Ar.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()}),this.events.on(Ar.deleted,r=>{const t=Ar.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class uI extends v_{constructor(r,t){super(r,t),this.projectId=r,this.logger=t,this.name=gc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||_s()||!Es())return;const a=this.getVerifyUrl(s?.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Tc;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s?.verifyUrl);let h;try{h=await this.fetchAttestation(s.attestationId,a)}catch(p){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(p),h=await this.fetchAttestation(s.attestationId,Tc)}return h},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const h=this.startAbortTimer(ne.ONE_SECOND*2),p=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(h),p.status===200?await p.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(h=>{if(document.getElementById(gc))return h();window.addEventListener("message",a);const p=document.createElement("iframe");p.id=gc,p.src=`${this.verifyUrl}/${this.projectId}`,p.style.display="none",document.body.append(p),this.iframe=p,s=h}),new Promise((h,p)=>setTimeout(()=>{window.removeEventListener("message",a),p("verify iframe load timeout")},ne.toMiliseconds(ne.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||vs;return zE.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${vs}`),a=vs),a},this.logger=Ce.generateChildLogger(t,this.name),this.verifyUrl=vs,this.abortController=new AbortController,this.isDevEnv=Fc()&&k_.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ne.toMiliseconds(r))}}var hI=Object.defineProperty,Bl=Object.getOwnPropertySymbols,lI=Object.prototype.hasOwnProperty,fI=Object.prototype.propertyIsEnumerable,Gl=(o,r,t)=>r in o?hI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Wl=(o,r)=>{for(var t in r||(r={}))lI.call(r,t)&&Gl(o,t,r[t]);if(Bl)for(var t of Bl(r))fI.call(r,t)&&Gl(o,t,r[t]);return o};class Jc extends h_{constructor(r){super(r),this.protocol=Bf,this.version=fE,this.name=Wc,this.events=new Qr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=r?.projectId,this.relayUrl=r?.relayUrl||Wf,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const t=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:r?.logger||pE.logger}));this.logger=Ce.generateChildLogger(t,this.name),this.heartbeat=new xs.HeartBeat,this.crypto=new HE(this,this.logger,r?.keychain),this.history=new aI(this,this.logger),this.expirer=new cI(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new t_(Wl(Wl({},dE),r?.storageOptions)),this.relayer=new rI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new oI(this,this.logger),this.verify=new uI(this.projectId||"",this.logger)}static async init(r){const t=new Jc(r);await t.initialize();const s=await t.crypto.getClientId();return await t.storage.setItem(RE,s),t}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const pI=Jc,Jf="wc",Qf=2,Yf="client",Qc=`${Jf}@${Qf}:${Yf}:`,mc={name:Yf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Jl="WALLETCONNECT_DEEPLINK_CHOICE",dI="proposal",Zf="Proposal expired",gI="session",wo=ne.SEVEN_DAYS,yI="engine",Ws={wc_sessionPropose:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1115}}},vc={min:ne.FIVE_MINUTES,max:ne.SEVEN_DAYS},hi={idle:"IDLE",active:"ACTIVE"},mI="request",vI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var wI=Object.defineProperty,bI=Object.defineProperties,_I=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,EI=Object.prototype.hasOwnProperty,II=Object.prototype.propertyIsEnumerable,Yl=(o,r,t)=>r in o?wI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,fr=(o,r)=>{for(var t in r||(r={}))EI.call(r,t)&&Yl(o,t,r[t]);if(Ql)for(var t of Ql(r))II.call(r,t)&&Yl(o,t,r[t]);return o},Js=(o,r)=>bI(o,_I(r));class xI extends b_{constructor(r){super(r),this.name=yI,this.events=new jc,this.initialized=!1,this.ignoredPayloadTypes=[Gi],this.requestQueue={state:hi.idle,queue:[]},this.sessionRequestQueue={state:hi.idle,queue:[]},this.requestQueueDelay=ne.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ws)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const s=Js(fr({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:h,optionalNamespaces:p,sessionProperties:g,relays:w}=s;let y=a,b,S=!1;if(y&&(S=this.client.core.pairing.pairings.get(y).active),!y||!S){const{topic:$,uri:U}=await this.client.core.pairing.create();y=$,b=U}const R=await this.client.core.crypto.generateKeyPair(),F=fr({requiredNamespaces:h,optionalNamespaces:p,relays:w??[{protocol:Gf}],proposer:{publicKey:R,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:q,resolve:J,done:oe}=ms(ne.FIVE_MINUTES,Zf);if(this.events.once(Dt("session_connect"),async({error:$,session:U})=>{if($)q($);else if(U){U.self.publicKey=R;const M=Js(fr({},U),{requiredNamespaces:U.requiredNamespaces,optionalNamespaces:U.optionalNamespaces});await this.client.session.set(U.topic,M),await this.setExpiry(U.topic,U.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:U.peer.metadata}),J(M)}}),!y){const{message:$}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error($)}const fe=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:F}),C=zr(ne.FIVE_MINUTES);return await this.setProposal(fe,fr({id:fe,expiry:C},F)),{uri:b,approval:oe}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:s,relayProtocol:a,namespaces:h,sessionProperties:p}=t,g=this.client.proposal.get(s);let{pairingTopic:w,proposer:y,requiredNamespaces:b,optionalNamespaces:S}=g;w=w||"",bs(b)||(b=Ww(h,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),F=y.publicKey,q=await this.client.core.crypto.generateSharedKey(R,F);w&&s&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:y.metadata}),await this.sendResult({id:s,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(s,It("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const J=fr({relay:{protocol:a??"irn"},namespaces:h,requiredNamespaces:b,optionalNamespaces:S,pairingTopic:w,controller:{publicKey:R,metadata:this.client.metadata},expiry:zr(wo)},p&&{sessionProperties:p});await this.client.core.relayer.subscribe(q),await this.sendRequest({topic:q,method:"wc_sessionSettle",params:J,throwOnFailedPublish:!0});const oe=Js(fr({},J),{topic:q,pairingTopic:w,acknowledged:!1,self:J.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:R});return await this.client.session.set(q,oe),await this.setExpiry(q,zr(wo)),{topic:q,acknowledged:()=>new Promise(fe=>setTimeout(()=>fe(this.client.session.get(q)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:s,reason:a}=t,{pairingTopic:h}=this.client.proposal.get(s);h&&(await this.sendError(s,h,a),await this.client.proposal.delete(s,It("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:s,namespaces:a}=t,h=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:p,resolve:g,reject:w}=ms();return this.events.once(Dt("session_update",h),({error:y})=>{y?w(y):g()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:p}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:s}=t,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:h,resolve:p,reject:g}=ms();return this.events.once(Dt("session_extend",a),({error:w})=>{w?g(w):p()}),await this.setExpiry(s,zr(wo)),{acknowledged:h}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:s,request:a,topic:h,expiry:p}=t,g=ow(),{done:w,resolve:y,reject:b}=ms(p,"Request expired. Please try again.");return this.events.once(Dt("session_request",g),({error:S,result:R})=>{S?b(S):y(R)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:g,topic:h,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:p,throwOnFailedPublish:!0}).catch(R=>b(R)),this.client.events.emit("session_request_sent",{topic:h,request:a,chainId:s,id:g}),S()}),new Promise(async S=>{const R=await Lw(this.client.core.storage,Jl);Dw({id:g,topic:h,wcDeepLink:R}),S()}),w()]).then(S=>S[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:s,response:a}=t,{id:h}=a;Si(a)?await this.sendResult({id:h,topic:s,result:a.result,throwOnFailedPublish:!0}):li(a)&&await this.sendError(h,s,a.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:s}=t;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:h,resolve:p,reject:g}=ms();this.events.once(Dt("session_ping",a),({error:w})=>{w?g(w):p()}),await h()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:s,event:a,chainId:h}=t;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:h}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:s}=t;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:It("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(s=>Yw(s,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const s=this.client.core.pairing.pairings.get(t.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(h=>{var p,g;return((p=h.peerMetadata)==null?void 0:p.url)&&((g=h.peerMetadata)==null?void 0:g.url)===t.peer.metadata.url&&h.topic&&h.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(t,s)=>{const{self:a}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,It("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),s||this.client.core.expirer.del(t),this.client.core.storage.removeItem(Jl).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(t,s)=>{await Promise.all([this.client.proposal.delete(t,It("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,s),a?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==t),a&&(this.sessionRequestQueue.state=hi.idle)},this.setExpiry=async(t,s)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:s}),this.client.core.expirer.set(t,s)},this.setProposal=async(t,s)=>{await this.client.proposal.set(t,s),this.client.core.expirer.set(t,s.expiry)},this.setPendingSessionRequest=async t=>{const s=Ws.wc_sessionRequest.req.ttl,{id:a,topic:h,params:p,verifyContext:g}=t;await this.client.pendingRequest.set(a,{id:a,topic:h,params:p,verifyContext:g}),s&&this.client.core.expirer.set(a,zr(s))},this.sendRequest=async t=>{const{topic:s,method:a,params:h,expiry:p,relayRpcId:g,clientRpcId:w,throwOnFailedPublish:y}=t,b=en(a,h,w);if(Es()&&vI.includes(a)){const F=ws(JSON.stringify(b));this.client.core.verify.register({attestationId:F})}const S=await this.client.core.crypto.encode(s,b),R=Ws[a].req;return p&&(R.ttl=p),g&&(R.id=g),this.client.core.history.set(s,b),y?(R.internal=Js(fr({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,S,R)):this.client.core.relayer.publish(s,S,R).catch(F=>this.client.logger.error(F)),b.id},this.sendResult=async t=>{const{id:s,topic:a,result:h,throwOnFailedPublish:p}=t,g=zc(s,h),w=await this.client.core.crypto.encode(a,g),y=await this.client.core.history.get(a,s),b=Ws[y.request.method].res;p?(b.internal=Js(fr({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,b)):this.client.core.relayer.publish(a,w,b).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(g)},this.sendError=async(t,s,a)=>{const h=qc(t,a),p=await this.client.core.crypto.encode(s,h),g=await this.client.core.history.get(s,t),w=Ws[g.request.method].res;this.client.core.relayer.publish(s,p,w),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const t=[],s=[];this.client.session.getAll().forEach(a=>{Pi(a.expiry)&&t.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Pi(a.expiry)&&s.push(a.id)}),await Promise.all([...t.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===hi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=hi.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=hi.idle},this.processRequest=t=>{const{topic:s,payload:a}=t,h=a.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async t=>{const{topic:s,payload:a}=t,h=(await this.client.core.history.get(s,a.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:s}=t,{message:a}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(t,s)=>{const{params:a,id:h}=s;try{this.isValidConnect(fr({},s.params));const p=zr(ne.FIVE_MINUTES),g=fr({id:h,pairingTopic:t,expiry:p},a);await this.setProposal(h,g);const w=ws(JSON.stringify(s)),y=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:g,verifyContext:y})}catch(p){await this.sendError(h,t,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(t,s)=>{const{id:a}=s;if(Si(s)){const{result:h}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const p=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const g=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const y=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const b=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),await this.client.core.pairing.activate({topic:t})}else li(s)&&(await this.client.proposal.delete(a,It("USER_DISCONNECTED")),this.events.emit(Dt("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(t,s)=>{const{id:a,params:h}=s;try{this.isValidSessionSettleRequest(h);const{relay:p,controller:g,expiry:w,namespaces:y,requiredNamespaces:b,optionalNamespaces:S,sessionProperties:R,pairingTopic:F}=s.params,q=fr({topic:t,relay:p,expiry:w,namespaces:y,acknowledged:!0,pairingTopic:F,requiredNamespaces:b,optionalNamespaces:S,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},R&&{sessionProperties:R});await this.sendResult({id:s.id,topic:t,result:!0}),this.events.emit(Dt("session_connect"),{session:q}),this.cleanupDuplicatePairings(q)}catch(p){await this.sendError(a,t,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(t,s)=>{const{id:a}=s;Si(s)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Dt("session_approve",a),{})):li(s)&&(await this.client.session.delete(t,It("USER_DISCONNECTED")),this.events.emit(Dt("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(t,s)=>{const{params:a,id:h}=s;try{const p=`${t}_session_update`,g=yo.get(p);if(g&&this.isRequestOutOfSync(g,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(fr({topic:t},a)),await this.client.session.update(t,{namespaces:a.namespaces}),await this.sendResult({id:h,topic:t,result:!0}),this.client.events.emit("session_update",{id:h,topic:t,params:a}),yo.set(p,h)}catch(p){await this.sendError(h,t,p),this.client.logger.error(p)}},this.isRequestOutOfSync=(t,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,s)=>{const{id:a}=s;Si(s)?this.events.emit(Dt("session_update",a),{}):li(s)&&this.events.emit(Dt("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(t,s)=>{const{id:a}=s;try{this.isValidExtend({topic:t}),await this.setExpiry(t,zr(wo)),await this.sendResult({id:a,topic:t,result:!0}),this.client.events.emit("session_extend",{id:a,topic:t})}catch(h){await this.sendError(a,t,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(t,s)=>{const{id:a}=s;Si(s)?this.events.emit(Dt("session_extend",a),{}):li(s)&&this.events.emit(Dt("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(t,s)=>{const{id:a}=s;try{this.isValidPing({topic:t}),await this.sendResult({id:a,topic:t,result:!0}),this.client.events.emit("session_ping",{id:a,topic:t})}catch(h){await this.sendError(a,t,h),this.client.logger.error(h)}},this.onSessionPingResponse=(t,s)=>{const{id:a}=s;setTimeout(()=>{Si(s)?this.events.emit(Dt("session_ping",a),{}):li(s)&&this.events.emit(Dt("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(t,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:t,reason:s.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Jt.publish,async()=>{h(await this.deleteSession(t))})}),this.sendResult({id:a,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:t})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(t,s)=>{const{id:a,params:h}=s;try{this.isValidRequest(fr({topic:t},h));const p=ws(JSON.stringify(en("wc_sessionRequest",h,a))),g=this.client.session.get(t),w=await this.getVerifyContext(p,g.peer.metadata),y={id:a,topic:t,params:h,verifyContext:w};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(p){await this.sendError(a,t,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(t,s)=>{const{id:a}=s;Si(s)?this.events.emit(Dt("session_request",a),{result:s.result}):li(s)&&this.events.emit(Dt("session_request",a),{error:s.error})},this.onSessionEventRequest=async(t,s)=>{const{id:a,params:h}=s;try{const p=`${t}_session_event_${h.event.name}`,g=yo.get(p);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(fr({topic:t},h)),this.client.events.emit("session_event",{id:a,topic:t,params:h}),yo.set(p,a)}catch(p){await this.sendError(a,t,p),this.client.logger.error(p)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=hi.idle,this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===hi.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=hi.active,this.client.events.emit("session_request",t)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=t=>{if(t.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===t.topic);s&&this.onSessionProposeRequest(t.topic,en("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async t=>{if(!dr(t)){const{message:w}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(w)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:h,sessionProperties:p,relays:g}=t;if(ir(s)||await this.isValidPairingTopic(s),!ub(g,!0)){const{message:w}=Z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!ir(a)&&bs(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ir(h)&&bs(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),ir(p)||this.validateSessionProps(p,"sessionProperties")},this.validateNamespaces=(t,s)=>{const a=cb(t,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async t=>{if(!dr(t))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:s,namespaces:a,relayProtocol:h,sessionProperties:p}=t;await this.isValidProposalId(s);const g=this.client.proposal.get(s),w=Io(a,"approve()");if(w)throw new Error(w.message);const y=ll(g.requiredNamespaces,a,"approve()");if(y)throw new Error(y.message);if(!Ht(h,!0)){const{message:b}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(b)}ir(p)||this.validateSessionProps(p,"sessionProperties")},this.isValidReject=async t=>{if(!dr(t)){const{message:h}=Z("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(h)}const{id:s,reason:a}=t;if(await this.isValidProposalId(s),!lb(a)){const{message:h}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidSessionSettleRequest=t=>{if(!dr(t)){const{message:y}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(y)}const{relay:s,controller:a,namespaces:h,expiry:p}=t;if(!Sf(s)){const{message:y}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const g=rb(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=Io(h,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Pi(p)){const{message:y}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async t=>{if(!dr(t)){const{message:w}=Z("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(w)}const{topic:s,namespaces:a}=t;await this.isValidSessionTopic(s);const h=this.client.session.get(s),p=Io(a,"update()");if(p)throw new Error(p.message);const g=ll(h.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async t=>{if(!dr(t)){const{message:a}=Z("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(a)}const{topic:s}=t;await this.isValidSessionTopic(s)},this.isValidRequest=async t=>{if(!dr(t)){const{message:w}=Z("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(w)}const{topic:s,request:a,chainId:h,expiry:p}=t;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!hl(g,h)){const{message:w}=Z("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(w)}if(!fb(a)){const{message:w}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!gb(g,h,a.method)){const{message:w}=Z("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(p&&!wb(p,vc)){const{message:w}=Z("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${vc.min} and ${vc.max}`);throw new Error(w)}},this.isValidRespond=async t=>{if(!dr(t)){const{message:h}=Z("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(h)}const{topic:s,response:a}=t;if(await this.isValidSessionTopic(s),!pb(a)){const{message:h}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidPing=async t=>{if(!dr(t)){const{message:a}=Z("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(a)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async t=>{if(!dr(t)){const{message:g}=Z("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(g)}const{topic:s,event:a,chainId:h}=t;await this.isValidSessionTopic(s);const{namespaces:p}=this.client.session.get(s);if(!hl(p,h)){const{message:g}=Z("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(g)}if(!db(a)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!yb(p,h,a.name)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async t=>{if(!dr(t)){const{message:a}=Z("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(a)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(t,s)=>{const a={verified:{verifyUrl:s.verifyUrl||vs,validation:"UNKNOWN",origin:s.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:t,verifyUrl:s.verifyUrl});h&&(a.verified.origin=h.origin,a.verified.isScam=h.isScam,a.verified.validation=h.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(t,s)=>{Object.values(t).forEach(a=>{if(!Ht(a,!1)){const{message:h}=Z("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Jt.message,async r=>{const{topic:t,message:s}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(t,s);try{Mc(a)?(this.client.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Uc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.client.core.history.delete(t,a.id)):this.onRelayEventUnknownPayload({topic:t,payload:a})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Ar.expired,async r=>{const{topic:t,id:s}=If(r.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,Z("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Zs.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!Ht(r,!1)){const{message:t}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:t}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(t)}if(Pi(this.client.core.pairing.pairings.get(r).expiry)){const{message:t}=Z("EXPIRED",`pairing topic: ${r}`);throw new Error(t)}}async isValidSessionTopic(r){if(!Ht(r,!1)){const{message:t}=Z("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(t)}if(!this.client.session.keys.includes(r)){const{message:t}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(t)}if(Pi(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:t}=Z("EXPIRED",`session topic: ${r}`);throw new Error(t)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(Ht(r,!1)){const{message:t}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(t)}else{const{message:t}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(t)}}async isValidProposalId(r){if(!hb(r)){const{message:t}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(t)}if(!this.client.proposal.keys.includes(r)){const{message:t}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(t)}if(Pi(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:t}=Z("EXPIRED",`proposal id: ${r}`);throw new Error(t)}}}class SI extends Do{constructor(r,t){super(r,t,dI,Qc),this.core=r,this.logger=t}}class PI extends Do{constructor(r,t){super(r,t,gI,Qc),this.core=r,this.logger=t}}class OI extends Do{constructor(r,t){super(r,t,mI,Qc,s=>s.id),this.core=r,this.logger=t}}let CI=class Xf extends w_{constructor(r){super(r),this.protocol=Jf,this.version=Qf,this.name=mc.name,this.events=new Qr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=r?.name||mc.name,this.metadata=r?.metadata||Ow();const t=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:r?.logger||mc.logger}));this.core=r?.core||new pI(r),this.logger=Ce.generateChildLogger(t,this.name),this.session=new PI(this.core,this.logger),this.proposal=new SI(this.core,this.logger),this.pendingRequest=new OI(this.core,this.logger),this.engine=new xI(this)}static async init(r){const t=new Xf(r);return await t.initialize(),t}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};const Zl="error",NI="wss://relay.walletconnect.com",RI="wc",TI="universal_provider",Xl=`${RI}@2:${TI}:`,AI="https://rpc.walletconnect.com/v1/",pi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ac={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,r){(function(){var t,s="4.17.21",a=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",y=500,b="__lodash_placeholder__",S=1,R=2,F=4,q=1,J=2,oe=1,fe=2,C=4,$=8,U=16,M=32,I=64,L=128,K=256,ce=512,ae=30,Ee="...",Ne=800,et=16,A=1,V=2,Ue=3,Re=1/0,ee=9007199254740991,Q=17976931348623157e292,W=NaN,Y=4294967295,ut=Y-1,He=Y>>>1,kr=[["ary",L],["bind",oe],["bindKey",fe],["curry",$],["curryRight",U],["flip",ce],["partial",M],["partialRight",I],["rearg",K]],be="[object Arguments]",xt="[object Array]",j="[object AsyncFunction]",D="[object Boolean]",N="[object Date]",u="[object DOMException]",E="[object Error]",ie="[object Function]",pe="[object GeneratorFunction]",ve="[object Map]",Te="[object Number]",$e="[object Null]",xe="[object Object]",St="[object Promise]",vt="[object Proxy]",nt="[object RegExp]",Le="[object Set]",Je="[object String]",Qe="[object Symbol]",ot="[object Undefined]",ze="[object WeakMap]",Ye="[object WeakSet]",Ae="[object ArrayBuffer]",Ke="[object DataView]",ht="[object Float32Array]",qe="[object Float64Array]",Pt="[object Int8Array]",Lt="[object Int16Array]",Kt="[object Int32Array]",Ft="[object Uint8Array]",Mt="[object Uint8ClampedArray]",Qt="[object Uint16Array]",or="[object Uint32Array]",Hr=/\b__p \+= '';/g,Yt=/\b(__p \+=) '' \+/g,Yr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,di=/&(?:amp|lt|gt|quot|#39);/g,Ri=/[&<>"']/g,lt=RegExp(di.source),tt=RegExp(Ri.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,Nt=RegExp(dt.source),gt=/^\s+/,wt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Rt=/,? & /,Tt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Lo=/[()=,{}\[\]\/\s]/,jo=/\\(\\)?/g,qo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ir=/\w*$/,Mo=/^[-+]0x[0-9a-f]+$/i,Uo=/^0b[01]+$/i,zo=/^\[object .+?Constructor\]$/,ko=/^0o[0-7]+$/i,Ho=/^(?:0|[1-9]\d*)$/,Zr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Yi=/($^)/,Ko=/['\n\r\u2028\u2029\\]/g,Zi="\\ud800-\\udfff",Fo="\\u0300-\\u036f",Vo="\\ufe20-\\ufe2f",Xi="\\u20d0-\\u20ff",hn=Fo+Vo+Xi,ln="\\u2700-\\u27bf",$r="a-z\\xdf-\\xf6\\xf8-\\xff",Bo="\\xac\\xb1\\xd7\\xf7",Go="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Wo="\\u2000-\\u206f",Jo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",fn="A-Z\\xc0-\\xd6\\xd8-\\xde",pn="\\ufe0e\\ufe0f",Ti=Bo+Go+Wo+Jo,Ss="[']",Ai="["+Zi+"]",Ps="["+Ti+"]",$i="["+hn+"]",dn="\\d+",Qo="["+ln+"]",gn="["+$r+"]",yn="[^"+Zi+Ti+dn+ln+$r+fn+"]",es="\\ud83c[\\udffb-\\udfff]",Yo="(?:"+$i+"|"+es+")",mn="[^"+Zi+"]",ts="(?:\\ud83c[\\udde6-\\uddff]){2}",gi="[\\ud800-\\udbff][\\udc00-\\udfff]",yr="["+fn+"]",vn="\\u200d",wn="(?:"+gn+"|"+yn+")",Kr="(?:"+yr+"|"+yn+")",bn="(?:"+Ss+"(?:d|ll|m|re|s|t|ve))?",_n="(?:"+Ss+"(?:D|LL|M|RE|S|T|VE))?",En=Yo+"?",In="["+pn+"]?",Zo="(?:"+vn+"(?:"+[mn,ts,gi].join("|")+")"+In+En+")*",Xr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Sn=In+En+Zo,rs="(?:"+[Qo,ts,gi].join("|")+")"+Sn,Xo="(?:"+[mn+$i+"?",$i,ts,gi,Ai].join("|")+")",Os=RegExp(Ss,"g"),ea=RegExp($i,"g"),is=RegExp(es+"(?="+es+")|"+Xo+Sn,"g"),Pn=RegExp([yr+"?"+gn+"+"+bn+"(?="+[Ps,yr,"$"].join("|")+")",Kr+"+"+_n+"(?="+[Ps,yr+wn,"$"].join("|")+")",yr+"?"+wn+"+"+bn,yr+"+"+_n,xn,Xr,dn,rs].join("|"),"g"),On=RegExp("["+vn+Zi+hn+pn+"]"),Di=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ta=-1,Fe={};Fe[ht]=Fe[qe]=Fe[Pt]=Fe[Lt]=Fe[Kt]=Fe[Ft]=Fe[Mt]=Fe[Qt]=Fe[or]=!0,Fe[be]=Fe[xt]=Fe[Ae]=Fe[D]=Fe[Ke]=Fe[N]=Fe[E]=Fe[ie]=Fe[ve]=Fe[Te]=Fe[xe]=Fe[nt]=Fe[Le]=Fe[Je]=Fe[ze]=!1;var ke={};ke[be]=ke[xt]=ke[Ae]=ke[Ke]=ke[D]=ke[N]=ke[ht]=ke[qe]=ke[Pt]=ke[Lt]=ke[Kt]=ke[ve]=ke[Te]=ke[xe]=ke[nt]=ke[Le]=ke[Je]=ke[Qe]=ke[Ft]=ke[Mt]=ke[Qt]=ke[or]=!0,ke[E]=ke[ie]=ke[ze]=!1;var m={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,ge=parseInt,Ze=typeof Qs=="object"&&Qs&&Qs.Object===Object&&Qs,At=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Ze||At||Function("return this")(),Be=r&&!r.nodeType&&r,bt=Be&&!0&&o&&!o.nodeType&&o,ar=bt&&bt.exports===Be,$t=ar&&Ze.process,Xe=function(){try{var P=bt&&bt.require&&bt.require("util").types;return P||$t&&$t.binding&&$t.binding("util")}catch{}}(),Zt=Xe&&Xe.isArrayBuffer,Dr=Xe&&Xe.isDate,xr=Xe&&Xe.isMap,Fr=Xe&&Xe.isRegExp,Cs=Xe&&Xe.isSet,Li=Xe&&Xe.isTypedArray;function Ut(P,z,T){switch(T.length){case 0:return P.call(z);case 1:return P.call(z,T[0]);case 2:return P.call(z,T[0],T[1]);case 3:return P.call(z,T[0],T[1],T[2])}return P.apply(z,T)}function rp(P,z,T,re){for(var de=-1,De=P==null?0:P.length;++de<De;){var jt=P[de];z(re,jt,T(jt),P)}return re}function Sr(P,z){for(var T=-1,re=P==null?0:P.length;++T<re&&z(P[T],T,P)!==!1;);return P}function ip(P,z){for(var T=P==null?0:P.length;T--&&z(P[T],T,P)!==!1;);return P}function Xc(P,z){for(var T=-1,re=P==null?0:P.length;++T<re;)if(!z(P[T],T,P))return!1;return!0}function yi(P,z){for(var T=-1,re=P==null?0:P.length,de=0,De=[];++T<re;){var jt=P[T];z(jt,T,P)&&(De[de++]=jt)}return De}function Nn(P,z){var T=P==null?0:P.length;return!!T&&ss(P,z,0)>-1}function ra(P,z,T){for(var re=-1,de=P==null?0:P.length;++re<de;)if(T(z,P[re]))return!0;return!1}function it(P,z){for(var T=-1,re=P==null?0:P.length,de=Array(re);++T<re;)de[T]=z(P[T],T,P);return de}function mi(P,z){for(var T=-1,re=z.length,de=P.length;++T<re;)P[de+T]=z[T];return P}function ia(P,z,T,re){var de=-1,De=P==null?0:P.length;for(re&&De&&(T=P[++de]);++de<De;)T=z(T,P[de],de,P);return T}function sp(P,z,T,re){var de=P==null?0:P.length;for(re&&de&&(T=P[--de]);de--;)T=z(T,P[de],de,P);return T}function sa(P,z){for(var T=-1,re=P==null?0:P.length;++T<re;)if(z(P[T],T,P))return!0;return!1}var np=na("length");function op(P){return P.split("")}function ap(P){return P.match(Tt)||[]}function eu(P,z,T){var re;return T(P,function(de,De,jt){if(z(de,De,jt))return re=De,!1}),re}function Rn(P,z,T,re){for(var de=P.length,De=T+(re?1:-1);re?De--:++De<de;)if(z(P[De],De,P))return De;return-1}function ss(P,z,T){return z===z?wp(P,z,T):Rn(P,tu,T)}function cp(P,z,T,re){for(var de=T-1,De=P.length;++de<De;)if(re(P[de],z))return de;return-1}function tu(P){return P!==P}function ru(P,z){var T=P==null?0:P.length;return T?aa(P,z)/T:W}function na(P){return function(z){return z==null?t:z[P]}}function oa(P){return function(z){return P==null?t:P[z]}}function iu(P,z,T,re,de){return de(P,function(De,jt,Ge){T=re?(re=!1,De):z(T,De,jt,Ge)}),T}function up(P,z){var T=P.length;for(P.sort(z);T--;)P[T]=P[T].value;return P}function aa(P,z){for(var T,re=-1,de=P.length;++re<de;){var De=z(P[re]);De!==t&&(T=T===t?De:T+De)}return T}function ca(P,z){for(var T=-1,re=Array(P);++T<P;)re[T]=z(T);return re}function hp(P,z){return it(z,function(T){return[T,P[T]]})}function su(P){return P&&P.slice(0,cu(P)+1).replace(gt,"")}function mr(P){return function(z){return P(z)}}function ua(P,z){return it(z,function(T){return P[T]})}function Ns(P,z){return P.has(z)}function nu(P,z){for(var T=-1,re=P.length;++T<re&&ss(z,P[T],0)>-1;);return T}function ou(P,z){for(var T=P.length;T--&&ss(z,P[T],0)>-1;);return T}function lp(P,z){for(var T=P.length,re=0;T--;)P[T]===z&&++re;return re}var fp=oa(m),pp=oa(x);function dp(P){return"\\"+te[P]}function gp(P,z){return P==null?t:P[z]}function ns(P){return On.test(P)}function yp(P){return Di.test(P)}function mp(P){for(var z,T=[];!(z=P.next()).done;)T.push(z.value);return T}function ha(P){var z=-1,T=Array(P.size);return P.forEach(function(re,de){T[++z]=[de,re]}),T}function au(P,z){return function(T){return P(z(T))}}function vi(P,z){for(var T=-1,re=P.length,de=0,De=[];++T<re;){var jt=P[T];(jt===z||jt===b)&&(P[T]=b,De[de++]=T)}return De}function Tn(P){var z=-1,T=Array(P.size);return P.forEach(function(re){T[++z]=re}),T}function vp(P){var z=-1,T=Array(P.size);return P.forEach(function(re){T[++z]=[re,re]}),T}function wp(P,z,T){for(var re=T-1,de=P.length;++re<de;)if(P[re]===z)return re;return-1}function bp(P,z,T){for(var re=T+1;re--;)if(P[re]===z)return re;return re}function os(P){return ns(P)?Ep(P):np(P)}function Lr(P){return ns(P)?Ip(P):op(P)}function cu(P){for(var z=P.length;z--&&wt.test(P.charAt(z)););return z}var _p=oa(B);function Ep(P){for(var z=is.lastIndex=0;is.test(P);)++z;return z}function Ip(P){return P.match(is)||[]}function xp(P){return P.match(Pn)||[]}var Sp=function P(z){z=z==null?Pe:as.defaults(Pe.Object(),z,as.pick(Pe,Cn));var T=z.Array,re=z.Date,de=z.Error,De=z.Function,jt=z.Math,Ge=z.Object,la=z.RegExp,Pp=z.String,Pr=z.TypeError,An=T.prototype,Op=De.prototype,cs=Ge.prototype,$n=z["__core-js_shared__"],Dn=Op.toString,Me=cs.hasOwnProperty,Cp=0,uu=function(){var e=/[^.]+$/.exec($n&&$n.keys&&$n.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ln=cs.toString,Np=Dn.call(Ge),Rp=Pe._,Tp=la("^"+Dn.call(Me).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),jn=ar?z.Buffer:t,wi=z.Symbol,qn=z.Uint8Array,hu=jn?jn.allocUnsafe:t,Mn=au(Ge.getPrototypeOf,Ge),lu=Ge.create,fu=cs.propertyIsEnumerable,Un=An.splice,pu=wi?wi.isConcatSpreadable:t,Rs=wi?wi.iterator:t,ji=wi?wi.toStringTag:t,zn=function(){try{var e=ki(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),Ap=z.clearTimeout!==Pe.clearTimeout&&z.clearTimeout,$p=re&&re.now!==Pe.Date.now&&re.now,Dp=z.setTimeout!==Pe.setTimeout&&z.setTimeout,kn=jt.ceil,Hn=jt.floor,fa=Ge.getOwnPropertySymbols,Lp=jn?jn.isBuffer:t,du=z.isFinite,jp=An.join,qp=au(Ge.keys,Ge),qt=jt.max,Gt=jt.min,Mp=re.now,Up=z.parseInt,gu=jt.random,zp=An.reverse,pa=ki(z,"DataView"),Ts=ki(z,"Map"),da=ki(z,"Promise"),us=ki(z,"Set"),As=ki(z,"WeakMap"),$s=ki(Ge,"create"),Kn=As&&new As,hs={},kp=Hi(pa),Hp=Hi(Ts),Kp=Hi(da),Fp=Hi(us),Vp=Hi(As),Fn=wi?wi.prototype:t,Ds=Fn?Fn.valueOf:t,yu=Fn?Fn.toString:t;function f(e){if(mt(e)&&!ye(e)&&!(e instanceof Se)){if(e instanceof Or)return e;if(Me.call(e,"__wrapped__"))return mh(e)}return new Or(e)}var ls=function(){function e(){}return function(i){if(!ct(i))return{};if(lu)return lu(i);e.prototype=i;var n=new e;return e.prototype=t,n}}();function Vn(){}function Or(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=t}f.templateSettings={escape:ft,evaluate:pt,interpolate:at,variable:"",imports:{_:f}},f.prototype=Vn.prototype,f.prototype.constructor=f,Or.prototype=ls(Vn.prototype),Or.prototype.constructor=Or;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Y,this.__views__=[]}function Bp(){var e=new Se(this.__wrapped__);return e.__actions__=cr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=cr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=cr(this.__views__),e}function Gp(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Wp(){var e=this.__wrapped__.value(),i=this.__dir__,n=ye(e),c=i<0,l=n?e.length:0,d=og(0,l,this.__views__),v=d.start,_=d.end,O=_-v,k=c?_:v-1,H=this.__iteratees__,G=H.length,X=0,se=Gt(O,this.__takeCount__);if(!n||!c&&l==O&&se==O)return zu(e,this.__actions__);var he=[];e:for(;O--&&X<se;){k+=i;for(var we=-1,le=e[k];++we<G;){var Ie=H[we],Oe=Ie.iteratee,br=Ie.type,tr=Oe(le);if(br==V)le=tr;else if(!tr){if(br==A)continue e;break e}}he[X++]=le}return he}Se.prototype=ls(Vn.prototype),Se.prototype.constructor=Se;function qi(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Jp(){this.__data__=$s?$s(null):{},this.size=0}function Qp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Yp(e){var i=this.__data__;if($s){var n=i[e];return n===w?t:n}return Me.call(i,e)?i[e]:t}function Zp(e){var i=this.__data__;return $s?i[e]!==t:Me.call(i,e)}function Xp(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=$s&&i===t?w:i,this}qi.prototype.clear=Jp,qi.prototype.delete=Qp,qi.prototype.get=Yp,qi.prototype.has=Zp,qi.prototype.set=Xp;function ei(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function ed(){this.__data__=[],this.size=0}function td(e){var i=this.__data__,n=Bn(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():Un.call(i,n,1),--this.size,!0}function rd(e){var i=this.__data__,n=Bn(i,e);return n<0?t:i[n][1]}function id(e){return Bn(this.__data__,e)>-1}function sd(e,i){var n=this.__data__,c=Bn(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}ei.prototype.clear=ed,ei.prototype.delete=td,ei.prototype.get=rd,ei.prototype.has=id,ei.prototype.set=sd;function ti(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function nd(){this.size=0,this.__data__={hash:new qi,map:new(Ts||ei),string:new qi}}function od(e){var i=so(this,e).delete(e);return this.size-=i?1:0,i}function ad(e){return so(this,e).get(e)}function cd(e){return so(this,e).has(e)}function ud(e,i){var n=so(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}ti.prototype.clear=nd,ti.prototype.delete=od,ti.prototype.get=ad,ti.prototype.has=cd,ti.prototype.set=ud;function Mi(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new ti;++i<n;)this.add(e[i])}function hd(e){return this.__data__.set(e,w),this}function ld(e){return this.__data__.has(e)}Mi.prototype.add=Mi.prototype.push=hd,Mi.prototype.has=ld;function jr(e){var i=this.__data__=new ei(e);this.size=i.size}function fd(){this.__data__=new ei,this.size=0}function pd(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function dd(e){return this.__data__.get(e)}function gd(e){return this.__data__.has(e)}function yd(e,i){var n=this.__data__;if(n instanceof ei){var c=n.__data__;if(!Ts||c.length<a-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new ti(c)}return n.set(e,i),this.size=n.size,this}jr.prototype.clear=fd,jr.prototype.delete=pd,jr.prototype.get=dd,jr.prototype.has=gd,jr.prototype.set=yd;function mu(e,i){var n=ye(e),c=!n&&Ki(e),l=!n&&!c&&xi(e),d=!n&&!c&&!l&&gs(e),v=n||c||l||d,_=v?ca(e.length,Pp):[],O=_.length;for(var k in e)(i||Me.call(e,k))&&!(v&&(k=="length"||l&&(k=="offset"||k=="parent")||d&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||ni(k,O)))&&_.push(k);return _}function vu(e){var i=e.length;return i?e[Sa(0,i-1)]:t}function md(e,i){return no(cr(e),Ui(i,0,e.length))}function vd(e){return no(cr(e))}function ga(e,i,n){(n!==t&&!qr(e[i],n)||n===t&&!(i in e))&&ri(e,i,n)}function Ls(e,i,n){var c=e[i];(!(Me.call(e,i)&&qr(c,n))||n===t&&!(i in e))&&ri(e,i,n)}function Bn(e,i){for(var n=e.length;n--;)if(qr(e[n][0],i))return n;return-1}function wd(e,i,n,c){return bi(e,function(l,d,v){i(c,l,n(l),v)}),c}function wu(e,i){return e&&Br(i,zt(i),e)}function bd(e,i){return e&&Br(i,hr(i),e)}function ri(e,i,n){i=="__proto__"&&zn?zn(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function ya(e,i){for(var n=-1,c=i.length,l=T(c),d=e==null;++n<c;)l[n]=d?t:Qa(e,i[n]);return l}function Ui(e,i,n){return e===e&&(n!==t&&(e=e<=n?e:n),i!==t&&(e=e>=i?e:i)),e}function Cr(e,i,n,c,l,d){var v,_=i&S,O=i&R,k=i&F;if(n&&(v=l?n(e,c,l,d):n(e)),v!==t)return v;if(!ct(e))return e;var H=ye(e);if(H){if(v=cg(e),!_)return cr(e,v)}else{var G=Wt(e),X=G==ie||G==pe;if(xi(e))return Ku(e,_);if(G==xe||G==be||X&&!l){if(v=O||X?{}:ch(e),!_)return O?Yd(e,bd(v,e)):Qd(e,wu(v,e))}else{if(!ke[G])return l?e:{};v=ug(e,G,_)}}d||(d=new jr);var se=d.get(e);if(se)return se;d.set(e,v),qh(e)?e.forEach(function(le){v.add(Cr(le,i,n,le,e,d))}):Lh(e)&&e.forEach(function(le,Ie){v.set(Ie,Cr(le,i,n,Ie,e,d))});var he=k?O?ja:La:O?hr:zt,we=H?t:he(e);return Sr(we||e,function(le,Ie){we&&(Ie=le,le=e[Ie]),Ls(v,Ie,Cr(le,i,n,Ie,e,d))}),v}function _d(e){var i=zt(e);return function(n){return bu(n,e,i)}}function bu(e,i,n){var c=n.length;if(e==null)return!c;for(e=Ge(e);c--;){var l=n[c],d=i[l],v=e[l];if(v===t&&!(l in e)||!d(v))return!1}return!0}function _u(e,i,n){if(typeof e!="function")throw new Pr(p);return Hs(function(){e.apply(t,n)},i)}function js(e,i,n,c){var l=-1,d=Nn,v=!0,_=e.length,O=[],k=i.length;if(!_)return O;n&&(i=it(i,mr(n))),c?(d=ra,v=!1):i.length>=a&&(d=Ns,v=!1,i=new Mi(i));e:for(;++l<_;){var H=e[l],G=n==null?H:n(H);if(H=c||H!==0?H:0,v&&G===G){for(var X=k;X--;)if(i[X]===G)continue e;O.push(H)}else d(i,G,c)||O.push(H)}return O}var bi=Wu(Vr),Eu=Wu(va,!0);function Ed(e,i){var n=!0;return bi(e,function(c,l,d){return n=!!i(c,l,d),n}),n}function Gn(e,i,n){for(var c=-1,l=e.length;++c<l;){var d=e[c],v=i(d);if(v!=null&&(_===t?v===v&&!wr(v):n(v,_)))var _=v,O=d}return O}function Id(e,i,n,c){var l=e.length;for(n=me(n),n<0&&(n=-n>l?0:l+n),c=c===t||c>l?l:me(c),c<0&&(c+=l),c=n>c?0:Uh(c);n<c;)e[n++]=i;return e}function Iu(e,i){var n=[];return bi(e,function(c,l,d){i(c,l,d)&&n.push(c)}),n}function Vt(e,i,n,c,l){var d=-1,v=e.length;for(n||(n=lg),l||(l=[]);++d<v;){var _=e[d];i>0&&n(_)?i>1?Vt(_,i-1,n,c,l):mi(l,_):c||(l[l.length]=_)}return l}var ma=Ju(),xu=Ju(!0);function Vr(e,i){return e&&ma(e,i,zt)}function va(e,i){return e&&xu(e,i,zt)}function Wn(e,i){return yi(i,function(n){return oi(e[n])})}function zi(e,i){i=Ei(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[Gr(i[n++])];return n&&n==c?e:t}function Su(e,i,n){var c=i(e);return ye(e)?c:mi(c,n(e))}function Xt(e){return e==null?e===t?ot:$e:ji&&ji in Ge(e)?ng(e):vg(e)}function wa(e,i){return e>i}function xd(e,i){return e!=null&&Me.call(e,i)}function Sd(e,i){return e!=null&&i in Ge(e)}function Pd(e,i,n){return e>=Gt(i,n)&&e<qt(i,n)}function ba(e,i,n){for(var c=n?ra:Nn,l=e[0].length,d=e.length,v=d,_=T(d),O=1/0,k=[];v--;){var H=e[v];v&&i&&(H=it(H,mr(i))),O=Gt(H.length,O),_[v]=!n&&(i||l>=120&&H.length>=120)?new Mi(v&&H):t}H=e[0];var G=-1,X=_[0];e:for(;++G<l&&k.length<O;){var se=H[G],he=i?i(se):se;if(se=n||se!==0?se:0,!(X?Ns(X,he):c(k,he,n))){for(v=d;--v;){var we=_[v];if(!(we?Ns(we,he):c(e[v],he,n)))continue e}X&&X.push(he),k.push(se)}}return k}function Od(e,i,n,c){return Vr(e,function(l,d,v){i(c,n(l),d,v)}),c}function qs(e,i,n){i=Ei(i,e),e=fh(e,i);var c=e==null?e:e[Gr(Rr(i))];return c==null?t:Ut(c,e,n)}function Pu(e){return mt(e)&&Xt(e)==be}function Cd(e){return mt(e)&&Xt(e)==Ae}function Nd(e){return mt(e)&&Xt(e)==N}function Ms(e,i,n,c,l){return e===i?!0:e==null||i==null||!mt(e)&&!mt(i)?e!==e&&i!==i:Rd(e,i,n,c,Ms,l)}function Rd(e,i,n,c,l,d){var v=ye(e),_=ye(i),O=v?xt:Wt(e),k=_?xt:Wt(i);O=O==be?xe:O,k=k==be?xe:k;var H=O==xe,G=k==xe,X=O==k;if(X&&xi(e)){if(!xi(i))return!1;v=!0,H=!1}if(X&&!H)return d||(d=new jr),v||gs(e)?nh(e,i,n,c,l,d):ig(e,i,O,n,c,l,d);if(!(n&q)){var se=H&&Me.call(e,"__wrapped__"),he=G&&Me.call(i,"__wrapped__");if(se||he){var we=se?e.value():e,le=he?i.value():i;return d||(d=new jr),l(we,le,n,c,d)}}return X?(d||(d=new jr),sg(e,i,n,c,l,d)):!1}function Td(e){return mt(e)&&Wt(e)==ve}function _a(e,i,n,c){var l=n.length,d=l,v=!c;if(e==null)return!d;for(e=Ge(e);l--;){var _=n[l];if(v&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<d;){_=n[l];var O=_[0],k=e[O],H=_[1];if(v&&_[2]){if(k===t&&!(O in e))return!1}else{var G=new jr;if(c)var X=c(k,H,O,e,i,G);if(!(X===t?Ms(H,k,q|J,c,G):X))return!1}}return!0}function Ou(e){if(!ct(e)||pg(e))return!1;var i=oi(e)?Tp:zo;return i.test(Hi(e))}function Ad(e){return mt(e)&&Xt(e)==nt}function $d(e){return mt(e)&&Wt(e)==Le}function Dd(e){return mt(e)&&lo(e.length)&&!!Fe[Xt(e)]}function Cu(e){return typeof e=="function"?e:e==null?lr:typeof e=="object"?ye(e)?Tu(e[0],e[1]):Ru(e):Qh(e)}function Ea(e){if(!ks(e))return qp(e);var i=[];for(var n in Ge(e))Me.call(e,n)&&n!="constructor"&&i.push(n);return i}function Ld(e){if(!ct(e))return mg(e);var i=ks(e),n=[];for(var c in e)c=="constructor"&&(i||!Me.call(e,c))||n.push(c);return n}function Ia(e,i){return e<i}function Nu(e,i){var n=-1,c=ur(e)?T(e.length):[];return bi(e,function(l,d,v){c[++n]=i(l,d,v)}),c}function Ru(e){var i=Ma(e);return i.length==1&&i[0][2]?hh(i[0][0],i[0][1]):function(n){return n===e||_a(n,e,i)}}function Tu(e,i){return za(e)&&uh(i)?hh(Gr(e),i):function(n){var c=Qa(n,e);return c===t&&c===i?Ya(n,e):Ms(i,c,q|J)}}function Jn(e,i,n,c,l){e!==i&&ma(i,function(d,v){if(l||(l=new jr),ct(d))jd(e,i,v,n,Jn,c,l);else{var _=c?c(Ha(e,v),d,v+"",e,i,l):t;_===t&&(_=d),ga(e,v,_)}},hr)}function jd(e,i,n,c,l,d,v){var _=Ha(e,n),O=Ha(i,n),k=v.get(O);if(k){ga(e,n,k);return}var H=d?d(_,O,n+"",e,i,v):t,G=H===t;if(G){var X=ye(O),se=!X&&xi(O),he=!X&&!se&&gs(O);H=O,X||se||he?ye(_)?H=_:_t(_)?H=cr(_):se?(G=!1,H=Ku(O,!0)):he?(G=!1,H=Fu(O,!0)):H=[]:Ks(O)||Ki(O)?(H=_,Ki(_)?H=zh(_):(!ct(_)||oi(_))&&(H=ch(O))):G=!1}G&&(v.set(O,H),l(H,O,c,d,v),v.delete(O)),ga(e,n,H)}function Au(e,i){var n=e.length;if(n)return i+=i<0?n:0,ni(i,n)?e[i]:t}function $u(e,i,n){i.length?i=it(i,function(d){return ye(d)?function(v){return zi(v,d.length===1?d[0]:d)}:d}):i=[lr];var c=-1;i=it(i,mr(ue()));var l=Nu(e,function(d,v,_){var O=it(i,function(k){return k(d)});return{criteria:O,index:++c,value:d}});return up(l,function(d,v){return Jd(d,v,n)})}function qd(e,i){return Du(e,i,function(n,c){return Ya(e,c)})}function Du(e,i,n){for(var c=-1,l=i.length,d={};++c<l;){var v=i[c],_=zi(e,v);n(_,v)&&Us(d,Ei(v,e),_)}return d}function Md(e){return function(i){return zi(i,e)}}function xa(e,i,n,c){var l=c?cp:ss,d=-1,v=i.length,_=e;for(e===i&&(i=cr(i)),n&&(_=it(e,mr(n)));++d<v;)for(var O=0,k=i[d],H=n?n(k):k;(O=l(_,H,O,c))>-1;)_!==e&&Un.call(_,O,1),Un.call(e,O,1);return e}function Lu(e,i){for(var n=e?i.length:0,c=n-1;n--;){var l=i[n];if(n==c||l!==d){var d=l;ni(l)?Un.call(e,l,1):Ca(e,l)}}return e}function Sa(e,i){return e+Hn(gu()*(i-e+1))}function Ud(e,i,n,c){for(var l=-1,d=qt(kn((i-e)/(n||1)),0),v=T(d);d--;)v[c?d:++l]=e,e+=n;return v}function Pa(e,i){var n="";if(!e||i<1||i>ee)return n;do i%2&&(n+=e),i=Hn(i/2),i&&(e+=e);while(i);return n}function _e(e,i){return Ka(lh(e,i,lr),e+"")}function zd(e){return vu(ys(e))}function kd(e,i){var n=ys(e);return no(n,Ui(i,0,n.length))}function Us(e,i,n,c){if(!ct(e))return e;i=Ei(i,e);for(var l=-1,d=i.length,v=d-1,_=e;_!=null&&++l<d;){var O=Gr(i[l]),k=n;if(O==="__proto__"||O==="constructor"||O==="prototype")return e;if(l!=v){var H=_[O];k=c?c(H,O,_):t,k===t&&(k=ct(H)?H:ni(i[l+1])?[]:{})}Ls(_,O,k),_=_[O]}return e}var ju=Kn?function(e,i){return Kn.set(e,i),e}:lr,Hd=zn?function(e,i){return zn(e,"toString",{configurable:!0,enumerable:!1,value:Xa(i),writable:!0})}:lr;function Kd(e){return no(ys(e))}function Nr(e,i,n){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),n=n>l?l:n,n<0&&(n+=l),l=i>n?0:n-i>>>0,i>>>=0;for(var d=T(l);++c<l;)d[c]=e[c+i];return d}function Fd(e,i){var n;return bi(e,function(c,l,d){return n=i(c,l,d),!n}),!!n}function Qn(e,i,n){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=He){for(;c<l;){var d=c+l>>>1,v=e[d];v!==null&&!wr(v)&&(n?v<=i:v<i)?c=d+1:l=d}return l}return Oa(e,i,lr,n)}function Oa(e,i,n,c){var l=0,d=e==null?0:e.length;if(d===0)return 0;i=n(i);for(var v=i!==i,_=i===null,O=wr(i),k=i===t;l<d;){var H=Hn((l+d)/2),G=n(e[H]),X=G!==t,se=G===null,he=G===G,we=wr(G);if(v)var le=c||he;else k?le=he&&(c||X):_?le=he&&X&&(c||!se):O?le=he&&X&&!se&&(c||!we):se||we?le=!1:le=c?G<=i:G<i;le?l=H+1:d=H}return Gt(d,ut)}function qu(e,i){for(var n=-1,c=e.length,l=0,d=[];++n<c;){var v=e[n],_=i?i(v):v;if(!n||!qr(_,O)){var O=_;d[l++]=v===0?0:v}}return d}function Mu(e){return typeof e=="number"?e:wr(e)?W:+e}function vr(e){if(typeof e=="string")return e;if(ye(e))return it(e,vr)+"";if(wr(e))return yu?yu.call(e):"";var i=e+"";return i=="0"&&1/e==-Re?"-0":i}function _i(e,i,n){var c=-1,l=Nn,d=e.length,v=!0,_=[],O=_;if(n)v=!1,l=ra;else if(d>=a){var k=i?null:tg(e);if(k)return Tn(k);v=!1,l=Ns,O=new Mi}else O=i?[]:_;e:for(;++c<d;){var H=e[c],G=i?i(H):H;if(H=n||H!==0?H:0,v&&G===G){for(var X=O.length;X--;)if(O[X]===G)continue e;i&&O.push(G),_.push(H)}else l(O,G,n)||(O!==_&&O.push(G),_.push(H))}return _}function Ca(e,i){return i=Ei(i,e),e=fh(e,i),e==null||delete e[Gr(Rr(i))]}function Uu(e,i,n,c){return Us(e,i,n(zi(e,i)),c)}function Yn(e,i,n,c){for(var l=e.length,d=c?l:-1;(c?d--:++d<l)&&i(e[d],d,e););return n?Nr(e,c?0:d,c?d+1:l):Nr(e,c?d+1:0,c?l:d)}function zu(e,i){var n=e;return n instanceof Se&&(n=n.value()),ia(i,function(c,l){return l.func.apply(l.thisArg,mi([c],l.args))},n)}function Na(e,i,n){var c=e.length;if(c<2)return c?_i(e[0]):[];for(var l=-1,d=T(c);++l<c;)for(var v=e[l],_=-1;++_<c;)_!=l&&(d[l]=js(d[l]||v,e[_],i,n));return _i(Vt(d,1),i,n)}function ku(e,i,n){for(var c=-1,l=e.length,d=i.length,v={};++c<l;){var _=c<d?i[c]:t;n(v,e[c],_)}return v}function Ra(e){return _t(e)?e:[]}function Ta(e){return typeof e=="function"?e:lr}function Ei(e,i){return ye(e)?e:za(e,i)?[e]:yh(je(e))}var Vd=_e;function Ii(e,i,n){var c=e.length;return n=n===t?c:n,!i&&n>=c?e:Nr(e,i,n)}var Hu=Ap||function(e){return Pe.clearTimeout(e)};function Ku(e,i){if(i)return e.slice();var n=e.length,c=hu?hu(n):new e.constructor(n);return e.copy(c),c}function Aa(e){var i=new e.constructor(e.byteLength);return new qn(i).set(new qn(e)),i}function Bd(e,i){var n=i?Aa(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Gd(e){var i=new e.constructor(e.source,Ir.exec(e));return i.lastIndex=e.lastIndex,i}function Wd(e){return Ds?Ge(Ds.call(e)):{}}function Fu(e,i){var n=i?Aa(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Vu(e,i){if(e!==i){var n=e!==t,c=e===null,l=e===e,d=wr(e),v=i!==t,_=i===null,O=i===i,k=wr(i);if(!_&&!k&&!d&&e>i||d&&v&&O&&!_&&!k||c&&v&&O||!n&&O||!l)return 1;if(!c&&!d&&!k&&e<i||k&&n&&l&&!c&&!d||_&&n&&l||!v&&l||!O)return-1}return 0}function Jd(e,i,n){for(var c=-1,l=e.criteria,d=i.criteria,v=l.length,_=n.length;++c<v;){var O=Vu(l[c],d[c]);if(O){if(c>=_)return O;var k=n[c];return O*(k=="desc"?-1:1)}}return e.index-i.index}function Bu(e,i,n,c){for(var l=-1,d=e.length,v=n.length,_=-1,O=i.length,k=qt(d-v,0),H=T(O+k),G=!c;++_<O;)H[_]=i[_];for(;++l<v;)(G||l<d)&&(H[n[l]]=e[l]);for(;k--;)H[_++]=e[l++];return H}function Gu(e,i,n,c){for(var l=-1,d=e.length,v=-1,_=n.length,O=-1,k=i.length,H=qt(d-_,0),G=T(H+k),X=!c;++l<H;)G[l]=e[l];for(var se=l;++O<k;)G[se+O]=i[O];for(;++v<_;)(X||l<d)&&(G[se+n[v]]=e[l++]);return G}function cr(e,i){var n=-1,c=e.length;for(i||(i=T(c));++n<c;)i[n]=e[n];return i}function Br(e,i,n,c){var l=!n;n||(n={});for(var d=-1,v=i.length;++d<v;){var _=i[d],O=c?c(n[_],e[_],_,n,e):t;O===t&&(O=e[_]),l?ri(n,_,O):Ls(n,_,O)}return n}function Qd(e,i){return Br(e,Ua(e),i)}function Yd(e,i){return Br(e,oh(e),i)}function Zn(e,i){return function(n,c){var l=ye(n)?rp:wd,d=i?i():{};return l(n,e,ue(c,2),d)}}function fs(e){return _e(function(i,n){var c=-1,l=n.length,d=l>1?n[l-1]:t,v=l>2?n[2]:t;for(d=e.length>3&&typeof d=="function"?(l--,d):t,v&&er(n[0],n[1],v)&&(d=l<3?t:d,l=1),i=Ge(i);++c<l;){var _=n[c];_&&e(i,_,c,d)}return i})}function Wu(e,i){return function(n,c){if(n==null)return n;if(!ur(n))return e(n,c);for(var l=n.length,d=i?l:-1,v=Ge(n);(i?d--:++d<l)&&c(v[d],d,v)!==!1;);return n}}function Ju(e){return function(i,n,c){for(var l=-1,d=Ge(i),v=c(i),_=v.length;_--;){var O=v[e?_:++l];if(n(d[O],O,d)===!1)break}return i}}function Zd(e,i,n){var c=i&oe,l=zs(e);function d(){var v=this&&this!==Pe&&this instanceof d?l:e;return v.apply(c?n:this,arguments)}return d}function Qu(e){return function(i){i=je(i);var n=ns(i)?Lr(i):t,c=n?n[0]:i.charAt(0),l=n?Ii(n,1).join(""):i.slice(1);return c[e]()+l}}function ps(e){return function(i){return ia(Wh(Gh(i).replace(Os,"")),e,"")}}function zs(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=ls(e.prototype),c=e.apply(n,i);return ct(c)?c:n}}function Xd(e,i,n){var c=zs(e);function l(){for(var d=arguments.length,v=T(d),_=d,O=ds(l);_--;)v[_]=arguments[_];var k=d<3&&v[0]!==O&&v[d-1]!==O?[]:vi(v,O);if(d-=k.length,d<n)return th(e,i,Xn,l.placeholder,t,v,k,t,t,n-d);var H=this&&this!==Pe&&this instanceof l?c:e;return Ut(H,this,v)}return l}function Yu(e){return function(i,n,c){var l=Ge(i);if(!ur(i)){var d=ue(n,3);i=zt(i),n=function(_){return d(l[_],_,l)}}var v=e(i,n,c);return v>-1?l[d?i[v]:v]:t}}function Zu(e){return si(function(i){var n=i.length,c=n,l=Or.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new Pr(p);if(l&&!v&&io(d)=="wrapper")var v=new Or([],!0)}for(c=v?c:n;++c<n;){d=i[c];var _=io(d),O=_=="wrapper"?qa(d):t;O&&ka(O[0])&&O[1]==(L|$|M|K)&&!O[4].length&&O[9]==1?v=v[io(O[0])].apply(v,O[3]):v=d.length==1&&ka(d)?v[_]():v.thru(d)}return function(){var k=arguments,H=k[0];if(v&&k.length==1&&ye(H))return v.plant(H).value();for(var G=0,X=n?i[G].apply(this,k):H;++G<n;)X=i[G].call(this,X);return X}})}function Xn(e,i,n,c,l,d,v,_,O,k){var H=i&L,G=i&oe,X=i&fe,se=i&($|U),he=i&ce,we=X?t:zs(e);function le(){for(var Ie=arguments.length,Oe=T(Ie),br=Ie;br--;)Oe[br]=arguments[br];if(se)var tr=ds(le),_r=lp(Oe,tr);if(c&&(Oe=Bu(Oe,c,l,se)),d&&(Oe=Gu(Oe,d,v,se)),Ie-=_r,se&&Ie<k){var Et=vi(Oe,tr);return th(e,i,Xn,le.placeholder,n,Oe,Et,_,O,k-Ie)}var Mr=G?n:this,ci=X?Mr[e]:e;return Ie=Oe.length,_?Oe=wg(Oe,_):he&&Ie>1&&Oe.reverse(),H&&O<Ie&&(Oe.length=O),this&&this!==Pe&&this instanceof le&&(ci=we||zs(ci)),ci.apply(Mr,Oe)}return le}function Xu(e,i){return function(n,c){return Od(n,e,i(c),{})}}function eo(e,i){return function(n,c){var l;if(n===t&&c===t)return i;if(n!==t&&(l=n),c!==t){if(l===t)return c;typeof n=="string"||typeof c=="string"?(n=vr(n),c=vr(c)):(n=Mu(n),c=Mu(c)),l=e(n,c)}return l}}function $a(e){return si(function(i){return i=it(i,mr(ue())),_e(function(n){var c=this;return e(i,function(l){return Ut(l,c,n)})})})}function to(e,i){i=i===t?" ":vr(i);var n=i.length;if(n<2)return n?Pa(i,e):i;var c=Pa(i,kn(e/os(i)));return ns(i)?Ii(Lr(c),0,e).join(""):c.slice(0,e)}function eg(e,i,n,c){var l=i&oe,d=zs(e);function v(){for(var _=-1,O=arguments.length,k=-1,H=c.length,G=T(H+O),X=this&&this!==Pe&&this instanceof v?d:e;++k<H;)G[k]=c[k];for(;O--;)G[k++]=arguments[++_];return Ut(X,l?n:this,G)}return v}function eh(e){return function(i,n,c){return c&&typeof c!="number"&&er(i,n,c)&&(n=c=t),i=ai(i),n===t?(n=i,i=0):n=ai(n),c=c===t?i<n?1:-1:ai(c),Ud(i,n,c,e)}}function ro(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=Tr(i),n=Tr(n)),e(i,n)}}function th(e,i,n,c,l,d,v,_,O,k){var H=i&$,G=H?v:t,X=H?t:v,se=H?d:t,he=H?t:d;i|=H?M:I,i&=~(H?I:M),i&C||(i&=~(oe|fe));var we=[e,i,l,se,G,he,X,_,O,k],le=n.apply(t,we);return ka(e)&&ph(le,we),le.placeholder=c,dh(le,e,i)}function Da(e){var i=jt[e];return function(n,c){if(n=Tr(n),c=c==null?0:Gt(me(c),292),c&&du(n)){var l=(je(n)+"e").split("e"),d=i(l[0]+"e"+(+l[1]+c));return l=(je(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(n)}}var tg=us&&1/Tn(new us([,-0]))[1]==Re?function(e){return new us(e)}:rc;function rh(e){return function(i){var n=Wt(i);return n==ve?ha(i):n==Le?vp(i):hp(i,e(i))}}function ii(e,i,n,c,l,d,v,_){var O=i&fe;if(!O&&typeof e!="function")throw new Pr(p);var k=c?c.length:0;if(k||(i&=~(M|I),c=l=t),v=v===t?v:qt(me(v),0),_=_===t?_:me(_),k-=l?l.length:0,i&I){var H=c,G=l;c=l=t}var X=O?t:qa(e),se=[e,i,n,c,l,H,G,d,v,_];if(X&&yg(se,X),e=se[0],i=se[1],n=se[2],c=se[3],l=se[4],_=se[9]=se[9]===t?O?0:e.length:qt(se[9]-k,0),!_&&i&($|U)&&(i&=~($|U)),!i||i==oe)var he=Zd(e,i,n);else i==$||i==U?he=Xd(e,i,_):(i==M||i==(oe|M))&&!l.length?he=eg(e,i,n,c):he=Xn.apply(t,se);var we=X?ju:ph;return dh(we(he,se),e,i)}function ih(e,i,n,c){return e===t||qr(e,cs[n])&&!Me.call(c,n)?i:e}function sh(e,i,n,c,l,d){return ct(e)&&ct(i)&&(d.set(i,e),Jn(e,i,t,sh,d),d.delete(i)),e}function rg(e){return Ks(e)?t:e}function nh(e,i,n,c,l,d){var v=n&q,_=e.length,O=i.length;if(_!=O&&!(v&&O>_))return!1;var k=d.get(e),H=d.get(i);if(k&&H)return k==i&&H==e;var G=-1,X=!0,se=n&J?new Mi:t;for(d.set(e,i),d.set(i,e);++G<_;){var he=e[G],we=i[G];if(c)var le=v?c(we,he,G,i,e,d):c(he,we,G,e,i,d);if(le!==t){if(le)continue;X=!1;break}if(se){if(!sa(i,function(Ie,Oe){if(!Ns(se,Oe)&&(he===Ie||l(he,Ie,n,c,d)))return se.push(Oe)})){X=!1;break}}else if(!(he===we||l(he,we,n,c,d))){X=!1;break}}return d.delete(e),d.delete(i),X}function ig(e,i,n,c,l,d,v){switch(n){case Ke:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Ae:return!(e.byteLength!=i.byteLength||!d(new qn(e),new qn(i)));case D:case N:case Te:return qr(+e,+i);case E:return e.name==i.name&&e.message==i.message;case nt:case Je:return e==i+"";case ve:var _=ha;case Le:var O=c&q;if(_||(_=Tn),e.size!=i.size&&!O)return!1;var k=v.get(e);if(k)return k==i;c|=J,v.set(e,i);var H=nh(_(e),_(i),c,l,d,v);return v.delete(e),H;case Qe:if(Ds)return Ds.call(e)==Ds.call(i)}return!1}function sg(e,i,n,c,l,d){var v=n&q,_=La(e),O=_.length,k=La(i),H=k.length;if(O!=H&&!v)return!1;for(var G=O;G--;){var X=_[G];if(!(v?X in i:Me.call(i,X)))return!1}var se=d.get(e),he=d.get(i);if(se&&he)return se==i&&he==e;var we=!0;d.set(e,i),d.set(i,e);for(var le=v;++G<O;){X=_[G];var Ie=e[X],Oe=i[X];if(c)var br=v?c(Oe,Ie,X,i,e,d):c(Ie,Oe,X,e,i,d);if(!(br===t?Ie===Oe||l(Ie,Oe,n,c,d):br)){we=!1;break}le||(le=X=="constructor")}if(we&&!le){var tr=e.constructor,_r=i.constructor;tr!=_r&&"constructor"in e&&"constructor"in i&&!(typeof tr=="function"&&tr instanceof tr&&typeof _r=="function"&&_r instanceof _r)&&(we=!1)}return d.delete(e),d.delete(i),we}function si(e){return Ka(lh(e,t,bh),e+"")}function La(e){return Su(e,zt,Ua)}function ja(e){return Su(e,hr,oh)}var qa=Kn?function(e){return Kn.get(e)}:rc;function io(e){for(var i=e.name+"",n=hs[i],c=Me.call(hs,i)?n.length:0;c--;){var l=n[c],d=l.func;if(d==null||d==e)return l.name}return i}function ds(e){var i=Me.call(f,"placeholder")?f:e;return i.placeholder}function ue(){var e=f.iteratee||ec;return e=e===ec?Cu:e,arguments.length?e(arguments[0],arguments[1]):e}function so(e,i){var n=e.__data__;return fg(i)?n[typeof i=="string"?"string":"hash"]:n.map}function Ma(e){for(var i=zt(e),n=i.length;n--;){var c=i[n],l=e[c];i[n]=[c,l,uh(l)]}return i}function ki(e,i){var n=gp(e,i);return Ou(n)?n:t}function ng(e){var i=Me.call(e,ji),n=e[ji];try{e[ji]=t;var c=!0}catch{}var l=Ln.call(e);return c&&(i?e[ji]=n:delete e[ji]),l}var Ua=fa?function(e){return e==null?[]:(e=Ge(e),yi(fa(e),function(i){return fu.call(e,i)}))}:ic,oh=fa?function(e){for(var i=[];e;)mi(i,Ua(e)),e=Mn(e);return i}:ic,Wt=Xt;(pa&&Wt(new pa(new ArrayBuffer(1)))!=Ke||Ts&&Wt(new Ts)!=ve||da&&Wt(da.resolve())!=St||us&&Wt(new us)!=Le||As&&Wt(new As)!=ze)&&(Wt=function(e){var i=Xt(e),n=i==xe?e.constructor:t,c=n?Hi(n):"";if(c)switch(c){case kp:return Ke;case Hp:return ve;case Kp:return St;case Fp:return Le;case Vp:return ze}return i});function og(e,i,n){for(var c=-1,l=n.length;++c<l;){var d=n[c],v=d.size;switch(d.type){case"drop":e+=v;break;case"dropRight":i-=v;break;case"take":i=Gt(i,e+v);break;case"takeRight":e=qt(e,i-v);break}}return{start:e,end:i}}function ag(e){var i=e.match(We);return i?i[1].split(Rt):[]}function ah(e,i,n){i=Ei(i,e);for(var c=-1,l=i.length,d=!1;++c<l;){var v=Gr(i[c]);if(!(d=e!=null&&n(e,v)))break;e=e[v]}return d||++c!=l?d:(l=e==null?0:e.length,!!l&&lo(l)&&ni(v,l)&&(ye(e)||Ki(e)))}function cg(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&Me.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function ch(e){return typeof e.constructor=="function"&&!ks(e)?ls(Mn(e)):{}}function ug(e,i,n){var c=e.constructor;switch(i){case Ae:return Aa(e);case D:case N:return new c(+e);case Ke:return Bd(e,n);case ht:case qe:case Pt:case Lt:case Kt:case Ft:case Mt:case Qt:case or:return Fu(e,n);case ve:return new c;case Te:case Je:return new c(e);case nt:return Gd(e);case Le:return new c;case Qe:return Wd(e)}}function hg(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function lg(e){return ye(e)||Ki(e)||!!(pu&&e&&e[pu])}function ni(e,i){var n=typeof e;return i=i??ee,!!i&&(n=="number"||n!="symbol"&&Ho.test(e))&&e>-1&&e%1==0&&e<i}function er(e,i,n){if(!ct(n))return!1;var c=typeof i;return(c=="number"?ur(n)&&ni(i,n.length):c=="string"&&i in n)?qr(n[i],e):!1}function za(e,i){if(ye(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||wr(e)?!0:Ot.test(e)||!rt.test(e)||i!=null&&e in Ge(i)}function fg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function ka(e){var i=io(e),n=f[i];if(typeof n!="function"||!(i in Se.prototype))return!1;if(e===n)return!0;var c=qa(n);return!!c&&e===c[0]}function pg(e){return!!uu&&uu in e}var dg=$n?oi:sc;function ks(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||cs;return e===n}function uh(e){return e===e&&!ct(e)}function hh(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==t||e in Ge(n))}}function gg(e){var i=uo(e,function(c){return n.size===y&&n.clear(),c}),n=i.cache;return i}function yg(e,i){var n=e[1],c=i[1],l=n|c,d=l<(oe|fe|L),v=c==L&&n==$||c==L&&n==K&&e[7].length<=i[8]||c==(L|K)&&i[7].length<=i[8]&&n==$;if(!(d||v))return e;c&oe&&(e[2]=i[2],l|=n&oe?0:C);var _=i[3];if(_){var O=e[3];e[3]=O?Bu(O,_,i[4]):_,e[4]=O?vi(e[3],b):i[4]}return _=i[5],_&&(O=e[5],e[5]=O?Gu(O,_,i[6]):_,e[6]=O?vi(e[5],b):i[6]),_=i[7],_&&(e[7]=_),c&L&&(e[8]=e[8]==null?i[8]:Gt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function mg(e){var i=[];if(e!=null)for(var n in Ge(e))i.push(n);return i}function vg(e){return Ln.call(e)}function lh(e,i,n){return i=qt(i===t?e.length-1:i,0),function(){for(var c=arguments,l=-1,d=qt(c.length-i,0),v=T(d);++l<d;)v[l]=c[i+l];l=-1;for(var _=T(i+1);++l<i;)_[l]=c[l];return _[i]=n(v),Ut(e,this,_)}}function fh(e,i){return i.length<2?e:zi(e,Nr(i,0,-1))}function wg(e,i){for(var n=e.length,c=Gt(i.length,n),l=cr(e);c--;){var d=i[c];e[c]=ni(d,n)?l[d]:t}return e}function Ha(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var ph=gh(ju),Hs=Dp||function(e,i){return Pe.setTimeout(e,i)},Ka=gh(Hd);function dh(e,i,n){var c=i+"";return Ka(e,hg(c,bg(ag(c),n)))}function gh(e){var i=0,n=0;return function(){var c=Mp(),l=et-(c-n);if(n=c,l>0){if(++i>=Ne)return arguments[0]}else i=0;return e.apply(t,arguments)}}function no(e,i){var n=-1,c=e.length,l=c-1;for(i=i===t?c:i;++n<i;){var d=Sa(n,l),v=e[d];e[d]=e[n],e[n]=v}return e.length=i,e}var yh=gg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Ct,function(n,c,l,d){i.push(l?d.replace(jo,"$1"):c||n)}),i});function Gr(e){if(typeof e=="string"||wr(e))return e;var i=e+"";return i=="0"&&1/e==-Re?"-0":i}function Hi(e){if(e!=null){try{return Dn.call(e)}catch{}try{return e+""}catch{}}return""}function bg(e,i){return Sr(kr,function(n){var c="_."+n[0];i&n[1]&&!Nn(e,c)&&e.push(c)}),e.sort()}function mh(e){if(e instanceof Se)return e.clone();var i=new Or(e.__wrapped__,e.__chain__);return i.__actions__=cr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function _g(e,i,n){(n?er(e,i,n):i===t)?i=1:i=qt(me(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,d=0,v=T(kn(c/i));l<c;)v[d++]=Nr(e,l,l+=i);return v}function Eg(e){for(var i=-1,n=e==null?0:e.length,c=0,l=[];++i<n;){var d=e[i];d&&(l[c++]=d)}return l}function Ig(){var e=arguments.length;if(!e)return[];for(var i=T(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return mi(ye(n)?cr(n):[n],Vt(i,1))}var xg=_e(function(e,i){return _t(e)?js(e,Vt(i,1,_t,!0)):[]}),Sg=_e(function(e,i){var n=Rr(i);return _t(n)&&(n=t),_t(e)?js(e,Vt(i,1,_t,!0),ue(n,2)):[]}),Pg=_e(function(e,i){var n=Rr(i);return _t(n)&&(n=t),_t(e)?js(e,Vt(i,1,_t,!0),t,n):[]});function Og(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===t?1:me(i),Nr(e,i<0?0:i,c)):[]}function Cg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===t?1:me(i),i=c-i,Nr(e,0,i<0?0:i)):[]}function Ng(e,i){return e&&e.length?Yn(e,ue(i,3),!0,!0):[]}function Rg(e,i){return e&&e.length?Yn(e,ue(i,3),!0):[]}function Tg(e,i,n,c){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&er(e,i,n)&&(n=0,c=l),Id(e,i,n,c)):[]}function vh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:me(n);return l<0&&(l=qt(c+l,0)),Rn(e,ue(i,3),l)}function wh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return n!==t&&(l=me(n),l=n<0?qt(c+l,0):Gt(l,c-1)),Rn(e,ue(i,3),l,!0)}function bh(e){var i=e==null?0:e.length;return i?Vt(e,1):[]}function Ag(e){var i=e==null?0:e.length;return i?Vt(e,Re):[]}function $g(e,i){var n=e==null?0:e.length;return n?(i=i===t?1:me(i),Vt(e,i)):[]}function Dg(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var l=e[i];c[l[0]]=l[1]}return c}function _h(e){return e&&e.length?e[0]:t}function Lg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:me(n);return l<0&&(l=qt(c+l,0)),ss(e,i,l)}function jg(e){var i=e==null?0:e.length;return i?Nr(e,0,-1):[]}var qg=_e(function(e){var i=it(e,Ra);return i.length&&i[0]===e[0]?ba(i):[]}),Mg=_e(function(e){var i=Rr(e),n=it(e,Ra);return i===Rr(n)?i=t:n.pop(),n.length&&n[0]===e[0]?ba(n,ue(i,2)):[]}),Ug=_e(function(e){var i=Rr(e),n=it(e,Ra);return i=typeof i=="function"?i:t,i&&n.pop(),n.length&&n[0]===e[0]?ba(n,t,i):[]});function zg(e,i){return e==null?"":jp.call(e,i)}function Rr(e){var i=e==null?0:e.length;return i?e[i-1]:t}function kg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c;return n!==t&&(l=me(n),l=l<0?qt(c+l,0):Gt(l,c-1)),i===i?bp(e,i,l):Rn(e,tu,l,!0)}function Hg(e,i){return e&&e.length?Au(e,me(i)):t}var Kg=_e(Eh);function Eh(e,i){return e&&e.length&&i&&i.length?xa(e,i):e}function Fg(e,i,n){return e&&e.length&&i&&i.length?xa(e,i,ue(n,2)):e}function Vg(e,i,n){return e&&e.length&&i&&i.length?xa(e,i,t,n):e}var Bg=si(function(e,i){var n=e==null?0:e.length,c=ya(e,i);return Lu(e,it(i,function(l){return ni(l,n)?+l:l}).sort(Vu)),c});function Gg(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,l=[],d=e.length;for(i=ue(i,3);++c<d;){var v=e[c];i(v,c,e)&&(n.push(v),l.push(c))}return Lu(e,l),n}function Fa(e){return e==null?e:zp.call(e)}function Wg(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&er(e,i,n)?(i=0,n=c):(i=i==null?0:me(i),n=n===t?c:me(n)),Nr(e,i,n)):[]}function Jg(e,i){return Qn(e,i)}function Qg(e,i,n){return Oa(e,i,ue(n,2))}function Yg(e,i){var n=e==null?0:e.length;if(n){var c=Qn(e,i);if(c<n&&qr(e[c],i))return c}return-1}function Zg(e,i){return Qn(e,i,!0)}function Xg(e,i,n){return Oa(e,i,ue(n,2),!0)}function ey(e,i){var n=e==null?0:e.length;if(n){var c=Qn(e,i,!0)-1;if(qr(e[c],i))return c}return-1}function ty(e){return e&&e.length?qu(e):[]}function ry(e,i){return e&&e.length?qu(e,ue(i,2)):[]}function iy(e){var i=e==null?0:e.length;return i?Nr(e,1,i):[]}function sy(e,i,n){return e&&e.length?(i=n||i===t?1:me(i),Nr(e,0,i<0?0:i)):[]}function ny(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===t?1:me(i),i=c-i,Nr(e,i<0?0:i,c)):[]}function oy(e,i){return e&&e.length?Yn(e,ue(i,3),!1,!0):[]}function ay(e,i){return e&&e.length?Yn(e,ue(i,3)):[]}var cy=_e(function(e){return _i(Vt(e,1,_t,!0))}),uy=_e(function(e){var i=Rr(e);return _t(i)&&(i=t),_i(Vt(e,1,_t,!0),ue(i,2))}),hy=_e(function(e){var i=Rr(e);return i=typeof i=="function"?i:t,_i(Vt(e,1,_t,!0),t,i)});function ly(e){return e&&e.length?_i(e):[]}function fy(e,i){return e&&e.length?_i(e,ue(i,2)):[]}function py(e,i){return i=typeof i=="function"?i:t,e&&e.length?_i(e,t,i):[]}function Va(e){if(!(e&&e.length))return[];var i=0;return e=yi(e,function(n){if(_t(n))return i=qt(n.length,i),!0}),ca(i,function(n){return it(e,na(n))})}function Ih(e,i){if(!(e&&e.length))return[];var n=Va(e);return i==null?n:it(n,function(c){return Ut(i,t,c)})}var dy=_e(function(e,i){return _t(e)?js(e,i):[]}),gy=_e(function(e){return Na(yi(e,_t))}),yy=_e(function(e){var i=Rr(e);return _t(i)&&(i=t),Na(yi(e,_t),ue(i,2))}),my=_e(function(e){var i=Rr(e);return i=typeof i=="function"?i:t,Na(yi(e,_t),t,i)}),vy=_e(Va);function wy(e,i){return ku(e||[],i||[],Ls)}function by(e,i){return ku(e||[],i||[],Us)}var _y=_e(function(e){var i=e.length,n=i>1?e[i-1]:t;return n=typeof n=="function"?(e.pop(),n):t,Ih(e,n)});function xh(e){var i=f(e);return i.__chain__=!0,i}function Ey(e,i){return i(e),e}function oo(e,i){return i(e)}var Iy=si(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,l=function(d){return ya(d,e)};return i>1||this.__actions__.length||!(c instanceof Se)||!ni(n)?this.thru(l):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:oo,args:[l],thisArg:t}),new Or(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(t),d}))});function xy(){return xh(this)}function Sy(){return new Or(this.value(),this.__chain__)}function Py(){this.__values__===t&&(this.__values__=Mh(this.value()));var e=this.__index__>=this.__values__.length,i=e?t:this.__values__[this.__index__++];return{done:e,value:i}}function Oy(){return this}function Cy(e){for(var i,n=this;n instanceof Vn;){var c=mh(n);c.__index__=0,c.__values__=t,i?l.__wrapped__=c:i=c;var l=c;n=n.__wrapped__}return l.__wrapped__=e,i}function Ny(){var e=this.__wrapped__;if(e instanceof Se){var i=e;return this.__actions__.length&&(i=new Se(this)),i=i.reverse(),i.__actions__.push({func:oo,args:[Fa],thisArg:t}),new Or(i,this.__chain__)}return this.thru(Fa)}function Ry(){return zu(this.__wrapped__,this.__actions__)}var Ty=Zn(function(e,i,n){Me.call(e,n)?++e[n]:ri(e,n,1)});function Ay(e,i,n){var c=ye(e)?Xc:Ed;return n&&er(e,i,n)&&(i=t),c(e,ue(i,3))}function $y(e,i){var n=ye(e)?yi:Iu;return n(e,ue(i,3))}var Dy=Yu(vh),Ly=Yu(wh);function jy(e,i){return Vt(ao(e,i),1)}function qy(e,i){return Vt(ao(e,i),Re)}function My(e,i,n){return n=n===t?1:me(n),Vt(ao(e,i),n)}function Sh(e,i){var n=ye(e)?Sr:bi;return n(e,ue(i,3))}function Ph(e,i){var n=ye(e)?ip:Eu;return n(e,ue(i,3))}var Uy=Zn(function(e,i,n){Me.call(e,n)?e[n].push(i):ri(e,n,[i])});function zy(e,i,n,c){e=ur(e)?e:ys(e),n=n&&!c?me(n):0;var l=e.length;return n<0&&(n=qt(l+n,0)),fo(e)?n<=l&&e.indexOf(i,n)>-1:!!l&&ss(e,i,n)>-1}var ky=_e(function(e,i,n){var c=-1,l=typeof i=="function",d=ur(e)?T(e.length):[];return bi(e,function(v){d[++c]=l?Ut(i,v,n):qs(v,i,n)}),d}),Hy=Zn(function(e,i,n){ri(e,n,i)});function ao(e,i){var n=ye(e)?it:Nu;return n(e,ue(i,3))}function Ky(e,i,n,c){return e==null?[]:(ye(i)||(i=i==null?[]:[i]),n=c?t:n,ye(n)||(n=n==null?[]:[n]),$u(e,i,n))}var Fy=Zn(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function Vy(e,i,n){var c=ye(e)?ia:iu,l=arguments.length<3;return c(e,ue(i,4),n,l,bi)}function By(e,i,n){var c=ye(e)?sp:iu,l=arguments.length<3;return c(e,ue(i,4),n,l,Eu)}function Gy(e,i){var n=ye(e)?yi:Iu;return n(e,ho(ue(i,3)))}function Wy(e){var i=ye(e)?vu:zd;return i(e)}function Jy(e,i,n){(n?er(e,i,n):i===t)?i=1:i=me(i);var c=ye(e)?md:kd;return c(e,i)}function Qy(e){var i=ye(e)?vd:Kd;return i(e)}function Yy(e){if(e==null)return 0;if(ur(e))return fo(e)?os(e):e.length;var i=Wt(e);return i==ve||i==Le?e.size:Ea(e).length}function Zy(e,i,n){var c=ye(e)?sa:Fd;return n&&er(e,i,n)&&(i=t),c(e,ue(i,3))}var Xy=_e(function(e,i){if(e==null)return[];var n=i.length;return n>1&&er(e,i[0],i[1])?i=[]:n>2&&er(i[0],i[1],i[2])&&(i=[i[0]]),$u(e,Vt(i,1),[])}),co=$p||function(){return Pe.Date.now()};function em(e,i){if(typeof i!="function")throw new Pr(p);return e=me(e),function(){if(--e<1)return i.apply(this,arguments)}}function Oh(e,i,n){return i=n?t:i,i=e&&i==null?e.length:i,ii(e,L,t,t,t,t,i)}function Ch(e,i){var n;if(typeof i!="function")throw new Pr(p);return e=me(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=t),n}}var Ba=_e(function(e,i,n){var c=oe;if(n.length){var l=vi(n,ds(Ba));c|=M}return ii(e,c,i,n,l)}),Nh=_e(function(e,i,n){var c=oe|fe;if(n.length){var l=vi(n,ds(Nh));c|=M}return ii(i,c,e,n,l)});function Rh(e,i,n){i=n?t:i;var c=ii(e,$,t,t,t,t,t,i);return c.placeholder=Rh.placeholder,c}function Th(e,i,n){i=n?t:i;var c=ii(e,U,t,t,t,t,t,i);return c.placeholder=Th.placeholder,c}function Ah(e,i,n){var c,l,d,v,_,O,k=0,H=!1,G=!1,X=!0;if(typeof e!="function")throw new Pr(p);i=Tr(i)||0,ct(n)&&(H=!!n.leading,G="maxWait"in n,d=G?qt(Tr(n.maxWait)||0,i):d,X="trailing"in n?!!n.trailing:X);function se(Et){var Mr=c,ci=l;return c=l=t,k=Et,v=e.apply(ci,Mr),v}function he(Et){return k=Et,_=Hs(Ie,i),H?se(Et):v}function we(Et){var Mr=Et-O,ci=Et-k,Yh=i-Mr;return G?Gt(Yh,d-ci):Yh}function le(Et){var Mr=Et-O,ci=Et-k;return O===t||Mr>=i||Mr<0||G&&ci>=d}function Ie(){var Et=co();if(le(Et))return Oe(Et);_=Hs(Ie,we(Et))}function Oe(Et){return _=t,X&&c?se(Et):(c=l=t,v)}function br(){_!==t&&Hu(_),k=0,c=O=l=_=t}function tr(){return _===t?v:Oe(co())}function _r(){var Et=co(),Mr=le(Et);if(c=arguments,l=this,O=Et,Mr){if(_===t)return he(O);if(G)return Hu(_),_=Hs(Ie,i),se(O)}return _===t&&(_=Hs(Ie,i)),v}return _r.cancel=br,_r.flush=tr,_r}var tm=_e(function(e,i){return _u(e,1,i)}),rm=_e(function(e,i,n){return _u(e,Tr(i)||0,n)});function im(e){return ii(e,ce)}function uo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Pr(p);var n=function(){var c=arguments,l=i?i.apply(this,c):c[0],d=n.cache;if(d.has(l))return d.get(l);var v=e.apply(this,c);return n.cache=d.set(l,v)||d,v};return n.cache=new(uo.Cache||ti),n}uo.Cache=ti;function ho(e){if(typeof e!="function")throw new Pr(p);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function sm(e){return Ch(2,e)}var nm=Vd(function(e,i){i=i.length==1&&ye(i[0])?it(i[0],mr(ue())):it(Vt(i,1),mr(ue()));var n=i.length;return _e(function(c){for(var l=-1,d=Gt(c.length,n);++l<d;)c[l]=i[l].call(this,c[l]);return Ut(e,this,c)})}),Ga=_e(function(e,i){var n=vi(i,ds(Ga));return ii(e,M,t,i,n)}),$h=_e(function(e,i){var n=vi(i,ds($h));return ii(e,I,t,i,n)}),om=si(function(e,i){return ii(e,K,t,t,t,i)});function am(e,i){if(typeof e!="function")throw new Pr(p);return i=i===t?i:me(i),_e(e,i)}function cm(e,i){if(typeof e!="function")throw new Pr(p);return i=i==null?0:qt(me(i),0),_e(function(n){var c=n[i],l=Ii(n,0,i);return c&&mi(l,c),Ut(e,this,l)})}function um(e,i,n){var c=!0,l=!0;if(typeof e!="function")throw new Pr(p);return ct(n)&&(c="leading"in n?!!n.leading:c,l="trailing"in n?!!n.trailing:l),Ah(e,i,{leading:c,maxWait:i,trailing:l})}function hm(e){return Oh(e,1)}function lm(e,i){return Ga(Ta(i),e)}function fm(){if(!arguments.length)return[];var e=arguments[0];return ye(e)?e:[e]}function pm(e){return Cr(e,F)}function dm(e,i){return i=typeof i=="function"?i:t,Cr(e,F,i)}function gm(e){return Cr(e,S|F)}function ym(e,i){return i=typeof i=="function"?i:t,Cr(e,S|F,i)}function mm(e,i){return i==null||bu(e,i,zt(i))}function qr(e,i){return e===i||e!==e&&i!==i}var vm=ro(wa),wm=ro(function(e,i){return e>=i}),Ki=Pu(function(){return arguments}())?Pu:function(e){return mt(e)&&Me.call(e,"callee")&&!fu.call(e,"callee")},ye=T.isArray,bm=Zt?mr(Zt):Cd;function ur(e){return e!=null&&lo(e.length)&&!oi(e)}function _t(e){return mt(e)&&ur(e)}function _m(e){return e===!0||e===!1||mt(e)&&Xt(e)==D}var xi=Lp||sc,Em=Dr?mr(Dr):Nd;function Im(e){return mt(e)&&e.nodeType===1&&!Ks(e)}function xm(e){if(e==null)return!0;if(ur(e)&&(ye(e)||typeof e=="string"||typeof e.splice=="function"||xi(e)||gs(e)||Ki(e)))return!e.length;var i=Wt(e);if(i==ve||i==Le)return!e.size;if(ks(e))return!Ea(e).length;for(var n in e)if(Me.call(e,n))return!1;return!0}function Sm(e,i){return Ms(e,i)}function Pm(e,i,n){n=typeof n=="function"?n:t;var c=n?n(e,i):t;return c===t?Ms(e,i,t,n):!!c}function Wa(e){if(!mt(e))return!1;var i=Xt(e);return i==E||i==u||typeof e.message=="string"&&typeof e.name=="string"&&!Ks(e)}function Om(e){return typeof e=="number"&&du(e)}function oi(e){if(!ct(e))return!1;var i=Xt(e);return i==ie||i==pe||i==j||i==vt}function Dh(e){return typeof e=="number"&&e==me(e)}function lo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ee}function ct(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function mt(e){return e!=null&&typeof e=="object"}var Lh=xr?mr(xr):Td;function Cm(e,i){return e===i||_a(e,i,Ma(i))}function Nm(e,i,n){return n=typeof n=="function"?n:t,_a(e,i,Ma(i),n)}function Rm(e){return jh(e)&&e!=+e}function Tm(e){if(dg(e))throw new de(h);return Ou(e)}function Am(e){return e===null}function $m(e){return e==null}function jh(e){return typeof e=="number"||mt(e)&&Xt(e)==Te}function Ks(e){if(!mt(e)||Xt(e)!=xe)return!1;var i=Mn(e);if(i===null)return!0;var n=Me.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&Dn.call(n)==Np}var Ja=Fr?mr(Fr):Ad;function Dm(e){return Dh(e)&&e>=-ee&&e<=ee}var qh=Cs?mr(Cs):$d;function fo(e){return typeof e=="string"||!ye(e)&&mt(e)&&Xt(e)==Je}function wr(e){return typeof e=="symbol"||mt(e)&&Xt(e)==Qe}var gs=Li?mr(Li):Dd;function Lm(e){return e===t}function jm(e){return mt(e)&&Wt(e)==ze}function qm(e){return mt(e)&&Xt(e)==Ye}var Mm=ro(Ia),Um=ro(function(e,i){return e<=i});function Mh(e){if(!e)return[];if(ur(e))return fo(e)?Lr(e):cr(e);if(Rs&&e[Rs])return mp(e[Rs]());var i=Wt(e),n=i==ve?ha:i==Le?Tn:ys;return n(e)}function ai(e){if(!e)return e===0?e:0;if(e=Tr(e),e===Re||e===-Re){var i=e<0?-1:1;return i*Q}return e===e?e:0}function me(e){var i=ai(e),n=i%1;return i===i?n?i-n:i:0}function Uh(e){return e?Ui(me(e),0,Y):0}function Tr(e){if(typeof e=="number")return e;if(wr(e))return W;if(ct(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ct(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=su(e);var n=Uo.test(e);return n||ko.test(e)?ge(e.slice(2),n?2:8):Mo.test(e)?W:+e}function zh(e){return Br(e,hr(e))}function zm(e){return e?Ui(me(e),-ee,ee):e===0?e:0}function je(e){return e==null?"":vr(e)}var km=fs(function(e,i){if(ks(i)||ur(i)){Br(i,zt(i),e);return}for(var n in i)Me.call(i,n)&&Ls(e,n,i[n])}),kh=fs(function(e,i){Br(i,hr(i),e)}),po=fs(function(e,i,n,c){Br(i,hr(i),e,c)}),Hm=fs(function(e,i,n,c){Br(i,zt(i),e,c)}),Km=si(ya);function Fm(e,i){var n=ls(e);return i==null?n:wu(n,i)}var Vm=_e(function(e,i){e=Ge(e);var n=-1,c=i.length,l=c>2?i[2]:t;for(l&&er(i[0],i[1],l)&&(c=1);++n<c;)for(var d=i[n],v=hr(d),_=-1,O=v.length;++_<O;){var k=v[_],H=e[k];(H===t||qr(H,cs[k])&&!Me.call(e,k))&&(e[k]=d[k])}return e}),Bm=_e(function(e){return e.push(t,sh),Ut(Hh,t,e)});function Gm(e,i){return eu(e,ue(i,3),Vr)}function Wm(e,i){return eu(e,ue(i,3),va)}function Jm(e,i){return e==null?e:ma(e,ue(i,3),hr)}function Qm(e,i){return e==null?e:xu(e,ue(i,3),hr)}function Ym(e,i){return e&&Vr(e,ue(i,3))}function Zm(e,i){return e&&va(e,ue(i,3))}function Xm(e){return e==null?[]:Wn(e,zt(e))}function ev(e){return e==null?[]:Wn(e,hr(e))}function Qa(e,i,n){var c=e==null?t:zi(e,i);return c===t?n:c}function tv(e,i){return e!=null&&ah(e,i,xd)}function Ya(e,i){return e!=null&&ah(e,i,Sd)}var rv=Xu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Ln.call(i)),e[i]=n},Xa(lr)),iv=Xu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Ln.call(i)),Me.call(e,i)?e[i].push(n):e[i]=[n]},ue),sv=_e(qs);function zt(e){return ur(e)?mu(e):Ea(e)}function hr(e){return ur(e)?mu(e,!0):Ld(e)}function nv(e,i){var n={};return i=ue(i,3),Vr(e,function(c,l,d){ri(n,i(c,l,d),c)}),n}function ov(e,i){var n={};return i=ue(i,3),Vr(e,function(c,l,d){ri(n,l,i(c,l,d))}),n}var av=fs(function(e,i,n){Jn(e,i,n)}),Hh=fs(function(e,i,n,c){Jn(e,i,n,c)}),cv=si(function(e,i){var n={};if(e==null)return n;var c=!1;i=it(i,function(d){return d=Ei(d,e),c||(c=d.length>1),d}),Br(e,ja(e),n),c&&(n=Cr(n,S|R|F,rg));for(var l=i.length;l--;)Ca(n,i[l]);return n});function uv(e,i){return Kh(e,ho(ue(i)))}var hv=si(function(e,i){return e==null?{}:qd(e,i)});function Kh(e,i){if(e==null)return{};var n=it(ja(e),function(c){return[c]});return i=ue(i),Du(e,n,function(c,l){return i(c,l[0])})}function lv(e,i,n){i=Ei(i,e);var c=-1,l=i.length;for(l||(l=1,e=t);++c<l;){var d=e==null?t:e[Gr(i[c])];d===t&&(c=l,d=n),e=oi(d)?d.call(e):d}return e}function fv(e,i,n){return e==null?e:Us(e,i,n)}function pv(e,i,n,c){return c=typeof c=="function"?c:t,e==null?e:Us(e,i,n,c)}var Fh=rh(zt),Vh=rh(hr);function dv(e,i,n){var c=ye(e),l=c||xi(e)||gs(e);if(i=ue(i,4),n==null){var d=e&&e.constructor;l?n=c?new d:[]:ct(e)?n=oi(d)?ls(Mn(e)):{}:n={}}return(l?Sr:Vr)(e,function(v,_,O){return i(n,v,_,O)}),n}function gv(e,i){return e==null?!0:Ca(e,i)}function yv(e,i,n){return e==null?e:Uu(e,i,Ta(n))}function mv(e,i,n,c){return c=typeof c=="function"?c:t,e==null?e:Uu(e,i,Ta(n),c)}function ys(e){return e==null?[]:ua(e,zt(e))}function vv(e){return e==null?[]:ua(e,hr(e))}function wv(e,i,n){return n===t&&(n=i,i=t),n!==t&&(n=Tr(n),n=n===n?n:0),i!==t&&(i=Tr(i),i=i===i?i:0),Ui(Tr(e),i,n)}function bv(e,i,n){return i=ai(i),n===t?(n=i,i=0):n=ai(n),e=Tr(e),Pd(e,i,n)}function _v(e,i,n){if(n&&typeof n!="boolean"&&er(e,i,n)&&(i=n=t),n===t&&(typeof i=="boolean"?(n=i,i=t):typeof e=="boolean"&&(n=e,e=t)),e===t&&i===t?(e=0,i=1):(e=ai(e),i===t?(i=e,e=0):i=ai(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var l=gu();return Gt(e+l*(i-e+Ve("1e-"+((l+"").length-1))),i)}return Sa(e,i)}var Ev=ps(function(e,i,n){return i=i.toLowerCase(),e+(n?Bh(i):i)});function Bh(e){return Za(je(e).toLowerCase())}function Gh(e){return e=je(e),e&&e.replace(Zr,fp).replace(ea,"")}function Iv(e,i,n){e=je(e),i=vr(i);var c=e.length;n=n===t?c:Ui(me(n),0,c);var l=n;return n-=i.length,n>=0&&e.slice(n,l)==i}function xv(e){return e=je(e),e&&tt.test(e)?e.replace(Ri,pp):e}function Sv(e){return e=je(e),e&&Nt.test(e)?e.replace(dt,"\\$&"):e}var Pv=ps(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),Ov=ps(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),Cv=Qu("toLowerCase");function Nv(e,i,n){e=je(e),i=me(i);var c=i?os(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return to(Hn(l),n)+e+to(kn(l),n)}function Rv(e,i,n){e=je(e),i=me(i);var c=i?os(e):0;return i&&c<i?e+to(i-c,n):e}function Tv(e,i,n){e=je(e),i=me(i);var c=i?os(e):0;return i&&c<i?to(i-c,n)+e:e}function Av(e,i,n){return n||i==null?i=0:i&&(i=+i),Up(je(e).replace(gt,""),i||0)}function $v(e,i,n){return(n?er(e,i,n):i===t)?i=1:i=me(i),Pa(je(e),i)}function Dv(){var e=arguments,i=je(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Lv=ps(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function jv(e,i,n){return n&&typeof n!="number"&&er(e,i,n)&&(i=n=t),n=n===t?Y:n>>>0,n?(e=je(e),e&&(typeof i=="string"||i!=null&&!Ja(i))&&(i=vr(i),!i&&ns(e))?Ii(Lr(e),0,n):e.split(i,n)):[]}var qv=ps(function(e,i,n){return e+(n?" ":"")+Za(i)});function Mv(e,i,n){return e=je(e),n=n==null?0:Ui(me(n),0,e.length),i=vr(i),e.slice(n,n+i.length)==i}function Uv(e,i,n){var c=f.templateSettings;n&&er(e,i,n)&&(i=t),e=je(e),i=po({},i,c,ih);var l=po({},i.imports,c.imports,ih),d=zt(l),v=ua(l,d),_,O,k=0,H=i.interpolate||Yi,G="__p += '",X=la((i.escape||Yi).source+"|"+H.source+"|"+(H===at?qo:Yi).source+"|"+(i.evaluate||Yi).source+"|$","g"),se="//# sourceURL="+(Me.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ta+"]")+`
`;e.replace(X,function(le,Ie,Oe,br,tr,_r){return Oe||(Oe=br),G+=e.slice(k,_r).replace(Ko,dp),Ie&&(_=!0,G+=`' +
__e(`+Ie+`) +
'`),tr&&(O=!0,G+=`';
`+tr+`;
__p += '`),Oe&&(G+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),k=_r+le.length,le}),G+=`';
`;var he=Me.call(i,"variable")&&i.variable;if(!he)G=`with (obj) {
`+G+`
}
`;else if(Lo.test(he))throw new de(g);G=(O?G.replace(Hr,""):G).replace(Yt,"$1").replace(Yr,"$1;"),G="function("+(he||"obj")+`) {
`+(he?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(O?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+G+`return __p
}`;var we=Jh(function(){return De(d,se+"return "+G).apply(t,v)});if(we.source=G,Wa(we))throw we;return we}function zv(e){return je(e).toLowerCase()}function kv(e){return je(e).toUpperCase()}function Hv(e,i,n){if(e=je(e),e&&(n||i===t))return su(e);if(!e||!(i=vr(i)))return e;var c=Lr(e),l=Lr(i),d=nu(c,l),v=ou(c,l)+1;return Ii(c,d,v).join("")}function Kv(e,i,n){if(e=je(e),e&&(n||i===t))return e.slice(0,cu(e)+1);if(!e||!(i=vr(i)))return e;var c=Lr(e),l=ou(c,Lr(i))+1;return Ii(c,0,l).join("")}function Fv(e,i,n){if(e=je(e),e&&(n||i===t))return e.replace(gt,"");if(!e||!(i=vr(i)))return e;var c=Lr(e),l=nu(c,Lr(i));return Ii(c,l).join("")}function Vv(e,i){var n=ae,c=Ee;if(ct(i)){var l="separator"in i?i.separator:l;n="length"in i?me(i.length):n,c="omission"in i?vr(i.omission):c}e=je(e);var d=e.length;if(ns(e)){var v=Lr(e);d=v.length}if(n>=d)return e;var _=n-os(c);if(_<1)return c;var O=v?Ii(v,0,_).join(""):e.slice(0,_);if(l===t)return O+c;if(v&&(_+=O.length-_),Ja(l)){if(e.slice(_).search(l)){var k,H=O;for(l.global||(l=la(l.source,je(Ir.exec(l))+"g")),l.lastIndex=0;k=l.exec(H);)var G=k.index;O=O.slice(0,G===t?_:G)}}else if(e.indexOf(vr(l),_)!=_){var X=O.lastIndexOf(l);X>-1&&(O=O.slice(0,X))}return O+c}function Bv(e){return e=je(e),e&&lt.test(e)?e.replace(di,_p):e}var Gv=ps(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),Za=Qu("toUpperCase");function Wh(e,i,n){return e=je(e),i=n?t:i,i===t?yp(e)?xp(e):ap(e):e.match(i)||[]}var Jh=_e(function(e,i){try{return Ut(e,t,i)}catch(n){return Wa(n)?n:new de(n)}}),Wv=si(function(e,i){return Sr(i,function(n){n=Gr(n),ri(e,n,Ba(e[n],e))}),e});function Jv(e){var i=e==null?0:e.length,n=ue();return e=i?it(e,function(c){if(typeof c[1]!="function")throw new Pr(p);return[n(c[0]),c[1]]}):[],_e(function(c){for(var l=-1;++l<i;){var d=e[l];if(Ut(d[0],this,c))return Ut(d[1],this,c)}})}function Qv(e){return _d(Cr(e,S))}function Xa(e){return function(){return e}}function Yv(e,i){return e==null||e!==e?i:e}var Zv=Zu(),Xv=Zu(!0);function lr(e){return e}function ec(e){return Cu(typeof e=="function"?e:Cr(e,S))}function e0(e){return Ru(Cr(e,S))}function t0(e,i){return Tu(e,Cr(i,S))}var r0=_e(function(e,i){return function(n){return qs(n,e,i)}}),i0=_e(function(e,i){return function(n){return qs(e,n,i)}});function tc(e,i,n){var c=zt(i),l=Wn(i,c);n==null&&!(ct(i)&&(l.length||!c.length))&&(n=i,i=e,e=this,l=Wn(i,zt(i)));var d=!(ct(n)&&"chain"in n)||!!n.chain,v=oi(e);return Sr(l,function(_){var O=i[_];e[_]=O,v&&(e.prototype[_]=function(){var k=this.__chain__;if(d||k){var H=e(this.__wrapped__),G=H.__actions__=cr(this.__actions__);return G.push({func:O,args:arguments,thisArg:e}),H.__chain__=k,H}return O.apply(e,mi([this.value()],arguments))})}),e}function s0(){return Pe._===this&&(Pe._=Rp),this}function rc(){}function n0(e){return e=me(e),_e(function(i){return Au(i,e)})}var o0=$a(it),a0=$a(Xc),c0=$a(sa);function Qh(e){return za(e)?na(Gr(e)):Md(e)}function u0(e){return function(i){return e==null?t:zi(e,i)}}var h0=eh(),l0=eh(!0);function ic(){return[]}function sc(){return!1}function f0(){return{}}function p0(){return""}function d0(){return!0}function g0(e,i){if(e=me(e),e<1||e>ee)return[];var n=Y,c=Gt(e,Y);i=ue(i),e-=Y;for(var l=ca(c,i);++n<e;)i(n);return l}function y0(e){return ye(e)?it(e,Gr):wr(e)?[e]:cr(yh(je(e)))}function m0(e){var i=++Cp;return je(e)+i}var v0=eo(function(e,i){return e+i},0),w0=Da("ceil"),b0=eo(function(e,i){return e/i},1),_0=Da("floor");function E0(e){return e&&e.length?Gn(e,lr,wa):t}function I0(e,i){return e&&e.length?Gn(e,ue(i,2),wa):t}function x0(e){return ru(e,lr)}function S0(e,i){return ru(e,ue(i,2))}function P0(e){return e&&e.length?Gn(e,lr,Ia):t}function O0(e,i){return e&&e.length?Gn(e,ue(i,2),Ia):t}var C0=eo(function(e,i){return e*i},1),N0=Da("round"),R0=eo(function(e,i){return e-i},0);function T0(e){return e&&e.length?aa(e,lr):0}function A0(e,i){return e&&e.length?aa(e,ue(i,2)):0}return f.after=em,f.ary=Oh,f.assign=km,f.assignIn=kh,f.assignInWith=po,f.assignWith=Hm,f.at=Km,f.before=Ch,f.bind=Ba,f.bindAll=Wv,f.bindKey=Nh,f.castArray=fm,f.chain=xh,f.chunk=_g,f.compact=Eg,f.concat=Ig,f.cond=Jv,f.conforms=Qv,f.constant=Xa,f.countBy=Ty,f.create=Fm,f.curry=Rh,f.curryRight=Th,f.debounce=Ah,f.defaults=Vm,f.defaultsDeep=Bm,f.defer=tm,f.delay=rm,f.difference=xg,f.differenceBy=Sg,f.differenceWith=Pg,f.drop=Og,f.dropRight=Cg,f.dropRightWhile=Ng,f.dropWhile=Rg,f.fill=Tg,f.filter=$y,f.flatMap=jy,f.flatMapDeep=qy,f.flatMapDepth=My,f.flatten=bh,f.flattenDeep=Ag,f.flattenDepth=$g,f.flip=im,f.flow=Zv,f.flowRight=Xv,f.fromPairs=Dg,f.functions=Xm,f.functionsIn=ev,f.groupBy=Uy,f.initial=jg,f.intersection=qg,f.intersectionBy=Mg,f.intersectionWith=Ug,f.invert=rv,f.invertBy=iv,f.invokeMap=ky,f.iteratee=ec,f.keyBy=Hy,f.keys=zt,f.keysIn=hr,f.map=ao,f.mapKeys=nv,f.mapValues=ov,f.matches=e0,f.matchesProperty=t0,f.memoize=uo,f.merge=av,f.mergeWith=Hh,f.method=r0,f.methodOf=i0,f.mixin=tc,f.negate=ho,f.nthArg=n0,f.omit=cv,f.omitBy=uv,f.once=sm,f.orderBy=Ky,f.over=o0,f.overArgs=nm,f.overEvery=a0,f.overSome=c0,f.partial=Ga,f.partialRight=$h,f.partition=Fy,f.pick=hv,f.pickBy=Kh,f.property=Qh,f.propertyOf=u0,f.pull=Kg,f.pullAll=Eh,f.pullAllBy=Fg,f.pullAllWith=Vg,f.pullAt=Bg,f.range=h0,f.rangeRight=l0,f.rearg=om,f.reject=Gy,f.remove=Gg,f.rest=am,f.reverse=Fa,f.sampleSize=Jy,f.set=fv,f.setWith=pv,f.shuffle=Qy,f.slice=Wg,f.sortBy=Xy,f.sortedUniq=ty,f.sortedUniqBy=ry,f.split=jv,f.spread=cm,f.tail=iy,f.take=sy,f.takeRight=ny,f.takeRightWhile=oy,f.takeWhile=ay,f.tap=Ey,f.throttle=um,f.thru=oo,f.toArray=Mh,f.toPairs=Fh,f.toPairsIn=Vh,f.toPath=y0,f.toPlainObject=zh,f.transform=dv,f.unary=hm,f.union=cy,f.unionBy=uy,f.unionWith=hy,f.uniq=ly,f.uniqBy=fy,f.uniqWith=py,f.unset=gv,f.unzip=Va,f.unzipWith=Ih,f.update=yv,f.updateWith=mv,f.values=ys,f.valuesIn=vv,f.without=dy,f.words=Wh,f.wrap=lm,f.xor=gy,f.xorBy=yy,f.xorWith=my,f.zip=vy,f.zipObject=wy,f.zipObjectDeep=by,f.zipWith=_y,f.entries=Fh,f.entriesIn=Vh,f.extend=kh,f.extendWith=po,tc(f,f),f.add=v0,f.attempt=Jh,f.camelCase=Ev,f.capitalize=Bh,f.ceil=w0,f.clamp=wv,f.clone=pm,f.cloneDeep=gm,f.cloneDeepWith=ym,f.cloneWith=dm,f.conformsTo=mm,f.deburr=Gh,f.defaultTo=Yv,f.divide=b0,f.endsWith=Iv,f.eq=qr,f.escape=xv,f.escapeRegExp=Sv,f.every=Ay,f.find=Dy,f.findIndex=vh,f.findKey=Gm,f.findLast=Ly,f.findLastIndex=wh,f.findLastKey=Wm,f.floor=_0,f.forEach=Sh,f.forEachRight=Ph,f.forIn=Jm,f.forInRight=Qm,f.forOwn=Ym,f.forOwnRight=Zm,f.get=Qa,f.gt=vm,f.gte=wm,f.has=tv,f.hasIn=Ya,f.head=_h,f.identity=lr,f.includes=zy,f.indexOf=Lg,f.inRange=bv,f.invoke=sv,f.isArguments=Ki,f.isArray=ye,f.isArrayBuffer=bm,f.isArrayLike=ur,f.isArrayLikeObject=_t,f.isBoolean=_m,f.isBuffer=xi,f.isDate=Em,f.isElement=Im,f.isEmpty=xm,f.isEqual=Sm,f.isEqualWith=Pm,f.isError=Wa,f.isFinite=Om,f.isFunction=oi,f.isInteger=Dh,f.isLength=lo,f.isMap=Lh,f.isMatch=Cm,f.isMatchWith=Nm,f.isNaN=Rm,f.isNative=Tm,f.isNil=$m,f.isNull=Am,f.isNumber=jh,f.isObject=ct,f.isObjectLike=mt,f.isPlainObject=Ks,f.isRegExp=Ja,f.isSafeInteger=Dm,f.isSet=qh,f.isString=fo,f.isSymbol=wr,f.isTypedArray=gs,f.isUndefined=Lm,f.isWeakMap=jm,f.isWeakSet=qm,f.join=zg,f.kebabCase=Pv,f.last=Rr,f.lastIndexOf=kg,f.lowerCase=Ov,f.lowerFirst=Cv,f.lt=Mm,f.lte=Um,f.max=E0,f.maxBy=I0,f.mean=x0,f.meanBy=S0,f.min=P0,f.minBy=O0,f.stubArray=ic,f.stubFalse=sc,f.stubObject=f0,f.stubString=p0,f.stubTrue=d0,f.multiply=C0,f.nth=Hg,f.noConflict=s0,f.noop=rc,f.now=co,f.pad=Nv,f.padEnd=Rv,f.padStart=Tv,f.parseInt=Av,f.random=_v,f.reduce=Vy,f.reduceRight=By,f.repeat=$v,f.replace=Dv,f.result=lv,f.round=N0,f.runInContext=P,f.sample=Wy,f.size=Yy,f.snakeCase=Lv,f.some=Zy,f.sortedIndex=Jg,f.sortedIndexBy=Qg,f.sortedIndexOf=Yg,f.sortedLastIndex=Zg,f.sortedLastIndexBy=Xg,f.sortedLastIndexOf=ey,f.startCase=qv,f.startsWith=Mv,f.subtract=R0,f.sum=T0,f.sumBy=A0,f.template=Uv,f.times=g0,f.toFinite=ai,f.toInteger=me,f.toLength=Uh,f.toLower=zv,f.toNumber=Tr,f.toSafeInteger=zm,f.toString=je,f.toUpper=kv,f.trim=Hv,f.trimEnd=Kv,f.trimStart=Fv,f.truncate=Vv,f.unescape=Bv,f.uniqueId=m0,f.upperCase=Gv,f.upperFirst=Za,f.each=Sh,f.eachRight=Ph,f.first=_h,tc(f,function(){var e={};return Vr(f,function(i,n){Me.call(f.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),f.VERSION=s,Sr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),Sr(["drop","take"],function(e,i){Se.prototype[e]=function(n){n=n===t?1:qt(me(n),0);var c=this.__filtered__&&!i?new Se(this):this.clone();return c.__filtered__?c.__takeCount__=Gt(n,c.__takeCount__):c.__views__.push({size:Gt(n,Y),type:e+(c.__dir__<0?"Right":"")}),c},Se.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Sr(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==A||n==Ue;Se.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ue(l,3),type:n}),d.__filtered__=d.__filtered__||c,d}}),Sr(["head","last"],function(e,i){var n="take"+(i?"Right":"");Se.prototype[e]=function(){return this[n](1).value()[0]}}),Sr(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[n](1)}}),Se.prototype.compact=function(){return this.filter(lr)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=_e(function(e,i){return typeof e=="function"?new Se(this):this.map(function(n){return qs(n,e,i)})}),Se.prototype.reject=function(e){return this.filter(ho(ue(e)))},Se.prototype.slice=function(e,i){e=me(e);var n=this;return n.__filtered__&&(e>0||i<0)?new Se(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==t&&(i=me(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(Y)},Vr(Se.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=f[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);l&&(f.prototype[i]=function(){var v=this.__wrapped__,_=c?[1]:arguments,O=v instanceof Se,k=_[0],H=O||ye(v),G=function(Ie){var Oe=l.apply(f,mi([Ie],_));return c&&X?Oe[0]:Oe};H&&n&&typeof k=="function"&&k.length!=1&&(O=H=!1);var X=this.__chain__,se=!!this.__actions__.length,he=d&&!X,we=O&&!se;if(!d&&H){v=we?v:new Se(this);var le=e.apply(v,_);return le.__actions__.push({func:oo,args:[G],thisArg:t}),new Or(le,X)}return he&&we?e.apply(this,_):(le=this.thru(G),he?c?le.value()[0]:le.value():le)})}),Sr(["pop","push","shift","sort","splice","unshift"],function(e){var i=An[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(ye(d)?d:[],l)}return this[n](function(v){return i.apply(ye(v)?v:[],l)})}}),Vr(Se.prototype,function(e,i){var n=f[i];if(n){var c=n.name+"";Me.call(hs,c)||(hs[c]=[]),hs[c].push({name:i,func:n})}}),hs[Xn(t,fe).name]=[{name:"wrapper",func:t}],Se.prototype.clone=Bp,Se.prototype.reverse=Gp,Se.prototype.value=Wp,f.prototype.at=Iy,f.prototype.chain=xy,f.prototype.commit=Sy,f.prototype.next=Py,f.prototype.plant=Cy,f.prototype.reverse=Ny,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=Ry,f.prototype.first=f.prototype.head,Rs&&(f.prototype[Rs]=Oy),f},as=Sp();bt?((bt.exports=as)._=as,Be._=as):Pe._=as}).call(Qs)})(Ac,Ac.exports);var $I=Object.defineProperty,DI=Object.defineProperties,LI=Object.getOwnPropertyDescriptors,ef=Object.getOwnPropertySymbols,jI=Object.prototype.hasOwnProperty,qI=Object.prototype.propertyIsEnumerable,tf=(o,r,t)=>r in o?$I(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,bo=(o,r)=>{for(var t in r||(r={}))jI.call(r,t)&&tf(o,t,r[t]);if(ef)for(var t of ef(r))qI.call(r,t)&&tf(o,t,r[t]);return o},MI=(o,r)=>DI(o,LI(r));function Ci(o,r,t){var s;const a=uw(o);return((s=r.rpcMap)==null?void 0:s[a.reference])||`${AI}?chainId=${a.namespace}:${a.reference}&projectId=${t}`}function Qi(o){return o.includes(":")?o.split(":")[1]:o}function ep(o){return o.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function UI(o,r){const t=Object.keys(r.namespaces).filter(a=>a.includes(o));if(!t.length)return[];const s=[];return t.forEach(a=>{const h=r.namespaces[a].accounts;s.push(...h)}),s}function zI(o={},r={}){const t=rf(o),s=rf(r);return Ac.exports.merge(t,s)}function rf(o){var r,t,s,a;const h={};if(!bs(o))return h;for(const[p,g]of Object.entries(o)){const w=Vc(p)?[p]:g.chains,y=g.methods||[],b=g.events||[],S=g.rpcMap||{},R=Ys(p);h[R]=MI(bo(bo({},h[R]),g),{chains:oc(w,(r=h[R])==null?void 0:r.chains),methods:oc(y,(t=h[R])==null?void 0:t.methods),events:oc(b,(s=h[R])==null?void 0:s.events),rpcMap:bo(bo({},S),(a=h[R])==null?void 0:a.rpcMap)})}return h}function kI(o){return o.includes(":")?o.split(":")[2]:o}function HI(o){const r={};for(const[t,s]of Object.entries(o)){const a=s.methods||[],h=s.events||[],p=s.accounts||[],g=Vc(t)?[t]:s.chains?s.chains:ep(s.accounts);r[t]={chains:g,methods:a,events:h,accounts:p}}return r}function wc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const tp={},st=o=>tp[o],bc=(o,r)=>{tp[o]=r};class KI{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var s;const a=Qi(t);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const s=this.createHttpProvider(r,t);s&&(this.httpProviders[r]=s)}createHttpProvider(r,t){const s=t||Ci(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ni(s,st("disableProviderPing")))}}class FI{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(parseInt(r),t),this.chainId=parseInt(r),this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,t){const s=t||Ci(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ni(s,st("disableProviderPing")))}setHttpProvider(r,t){const s=this.createHttpProvider(r,t);s&&(this.httpProviders[r]=s)}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var s;const a=parseInt(Qi(t));r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[t])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}async handleSwitchChain(r){var t,s;let a=r.request.params?(t=r.request.params[0])==null?void 0:t.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const h=parseInt(a,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class VI{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var s;const a=Qi(t);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const s=this.createHttpProvider(r,t);s&&(this.httpProviders[r]=s)}createHttpProvider(r,t){const s=t||Ci(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ni(s,st("disableProviderPing")))}}class BI{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var s;const a=Qi(t);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const s=this.createHttpProvider(r,t);s&&(this.httpProviders[r]=s)}createHttpProvider(r,t){const s=t||Ci(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ni(s,st("disableProviderPing")))}}class GI{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{const s=this.getCardanoRPCUrl(t),a=Qi(t);r[a]=this.createHttpProvider(a,s)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}getCardanoRPCUrl(r){const t=this.namespace.rpcMap;if(t)return t[r]}setHttpProvider(r,t){const s=this.createHttpProvider(r,t);s&&(this.httpProviders[r]=s)}createHttpProvider(r,t){const s=t||this.getCardanoRPCUrl(r);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ni(s,st("disableProviderPing")))}}class WI{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var s;const a=Qi(t);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const s=this.createHttpProvider(r,t);s&&(this.httpProviders[r]=s)}createHttpProvider(r,t){const s=t||Ci(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ni(s,st("disableProviderPing")))}}class JI{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var s;const a=Qi(t);r[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const s=this.createHttpProvider(r,t);s&&(this.httpProviders[r]=s)}createHttpProvider(r,t){const s=t||Ci(r,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);return new fi(new Ni(s,st("disableProviderPing")))}}class QI{constructor(r){this.name="near",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){if(this.chainId=r,!this.httpProviders[r]){const s=t||Ci(`${this.name}:${r}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,s)}this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var s;r[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const s=this.createHttpProvider(r,t);s&&(this.httpProviders[r]=s)}createHttpProvider(r,t){const s=t||Ci(r,this.namespace);return typeof s>"u"?void 0:new fi(new Ni(s,st("disableProviderPing")))}}var YI=Object.defineProperty,ZI=Object.defineProperties,XI=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,ex=Object.prototype.hasOwnProperty,tx=Object.prototype.propertyIsEnumerable,nf=(o,r,t)=>r in o?YI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,_o=(o,r)=>{for(var t in r||(r={}))ex.call(r,t)&&nf(o,t,r[t]);if(sf)for(var t of sf(r))tx.call(r,t)&&nf(o,t,r[t]);return o},_c=(o,r)=>ZI(o,XI(r));class Yc{constructor(r){this.events=new jc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:r?.logger||Zl})),this.disableProviderPing=r?.disableProviderPing||!1}static async init(r){const t=new Yc(r);return await t.initialize(),t}async request(r,t){const[s,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:_o({},r),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(r,t,s){this.request(r,s).then(a=>t(null,a)).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:It("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}removeListener(r,t){this.events.removeListener(r,t)}off(r,t){this.events.off(r,t)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(h=>{this.session=h,this.namespaces||(this.namespaces=HI(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==Zf)throw h;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,t){try{if(!this.session)return;const[s,a]=this.validateChain(r);this.getProvider(s).setDefaultChain(a,t)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Jr(t)){for(const s of t)r.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await CI.init({logger:this.providerOpts.logger||Zl,relayUrl:this.providerOpts.relayUrl||NI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(t=>Ys(t)))];bc("client",this.client),bc("events",this.events),bc("disableProviderPing",this.disableProviderPing),r.forEach(t=>{if(!this.session)return;const s=UI(t,this.session),a=ep(s),h=zI(this.namespaces,this.optionalNamespaces),p=_c(_o({},h[t]),{accounts:s,chains:a});switch(t){case"eip155":this.rpcProviders[t]=new FI({namespace:p});break;case"solana":this.rpcProviders[t]=new VI({namespace:p});break;case"cosmos":this.rpcProviders[t]=new BI({namespace:p});break;case"polkadot":this.rpcProviders[t]=new KI({namespace:p});break;case"cip34":this.rpcProviders[t]=new GI({namespace:p});break;case"elrond":this.rpcProviders[t]=new WI({namespace:p});break;case"multiversx":this.rpcProviders[t]=new JI({namespace:p});break;case"near":this.rpcProviders[t]=new QI({namespace:p});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:t}=r,{event:s}=t;if(s.name==="accountsChanged"){const a=s.data;a&&Jr(a)&&this.events.emit("accountsChanged",a.map(kI))}else if(s.name==="chainChanged"){const a=t.chainId,h=t.event.data,p=Ys(a),g=wc(a)!==wc(h)?`${p}:${wc(h)}`:a;this.onChainChanged(g)}else this.events.emit(s.name,s.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:t})=>{var s;const{namespaces:a}=t,h=(s=this.client)==null?void 0:s.session.get(r);this.session=_c(_o({},h),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:t})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",_c(_o({},It("USER_DISCONNECTED")),{data:r.topic}))}),this.on(pi.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var t;this.getProvider(r).updateNamespace((t=this.session)==null?void 0:t.namespaces[r])})}setNamespaces(r){const{namespaces:t,optionalNamespaces:s,sessionProperties:a}=r;t&&Object.keys(t).length&&(this.namespaces=t),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",t),this.persist("optionalNamespaces",s)}validateChain(r){const[t,s]=r?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,s];if(t&&!Object.keys(this.namespaces||{}).map(p=>Ys(p)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&s)return[t,s];const a=Ys(Object.keys(this.namespaces)[0]),h=this.rpcProviders[a].getDefaultChain();return[a,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,t=!1){var s;if(!this.namespaces)return;const[a,h]=this.validateChain(r);t||this.getProvider(a).setDefaultChain(h),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,t){this.client.core.storage.setItem(`${Xl}/${r}`,t)}async getFromStore(r){return await this.client.core.storage.getItem(`${Xl}/${r}`)}}const rx=Yc,ix="wc",sx="ethereum_provider",nx=`${ix}@2:${sx}:`,ox="https://rpc.walletconnect.com/v1/",$c=["eth_sendTransaction","personal_sign"],ax=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Dc=["chainChanged","accountsChanged"],cx=["chainChanged","accountsChanged","message","disconnect","connect"];var ux=Object.defineProperty,hx=Object.defineProperties,lx=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,fx=Object.prototype.hasOwnProperty,px=Object.prototype.propertyIsEnumerable,af=(o,r,t)=>r in o?ux(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Xs=(o,r)=>{for(var t in r||(r={}))fx.call(r,t)&&af(o,t,r[t]);if(of)for(var t of of(r))px.call(r,t)&&af(o,t,r[t]);return o},cf=(o,r)=>hx(o,lx(r));function Ro(o){return Number(o[0].split(":")[1])}function Ec(o){return`0x${o.toString(16)}`}function dx(o){const{chains:r,optionalChains:t,methods:s,optionalMethods:a,events:h,optionalEvents:p,rpcMap:g}=o;if(!Jr(r))throw new Error("Invalid chains");const w={chains:r,methods:s||$c,events:h||Dc,rpcMap:Xs({},r.length?{[Ro(r)]:g[Ro(r)]}:{})},y=h?.filter(F=>!Dc.includes(F)),b=s?.filter(F=>!$c.includes(F));if(!t&&!p&&!a&&!(y!=null&&y.length)&&!(b!=null&&b.length))return{required:r.length?w:void 0};const S=y?.length&&b?.length||!t,R={chains:[...new Set(S?w.chains.concat(t||[]):t)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:ax))],events:[...new Set(w.events.concat(p!=null&&p.length?p:cx))],rpcMap:g};return{required:r.length?w:void 0,optional:t.length?R:void 0}}class Zc{constructor(){this.events=new Qr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=nx,this.on=(r,t)=>(this.events.on(r,t),this),this.once=(r,t)=>(this.events.once(r,t),this),this.removeListener=(r,t)=>(this.events.removeListener(r,t),this),this.off=(r,t)=>(this.events.off(r,t),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const t=new Zc;return await t.initialize(r),t}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,t){this.signer.sendAsync(r,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:t,optional:s}=dx(this.rpc);try{const a=await new Promise(async(p,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(cf(Xs({namespaces:Xs({},t&&{[this.namespace]:t})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:r?.pairingTopic})).then(y=>{p(y)}).catch(y=>{g(new Error(y.message))})});if(!a)return;const h=hw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:Ec(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:t}=r,{event:s}=t;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const t=parseInt(r);this.chainId=t,this.events.emit("chainChanged",Ec(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",cf(Xs({},It("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var t,s;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(s=this.modal)==null||s.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const t=r.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Ec(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const t=this.parseChainId(r);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(r){const[t,s,a]=r.split(":");return{chainId:`${t}:${s}`,address:a}}setAccounts(r){this.accounts=r.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var t,s;const a=(t=r?.chains)!=null?t:[],h=(s=r?.optionalChains)!=null?s:[],p=a.concat(h);if(!p.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?r?.methods||$c:[],w=a.length?r?.events||Dc:[],y=r?.optionalMethods||[],b=r?.optionalEvents||[],S=r?.rpcMap||this.buildRpcMap(p,r.projectId),R=r?.qrModalOptions||void 0;return{chains:a?.map(F=>this.formatChainId(F)),optionalChains:h.map(F=>this.formatChainId(F)),methods:g,events:w,optionalMethods:y,optionalEvents:b,rpcMap:S,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:R,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,t){const s={};return r.forEach(a=>{s[a]=this.getRpcUrl(a,t)}),s}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?Ro(this.rpc.chains):Ro(this.rpc.optionalChains),this.signer=await rx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:s}=await ew(()=>import("./index-8BPO9vLy.js").then(a=>a.i),__vite__mapDeps([0,1,2]));t=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(Xs({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:t,optionalChains:s,rpcMap:a}=r;t&&Jr(t)&&(this.rpc.chains=t.map(h=>this.formatChainId(h)),t.forEach(h=>{this.rpc.rpcMap[h]=a?.[h]||this.getRpcUrl(h)})),s&&Jr(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s?.map(h=>this.formatChainId(h)),s.forEach(h=>{this.rpc.rpcMap[h]=a?.[h]||this.getRpcUrl(h)}))}getRpcUrl(r,t){var s;return((s=this.rpc.rpcMap)==null?void 0:s[r])||`${ox}?chainId=eip155:${r}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:t?.accounts),this.setAccounts(t?.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(t=>this.parseAccount(t))}}const Tx=Zc;export{Tx as EthereumProvider,cx as OPTIONAL_EVENTS,ax as OPTIONAL_METHODS,Dc as REQUIRED_EVENTS,$c as REQUIRED_METHODS,Zc as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-8BPO9vLy.js","assets/index-SBlKJ6MA.js","assets/index-Uv5quMzx.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}